/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
/* Generated by Pygmalion */
#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <time.h>
#include "libpq-fe.h"
#include "mozH.h"
#include "comptaxBinding.nsmap"

#include <unistd.h>
#define MAX_CONN 256

static char * gAlphabet = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@*=_-(){}[]#$%+|:;.,!?";
static unsigned short gFreeConnID[MAX_CONN];
static unsigned gFreeLast = MAX_CONN-1;
static PGconn * gConn[MAX_CONN];
static char * gKey[MAX_CONN];

/******************************************************************************\
 *
 *      Main
 *
\******************************************************************************/
int main(int argc, char * argv [])
{
  int m, s, i;
  struct soap soap;
  if (argc!=3) {
    fprintf(stderr, "Usage: server server.pem password\n");
    return 0;
  }
  for(i=0;i<MAX_CONN;i++) {
    gFreeConnID[i]=i;
    gConn[i]=NULL;
    gKey[i]=NULL;
  }
  /* init OpenSSL (just once) */
  soap_ssl_init();
  soap_init(&soap);
  if (soap_ssl_server_context(&soap,
                              SOAP_SSL_REQUIRE_SERVER_AUTHENTICATION,
                              argv[1], /* keyfile: required when server must authenticate to clients (see SSL docs on how to obtain this file) */
                              argv[2], /* password to read the key file */
                              NULL, /* optional cacert file to store trusted certificates */
                              NULL, /* optional capath to directory with trusted certificates */
                              NULL, /* DH file, if NULL use RSA */
                              NULL, /* if randfile!=NULL: use a file with random data to seed randomness */
                              NULL /* optional server identification to enable SSL session cache (must be a unique name) */    ))
    {
      soap_print_fault(&soap, stderr);
      exit(1);
    }
  m = soap_bind(&soap, NULL, 15743, 100); // use port 18000
  if (m < 0)
    {
      soap_print_fault(&soap, stderr);
      exit(1);
    }
  fprintf(stderr, "Socket connection successful: master socket = %d\n", m);
  for (;;)
    {
      s = soap_accept(&soap);
      if (s < 0)
        {
          if (soap.errnum)
            soap_print_fault(&soap, stderr);
          else
            fprintf(stderr, "Server timed out\n");
          break;
        }
      fprintf(stderr, "Socket %d connection from IP %d.%d.%d.%d\n", s, (int)(soap.ip>>24)&0xFF, (int)(soap.ip>>16)&0xFF, (int)(soap.ip>>8)&0xFF, (int)soap.ip&0xFF);
      if (soap_ssl_accept(&soap))
        {
          soap_print_fault(&soap, stderr);
          fprintf(stderr, "SSL request failed, continue with next call...\n");
          soap_end(&soap);
          continue;
        }
      soap_serve(&soap);
      soap_end(&soap);
    }
  soap_end(&soap);
  soap_done(&soap); /* deallocates SSL context */
  return 0;
}

/******************************************************************************\
 *
 *      Functions
 *
\******************************************************************************/

int createKey(unsigned short aId, char ** aKey)
{
  if (PQstatus(gConn[aId]) != CONNECTION_OK)
    return 0;
  char pAlea[11];
  float length = (float)(strlen(gAlphabet)-1)/RAND_MAX;
  srand(time(0)); //Initialisation du générateur
  pAlea[0]=gAlphabet[(int)((float)rand()*length)];
  pAlea[1]=gAlphabet[(int)((float)rand()*length)];
  pAlea[2]=gAlphabet[(int)((float)rand()*length)];
  pAlea[3]=gAlphabet[(int)((float)rand()*length)];
  pAlea[4]=gAlphabet[(int)((float)rand()*length)];
  pAlea[5]=gAlphabet[(int)((float)rand()*length)];
  pAlea[6]=gAlphabet[(int)((float)rand()*length)];
  pAlea[7]=gAlphabet[(int)((float)rand()*length)];
  pAlea[8]=gAlphabet[(int)((float)rand()*length)];
  pAlea[9]=gAlphabet[(int)((float)rand()*length)];
  pAlea[10]='\0';
  gKey[aId]=(char *)malloc(13*sizeof(char));
  sprintf(gKey[aId], "%02x%s", aId, pAlea);
  aKey[0]=strdup(gKey[aId]);
  return 1;
}

/******************************************************************************\
 *
 *      Service methods
 *
\******************************************************************************/

SOAP_FMAC5 int SOAP_FMAC6 moz1__pmConnect(struct soap* aSoap, char * aLogin, char * aPassword, char * aDatabase, char ** aKey)
{
  fprintf(stderr,"pmConnect\n");
  char pConninfo[1024];
  unsigned short pId;
  if (gFreeLast<=0) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S102> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"102\"/>");
  }
  pId = gFreeConnID[gFreeLast--];
  sprintf(pConninfo,"host='%s' dbname=%s user=%s password=%s sslmode=allow ",
	  "localhost", aDatabase, aLogin, aPassword);
  gConn[pId] = PQconnectdb(pConninfo);
  if (PQstatus(gConn[pId]) != CONNECTION_OK) {
    PQfinish(gConn[pId]);
    gFreeConnID[++gFreeLast] = pId;
    printf("Line %d\n",__LINE__);
    char pMessage103[16384];
    snprintf(pMessage103,16380,"<error code=\"103\">%s</error>", PQerrorMessage(gConn[pId]));
    fprintf(stderr, "R103> %s", pMessage103);
    return soap_receiver_fault(aSoap, "Connexion impossible", pMessage103);
  }
  if (!createKey(pId, aKey)) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S104> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"104\"/>");
  }
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__pmFinish(struct soap* aSoap, char * aKey, unsigned int * aResult)
{
  fprintf(stderr,"pmFinish\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  *aResult = 0;
  if (gConn[pId]!=NULL) {
    if (PQstatus(gConn[pId]) == CONNECTION_OK) {
      PQfinish(gConn[pId]);
      gFreeConnID[++gFreeLast]=pId;
      *aResult = 1;
    }
  }
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__Setup(struct soap* aSoap, char * aKey, struct moz1__SetupResponse * aReturn)
{
  fprintf(stderr,"Setup\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  PGresult * pResult = PQexec(gConn[pId], "SELECT COUNT(*) FROM information_schema.routines WHERE routine_name='set_search_path' AND routine_schema='systeme';");
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage302[16384];
    snprintf(pMessage302,16380,"<error code=\"302\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R302> %s", pMessage302);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage302);
  }
  aReturn->name = strdup("comptax");
  aReturn->uuid = strdup("cfdfbea4-9b5a-4d70-b844-5bd4302d3742");
  aReturn->version = strdup("1");
  aReturn->state = strdup(PQgetvalue(pResult,0,0));
  PQclear(pResult);
  if (strcmp(aReturn->state,"0")!=0) {
    pResult = PQexec(gConn[pId], "SELECT systeme.set_search_path();");
    if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
      printf("Line %d\n",__LINE__);
      fprintf(stderr, "S105> Connexion impossible");
      return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"105\"/>");
    }
    PQclear(pResult);
  }
  pResult = PQexec(gConn[pId], "SELECT CASE WHEN usesuper THEN 'superuser' ELSE 'normal' END FROM pg_catalog.pg_user WHERE usename=current_user;");
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage303[16384];
    snprintf(pMessage303,16380,"<error code=\"303\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R303> %s", pMessage303);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage303);
  }
  aReturn->userType = strdup(PQgetvalue(pResult,0,0));
  PQclear(pResult);
  pResult = PQexec(gConn[pId], "SELECT CURRENT_USER;");
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage304[16384];
    snprintf(pMessage304,16380,"<error code=\"304\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R304> %s", pMessage304);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage304);
  }
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__Prepare(struct soap* aSoap, char * aKey, char * aQuery, char * aName, unsigned int aArity, unsigned int * aResult)
{
  fprintf(stderr,"Prepare\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  PGresult * pResult = PQprepare(gConn[pId], aName, aQuery, aArity, NULL);
  if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage312[16384];
    snprintf(pMessage312,16380,"<error code=\"312\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R312> %s", pMessage312);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage312);
  }
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__PrepareList(struct soap* aSoap, char * aKey, struct moz1__sqlQueryList * aQueries, unsigned int * aResult)
{
  fprintf(stderr,"PrepareList\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  PGresult * pResult;
  unsigned int i,n;
  n = aQueries->__sizedef;
  for (i=0;i<n;i++){
    pResult = PQprepare(gConn[pId], aQueries->def[i].name, aQueries->def[i].query, aQueries->def[i].arity, NULL);
    if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage312[16384];
      snprintf(pMessage312,16380,"<error code=\"312\">%s</error>", PQresultErrorMessage(pResult));
      PQclear(pResult);
      fprintf(stderr, "R312> %s", pMessage312);
      return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage312);
    }
  }
  if (n>0) PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__ExecPreparedSelect(struct soap* aSoap, char * aKey, char * aName, struct moz1__sqlLine * aParams, struct moz1__ExecPreparedSelectResponse * aReturn)
{
  fprintf(stderr,"ExecPreparedSelect\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  unsigned int i,j,n,m;
  char ** line;
  PGresult * pResult = PQexecPrepared(gConn[pId], aName, aParams->__sizev, (const char * const *)aParams->v, NULL, NULL, 0);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage313[16384];
    snprintf(pMessage313,16380,"<error code=\"313\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R313> %s", pMessage313);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage313);
  }
  aReturn->result=(struct moz1__sqlTable *)malloc(sizeof(struct moz1__sqlTable));
  struct moz1__sqlTable * pTable=aReturn->result;
  m=PQnfields(pResult);
  n=PQntuples(pResult);
  pTable->__sizel=n;
  pTable->l=(struct moz1__sqlLine*)malloc(n*sizeof(struct moz1__sqlLine));
  for (i=0;i<n;i++) {
    pTable->l[i].__sizev=m;
    pTable->l[i].v=(char**)malloc(m*sizeof(char*));
    line=pTable->l[i].v;
    for (j=0;j<m;j++)
      line[j] = strdup(PQgetvalue(pResult,i,j));
  }
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__ExecPreparedUpdate(struct soap* aSoap, char * aKey, char * aName, struct moz1__sqlLine * aParams, char ** aResult)
{
  fprintf(stderr,"ExecPreparedUpdate\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  PGresult * pResult = PQexecPrepared(gConn[pId], aName, aParams->__sizev, (const char * const *)aParams->v, NULL, NULL, 0);
  if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage314[16384];
    snprintf(pMessage314,16380,"<error code=\"314\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R314> %s", pMessage314);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage314);
  }
  *aResult=strdup(PQcmdTuples(pResult));
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__ExecSelect(struct soap* aSoap, char * aKey, char * aQuery, struct moz1__sqlLine * aParams, struct moz1__ExecSelectResponse * aReturn)
{
  fprintf(stderr,"ExecSelect\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  unsigned int i,j,n,m;
  char ** line;
  PGresult * pResult = PQexecParams(gConn[pId], aQuery, aParams->__sizev, NULL, (const char * const *)aParams->v, NULL, NULL, 0);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage315[16384];
    snprintf(pMessage315,16380,"<error code=\"315\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R315> %s", pMessage315);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage315);
  }
  aReturn->result=(struct moz1__sqlTable *)malloc(sizeof(struct moz1__sqlTable));
  struct moz1__sqlTable * pTable=aReturn->result;
  m=PQnfields(pResult);
  n=PQntuples(pResult);
  pTable->__sizel=n;
  pTable->l=(struct moz1__sqlLine*)malloc(n*sizeof(struct moz1__sqlLine));
  for (i=0;i<n;i++) {
    pTable->l[i].__sizev=m;
    pTable->l[i].v=(char**)malloc(m*sizeof(char*));
    line=pTable->l[i].v;
    for (j=0;j<m;j++) {
      line[j] = strdup(PQgetvalue(pResult,i,j));
      fprintf(stdout," | %s",line[j]);
    }
    fprintf(stdout,"\n");
  }
  fprintf(stdout,"[");
  PQclear(pResult);
  fprintf(stdout,"]\n");
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__ExecUpdate(struct soap* aSoap, char * aKey, char * aQuery, struct moz1__sqlLine * aParams, char ** aResult)
{
  fprintf(stderr,"ExecUpdate\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  PGresult * pResult = PQexecParams(gConn[pId], aQuery, aParams->__sizev,NULL,  (const char * const *)aParams->v, NULL, NULL, 0);
  if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage314[16384];
    snprintf(pMessage314,16380,"<error code=\"314\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R314> %s", pMessage314);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage314);
  }
  *aResult=strdup(PQcmdTuples(pResult));
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__pmInit(struct soap* aSoap, char * aKey, char * aDatabase, enum xsd__boolean aForce, unsigned int * aResult)
{
  fprintf(stderr,"pmInit\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  char query[1024];
  PGresult * pResult;
  fprintf(stderr, "0");
  sprintf(query,"SELECT count(*) FROM pg_database WHERE datname='%s';",aDatabase);
  pResult = PQexec(gConn[pId], query);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage305[16384];
    snprintf(pMessage305,16380,"<error code=\"305\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R305> %s", pMessage305);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage305);
  }

  fprintf(stderr, "1");
  if (strcmp(PQgetvalue(pResult,0,0),"0")==0) {
    fprintf(stderr, "2");
    sprintf(query,"CREATE DATABASE %s ENCODING 'UTF-8';", aDatabase);
    pResult = PQexec(gConn[pId], query);
    if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage306[16384];
      snprintf(pMessage306,16380,"<error code=\"306\">%s</error>", PQresultErrorMessage(pResult));
      PQclear(pResult);
      fprintf(stderr, "R306> %s", pMessage306);
      return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage306);
    }
    *aResult = 157;
    return SOAP_OK;
  } else {
    fprintf(stderr, "3");
    sprintf(query,"SELECT CASE WHEN current_database()='%s' THEN '1' ELSE '0' END;", aDatabase);
    pResult = PQexec(gConn[pId], query);
    if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage307[16384];
      snprintf(pMessage307,16380,"<error code=\"307\">%s</error>", PQresultErrorMessage(pResult));
      PQclear(pResult);
      fprintf(stderr, "R307> %s", pMessage307);
      return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage307);
    }
    fprintf(stderr, "(%s)",PQgetvalue(pResult,0,0));
    if (strcmp(PQgetvalue(pResult,0,0),"0")==0) {
      fprintf(stderr, "4");
      *aResult = 159;
      return SOAP_OK;
    }
  }
  fprintf(stderr, "5(%s)", aDatabase);
  sprintf(query,"SELECT count(*) FROM pg_language WHERE lanname LIKE 'plpgsql';");
  pResult = PQexec(gConn[pId], query);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage308[16384];
    snprintf(pMessage308,16380,"<error code=\"308\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R308> %s", pMessage308);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage308);
  } else {
    if (strcmp(PQgetvalue(pResult,0,0),"0")==0) {
      sprintf(query,"CREATE LANGUAGE \"plpgsql\";");
      pResult = PQexec(gConn[pId], query);
      if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
        printf("Line %d\n",__LINE__);
        char pMessage309[16384];
        snprintf(pMessage309,16380,"<error code=\"309\">%s</error>", PQresultErrorMessage(pResult));
        PQclear(pResult);
        fprintf(stderr, "R309> %s", pMessage309);
        return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage309);
      }
    }
  }
fprintf(stderr, "6");
  pResult = PQexec(gConn[pId], "CREATE OR REPLACE FUNCTION pm__InitDatabase(text,boolean) RETURNS INTEGER AS\n$$\nDECLARE\n  TheDatabase ALIAS FOR $1;\n  ForceInit ALIAS FOR $2;\n  schema_name varchar;\n  proc text;\n  start_value integer;\nBEGIN\n\n\n  --\n  -- Schema: systeme\n  --\n\n  CREATE SCHEMA systeme;\n  schema_name := 'systeme'::varchar;\n  SET search_path to systeme;\n  CREATE TABLE systeme_schema (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(32) NOT NULL\n  );\n  -- Indexes\n  -- Constraints\n  RAISE NOTICE 'Contraintes';\n  -- Data without triggers\n  -- Procedures\n  proc:='CREATE OR REPLACE FUNCTION set_search_path() RETURNS text AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'  s record;\\n';\n  proc:=proc||'  is_search_path boolean;\\n';\n  proc:=proc||'  rpath text;\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  rpath:='''';\\n';\n  proc:=proc||'  FOR s IN SELECT nom FROM systeme.systeme_schema ORDER BY id LOOP\\n';\n  proc:=proc||'    query:=''SELECT ''||s.nom||''.is_search_path(current_user::text);'';\\n';\n  proc:=proc||'    EXECUTE query INTO is_search_path;\\n';\n  proc:=proc||'    IF is_search_path THEN\\n';\n  proc:=proc||'      IF LENGTH(rpath)>0 THEN\\n';\n  proc:=proc||'        rpath:=rpath||'','';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      rpath:=rpath||s.nom;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END LOOP;\\n';\n  proc:=proc||'  IF rpath IS NOT NULL THEN\\n';\n  proc:=proc||'    query:=''SET SEARCH_PATH TO ''||rpath;\\n';\n  proc:=proc||'    EXECUTE query;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN rpath;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION is_search_path(text) RETURNS boolean AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN true;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\n  -- Triggers\n  -- Data with triggers\n  -- Sequences initialization\n  SELECT COALESCE(MAX(id),0)+1 FROM systeme_schema INTO start_value;\n  proc := 'ALTER SEQUENCE systeme_schema_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n\n\n  --\n  -- Schema: base\n  --\n\n  CREATE SCHEMA base;\n  schema_name := 'base'::varchar;\n  SET search_path to base;\n  CREATE TABLE base_langue (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL\n  );\n  CREATE TABLE base_devise (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(32) UNIQUE NOT NULL,\n    symbole CHARACTER VARYING(32) UNIQUE NOT NULL,\n    abrev CHARACTER VARYING(4) UNIQUE,\n    taux NUMERIC(16,6) NOT NULL\n  );\n  CREATE TABLE base_societe (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL,\n    siren CHARACTER VARYING(32) UNIQUE,\n    naf CHARACTER VARYING(32),\n    adresse CHARACTER VARYING(128),\n    sequence CHARACTER VARYING(128),\n    schema CHARACTER VARYING(32),\n    note CHARACTER VARYING\n  );\n  CREATE TABLE base_utilisateur (\n    id SERIAL NOT NULL PRIMARY KEY,\n    societe_id INTEGER NOT NULL,\n    login CHARACTER VARYING(32) UNIQUE NOT NULL,\n    password CHARACTER VARYING(32) NOT NULL,\n    search_path CHARACTER VARYING(128),\n    email CHARACTER VARYING(128),\n    superuser BOOLEAN NOT NULL DEFAULT false,\n    createdb BOOLEAN NOT NULL DEFAULT false,\n    createrole BOOLEAN NOT NULL DEFAULT false,\n    maxconn INTEGER NOT NULL DEFAULT -1,\n    jusqua DATE\n  );\n  CREATE TABLE base_commune (\n    id SERIAL NOT NULL PRIMARY KEY,\n    canton_id INTEGER,\n    nom CHARACTER VARYING(128)\n  );\n  CREATE TABLE base_canton (\n    id SERIAL NOT NULL PRIMARY KEY,\n    arrondissment_id INTEGER,\n    nom CHARACTER VARYING(128)\n  );\n  -- Indexes\n  CREATE  UNIQUE INDEX base_devise_nom_index ON base_devise(nom);\n  CREATE  UNIQUE INDEX base_devise_symbole_index ON base_devise(symbole);\n  CREATE  UNIQUE INDEX base_devise_abrev_index ON base_devise(abrev);\n  CREATE  UNIQUE INDEX base_societe_code_index ON base_societe(code);\n  CREATE  UNIQUE INDEX base_societe_siren_index ON base_societe(siren);\n  CREATE  INDEX base_societe_naf_index ON base_societe(naf);\n  -- Constraints\n  RAISE NOTICE 'Contraintes';\n  ALTER TABLE base_devise ADD CONSTRAINT base_devise_constraint0 CHECK (taux>0);\n  ALTER TABLE base_utilisateur ADD CONSTRAINT base_utilisateur_constraint0 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\n  -- Data without triggers\n  -- Procedures\n  proc:='CREATE OR REPLACE FUNCTION is_search_path(text) RETURNS boolean AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN true;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\n  -- Triggers\n  -- Data with triggers\n  -- Sequences initialization\n  SELECT COALESCE(MAX(id),0)+1 FROM base_langue INTO start_value;\n  proc := 'ALTER SEQUENCE base_langue_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_devise INTO start_value;\n  proc := 'ALTER SEQUENCE base_devise_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_societe INTO start_value;\n  proc := 'ALTER SEQUENCE base_societe_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_utilisateur INTO start_value;\n  proc := 'ALTER SEQUENCE base_utilisateur_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_commune INTO start_value;\n  proc := 'ALTER SEQUENCE base_commune_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_canton INTO start_value;\n  proc := 'ALTER SEQUENCE base_canton_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n\n\n  --\n  -- Schema: code\n  --\n\n  SET search_path to base;\n  proc:='CREATE OR REPLACE FUNCTION SYS_basebase_societeCreator() RETURNS TRIGGER AS\\n';\n  proc:=proc||' \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  schema_name varchar;\\n';\n  proc:=proc||'  start_value integer;\\n';\n  proc:=proc||'  proc text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  NEW.code:=lower(replace(NEW.code,'' '',''''));\\n';\n  proc:=proc||'  schema_name := NEW.code::varchar;\\n';\n  proc:=proc||'  SELECT ''CREATE SCHEMA ''||schema_name INTO query;\\n';\n  proc:=proc||'  EXECUTE query;\\n';\n  proc:=proc||'  SELECT set_search_path() INTO query;\\n';\n  proc:=proc||'  SELECT ''SET search_path TO ''||schema_name||'',''||query INTO query;\\n';\n  proc:=proc||'  EXECUTE query;\\n';\n  proc:=proc||'  CREATE TABLE base_societe_parametre (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    valeur CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_service (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    parent_service_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    responsable_id INTEGER,\\n';\n  proc:=proc||'    etablissement_id INTEGER,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_etablissement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    siret CHARACTER VARYING(32) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    adresse_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    morale BOOLEAN NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    prenom CHARACTER VARYING(64),\\n';\n  proc:=proc||'    titre CHARACTER VARYING(64),\\n';\n  proc:=proc||'    debit_limite NUMERIC(16,2),\\n';\n  proc:=proc||'    credit_limite NUMERIC(16,2),\\n';\n  proc:=proc||'    langue_code CHARACTER VARYING(16),\\n';\n  proc:=proc||'    site_web CHARACTER VARYING(128),\\n';\n  proc:=proc||'    parent_partenaire_id INTEGER,\\n';\n  proc:=proc||'    utilisateur_id INTEGER,\\n';\n  proc:=proc||'    responsible_id INTEGER,\\n';\n  proc:=proc||'    date_naissance DATE,\\n';\n  proc:=proc||'    ean13 CHARACTER VARYING(13),\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_adresse (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    date_stop DATE,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    complement CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    ligne1 CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    ligne2 CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    ligne3 CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    codepostal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    ville_complement CHARACTER VARYING(32) NOT NULL,\\n';\n  proc:=proc||'    telephone CHARACTER VARYING(128),\\n';\n  proc:=proc||'    fax CHARACTER VARYING(128),\\n';\n  proc:=proc||'    email CHARACTER VARYING(128),\\n';\n  proc:=proc||'    mobile CHARACTER VARYING(128)\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_adresse_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    categorie_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    valeur CHARACTER VARYING(128) NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut_categorie (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    attribut_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    latex CHARACTER VARYING,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    classe_id INTEGER NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression_classe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_ecriture (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    devise_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    devise_value NUMERIC(16,6) NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    debit_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    simulation BOOLEAN,\\n';\n  proc:=proc||'    lettrage CHARACTER VARYING(16),\\n';\n  proc:=proc||'    compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compte_numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_date DATE NOT NULL,\\n';\n  proc:=proc||'    journal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    pointage_id INTEGER\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_piece (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    echeance DATE NOT NULL,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    exercice_code INTEGER NOT NULL,\\n';\n  proc:=proc||'    exercice_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_id INTEGER NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_exercice (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    cloture BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_journal (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit_compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    mois INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    annee INTEGER NOT NULL DEFAULT 1900,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) NOT NULL DEFAULT ''false'',\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(32) NOT NULL DEFAULT ''false'',\\n';\n  proc:=proc||'    provisoire BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    visible BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    contrepartie BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_journal_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING(128),\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_pointage (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    banque_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    date INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_banque (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_taxe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    taux NUMERIC(16,6) NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_acces (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64),\\n';\n  proc:=proc||'    valeur INTEGER UNIQUE NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compteperm (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    signe BOOLEAN,\\n';\n  proc:=proc||'    parent_compteperm_id INTEGER,\\n';\n  proc:=proc||'    general BOOLEAN,\\n';\n  proc:=proc||'    accept_aux BOOLEAN,\\n';\n  proc:=proc||'    utilisable BOOLEAN,\\n';\n  proc:=proc||'    lettrable BOOLEAN,\\n';\n  proc:=proc||'    pointable BOOLEAN,\\n';\n  proc:=proc||'    groupable BOOLEAN,\\n';\n  proc:=proc||'    echeance INTEGER DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compte (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    acces_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    exercice_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    signe BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    dernier_lettre CHARACTER VARYING(16),\\n';\n  proc:=proc||'    parent_id INTEGER,\\n';\n  proc:=proc||'    general BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    accept_aux BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    utilisable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    lettrable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    pointable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    groupable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compte_cumul (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    mois INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    annee INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  -- Indexes\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_parametre_code_index ON base_societe_parametre(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_service_code_index ON base_societe_service(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_etablissement_code_index ON base_societe_etablissement(code);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_langue_code_index ON base_partenaire(langue_code);\\n';\n  proc:=proc||'  CREATE  INDEX compta_compte_dernier_lettre_index ON compta_compte(dernier_lettre);\\n';\n  proc:=proc||'  -- Constraints\\n';\n  proc:=proc||'  RAISE NOTICE ''Contraintes'';\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint0 FOREIGN KEY (responsable_id) REFERENCES base_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint1 FOREIGN KEY (parent_service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint2 FOREIGN KEY (etablissement_id) REFERENCES base_societe_etablissement(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_etablissement ADD CONSTRAINT base_societe_etablissement_constraint0 FOREIGN KEY (adresse_id) REFERENCES base_partenaire_adresse(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint0 FOREIGN KEY (parent_partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint1 FOREIGN KEY (utilisateur_id) REFERENCES base_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint2 FOREIGN KEY (responsible_id) REFERENCES base_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint3 FOREIGN KEY (langue_code) REFERENCES base_langue(code);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint1 FOREIGN KEY (type_id) REFERENCES base_partenaire_attribut_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint2 FOREIGN KEY (categorie_id) REFERENCES base_partenaire_attribut_categorie(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_categorie ADD CONSTRAINT base_partenaire_attribut_categorie_constraint0 FOREIGN KEY (attribut_type_id) REFERENCES base_partenaire_attribut_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_constraint0 FOREIGN KEY (type_id) REFERENCES base_impression_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_constraint1 FOREIGN KEY (classe_id) REFERENCES base_impression_classe(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint0 FOREIGN KEY (compte_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint1 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint2 FOREIGN KEY (piece_id) REFERENCES compta_piece(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint3 FOREIGN KEY (pointage_id) REFERENCES compta_pointage(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint0 FOREIGN KEY (exercice_id) REFERENCES compta_exercice(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint1 FOREIGN KEY (journal_id) REFERENCES compta_journal(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint0 FOREIGN KEY (type_id) REFERENCES compta_journal_type(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint1 FOREIGN KEY (debit_compte_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_pointage ADD CONSTRAINT compta_pointage_constraint0 FOREIGN KEY (banque_id) REFERENCES compta_banque(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque ADD CONSTRAINT compta_banque_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_taxe ADD CONSTRAINT compta_taxe_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_acces ADD CONSTRAINT compta_acces_constraint0 CHECK (valeur>=0);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_constraint0 FOREIGN KEY (parent_compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint1 FOREIGN KEY (parent_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint2 FOREIGN KEY (acces_id) REFERENCES compta_acces(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint3 FOREIGN KEY (exercice_id) REFERENCES compta_exercice(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte_cumul ADD CONSTRAINT compta_compte_cumul_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  -- Data without triggers\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (1, ''DEFAUT'', ''Par dÃ©faut'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (2, ''DEVIS'', ''Devis'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (3, ''FACTURATION'', ''Facturation'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (4, ''LIVRAISON'', ''Livraison'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (5, ''CONTACT'', ''Contact'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_impression_classe VALUES (1, ''DEFAUT'', ''Par dÃ©faut'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_classe VALUES (2, ''LETTRE'', ''Correspondance'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (1, ''DEVIS'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (2, ''FACTURE'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (3, ''AVOIR'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (4, ''BALANCE'');\\n';\n  proc:=proc||'  INSERT INTO compta_exercice(code, date_debut, date_fin) VALUES (''EX200607'', ''01/09/2006'', ''31/08/2007'');\\n';\n  proc:=proc||'  INSERT INTO compta_acces VALUES (1, ''INVITE'', ''InvitÃ©'', 1000000);\\n';\n  proc:=proc||'  INSERT INTO compta_acces VALUES (2, ''EXPERTCO'', ''Expert comptable'', 0);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id) VALUES (6, ''Comptes de charges'', ''6'', NULL);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id) VALUES (7, ''Comptes de produits'', ''7'', NULL);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, general, parent_compteperm_id) VALUES (60, ''Achats (sauf 603)'', ''60'', true, 6);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id) VALUES (607, ''Achats de marchandises'', ''607'', 60);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general) VALUES (70, ''Ventes de produits fabriquÃ©s, prestations de services, marchandises'', ''70'', 7, true);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general) VALUES (706, ''Prestations de services'', ''706'', 70, true);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general) VALUES (709, ''Rabais, remises et ristournes accordÃ©s par l''''entreprise'', ''709'', 70, true);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general) VALUES (71, ''Production stockÃ©e (ou dÃ©stockage)'', ''71'', 7, true);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id) VALUES (713, ''Variation des stocks (en-cours de production, produits)'', ''713'', 71);\\n';\n  proc:=proc||'  -- Procedures\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION is_search_path(text) RETURNS boolean AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*)  FROM base.base_utilisateur WHERE login=$1 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN (total>0)::boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\\n';\n  proc:=proc||'  -- Triggers\\n';\n  proc:=proc||'  -- Data with triggers\\n';\n  proc:=proc||'  -- Sequences initialization\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_societe_parametre INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_societe_parametre_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_societe_service INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_societe_service_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_societe_etablissement INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_societe_etablissement_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_adresse INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_adresse_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_adresse_type INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_adresse_type_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_attribut INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_attribut_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_attribut_type INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_attribut_type_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_attribut_categorie INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_attribut_categorie_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_impression INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_impression_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_impression_classe INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_impression_classe_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_impression_type INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_impression_type_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_ecriture INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_ecriture_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_piece INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_piece_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_exercice INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_exercice_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_journal INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_journal_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_journal_type INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_journal_type_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_pointage INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_pointage_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_banque INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_banque_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_taxe INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_taxe_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_acces INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_acces_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_compteperm INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_compteperm_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_compte INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_compte_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_compte_cumul INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_compte_cumul_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  CREATE TRIGGER basebase_societeTrigger BEFORE INSERT ON base_societe FOR EACH ROW EXECUTE PROCEDURE SYS_basebase_societeCreator();\n  RETURN 0;\nEND; $$ LANGUAGE 'plpgsql' VOLATILE;\n");
  fprintf(stderr, "\nCREATE OR REPLACE FUNCTION pm__InitDatabase(text,boolean) RETURNS INTEGER AS\n$$\nDECLARE\n  TheDatabase ALIAS FOR $1;\n  ForceInit ALIAS FOR $2;\n  schema_name varchar;\n  proc text;\n  start_value integer;\nBEGIN\n\n\n  --\n  -- Schema: systeme\n  --\n\n  CREATE SCHEMA systeme;\n  schema_name := 'systeme'::varchar;\n  SET search_path to systeme;\n  CREATE TABLE systeme_schema (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(32) NOT NULL\n  );\n  -- Indexes\n  -- Constraints\n  RAISE NOTICE 'Contraintes';\n  -- Data without triggers\n  -- Procedures\n  proc:='CREATE OR REPLACE FUNCTION set_search_path() RETURNS text AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'  s record;\\n';\n  proc:=proc||'  is_search_path boolean;\\n';\n  proc:=proc||'  rpath text;\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  rpath:='''';\\n';\n  proc:=proc||'  FOR s IN SELECT nom FROM systeme.systeme_schema ORDER BY id LOOP\\n';\n  proc:=proc||'    query:=''SELECT ''||s.nom||''.is_search_path(current_user::text);'';\\n';\n  proc:=proc||'    EXECUTE query INTO is_search_path;\\n';\n  proc:=proc||'    IF is_search_path THEN\\n';\n  proc:=proc||'      IF LENGTH(rpath)>0 THEN\\n';\n  proc:=proc||'        rpath:=rpath||'','';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      rpath:=rpath||s.nom;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END LOOP;\\n';\n  proc:=proc||'  IF rpath IS NOT NULL THEN\\n';\n  proc:=proc||'    query:=''SET SEARCH_PATH TO ''||rpath;\\n';\n  proc:=proc||'    EXECUTE query;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN rpath;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION is_search_path(text) RETURNS boolean AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN true;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\n  -- Triggers\n  -- Data with triggers\n  -- Sequences initialization\n  SELECT COALESCE(MAX(id),0)+1 FROM systeme_schema INTO start_value;\n  proc := 'ALTER SEQUENCE systeme_schema_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n\n\n  --\n  -- Schema: base\n  --\n\n  CREATE SCHEMA base;\n  schema_name := 'base'::varchar;\n  SET search_path to base;\n  CREATE TABLE base_langue (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL\n  );\n  CREATE TABLE base_devise (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(32) UNIQUE NOT NULL,\n    symbole CHARACTER VARYING(32) UNIQUE NOT NULL,\n    abrev CHARACTER VARYING(4) UNIQUE,\n    taux NUMERIC(16,6) NOT NULL\n  );\n  CREATE TABLE base_societe (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL,\n    siren CHARACTER VARYING(32) UNIQUE,\n    naf CHARACTER VARYING(32),\n    adresse CHARACTER VARYING(128),\n    sequence CHARACTER VARYING(128),\n    schema CHARACTER VARYING(32),\n    note CHARACTER VARYING\n  );\n  CREATE TABLE base_utilisateur (\n    id SERIAL NOT NULL PRIMARY KEY,\n    societe_id INTEGER NOT NULL,\n    login CHARACTER VARYING(32) UNIQUE NOT NULL,\n    password CHARACTER VARYING(32) NOT NULL,\n    search_path CHARACTER VARYING(128),\n    email CHARACTER VARYING(128),\n    superuser BOOLEAN NOT NULL DEFAULT false,\n    createdb BOOLEAN NOT NULL DEFAULT false,\n    createrole BOOLEAN NOT NULL DEFAULT false,\n    maxconn INTEGER NOT NULL DEFAULT -1,\n    jusqua DATE\n  );\n  CREATE TABLE base_commune (\n    id SERIAL NOT NULL PRIMARY KEY,\n    canton_id INTEGER,\n    nom CHARACTER VARYING(128)\n  );\n  CREATE TABLE base_canton (\n    id SERIAL NOT NULL PRIMARY KEY,\n    arrondissment_id INTEGER,\n    nom CHARACTER VARYING(128)\n  );\n  -- Indexes\n  CREATE  UNIQUE INDEX base_devise_nom_index ON base_devise(nom);\n  CREATE  UNIQUE INDEX base_devise_symbole_index ON base_devise(symbole);\n  CREATE  UNIQUE INDEX base_devise_abrev_index ON base_devise(abrev);\n  CREATE  UNIQUE INDEX base_societe_code_index ON base_societe(code);\n  CREATE  UNIQUE INDEX base_societe_siren_index ON base_societe(siren);\n  CREATE  INDEX base_societe_naf_index ON base_societe(naf);\n  -- Constraints\n  RAISE NOTICE 'Contraintes';\n  ALTER TABLE base_devise ADD CONSTRAINT base_devise_constraint0 CHECK (taux>0);\n  ALTER TABLE base_utilisateur ADD CONSTRAINT base_utilisateur_constraint0 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\n  -- Data without triggers\n  -- Procedures\n  proc:='CREATE OR REPLACE FUNCTION is_search_path(text) RETURNS boolean AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN true;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\n  -- Triggers\n  -- Data with triggers\n  -- Sequences initialization\n  SELECT COALESCE(MAX(id),0)+1 FROM base_langue INTO start_value;\n  proc := 'ALTER SEQUENCE base_langue_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_devise INTO start_value;\n  proc := 'ALTER SEQUENCE base_devise_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_societe INTO start_value;\n  proc := 'ALTER SEQUENCE base_societe_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_utilisateur INTO start_value;\n  proc := 'ALTER SEQUENCE base_utilisateur_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_commune INTO start_value;\n  proc := 'ALTER SEQUENCE base_commune_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n  SELECT COALESCE(MAX(id),0)+1 FROM base_canton INTO start_value;\n  proc := 'ALTER SEQUENCE base_canton_id_seq RESTART WITH '||start_value;\n  EXECUTE proc;\n\n\n  --\n  -- Schema: code\n  --\n\n  SET search_path to base;\n  proc:='CREATE OR REPLACE FUNCTION SYS_basebase_societeCreator() RETURNS TRIGGER AS\\n';\n  proc:=proc||' \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  schema_name varchar;\\n';\n  proc:=proc||'  start_value integer;\\n';\n  proc:=proc||'  proc text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  NEW.code:=lower(replace(NEW.code,'' '',''''));\\n';\n  proc:=proc||'  schema_name := NEW.code::varchar;\\n';\n  proc:=proc||'  SELECT ''CREATE SCHEMA ''||schema_name INTO query;\\n';\n  proc:=proc||'  EXECUTE query;\\n';\n  proc:=proc||'  SELECT set_search_path() INTO query;\\n';\n  proc:=proc||'  SELECT ''SET search_path TO ''||schema_name||'',''||query INTO query;\\n';\n  proc:=proc||'  EXECUTE query;\\n';\n  proc:=proc||'  CREATE TABLE base_societe_parametre (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    valeur CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_service (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    parent_service_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    responsable_id INTEGER,\\n';\n  proc:=proc||'    etablissement_id INTEGER,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_etablissement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    siret CHARACTER VARYING(32) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    adresse_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    morale BOOLEAN NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    prenom CHARACTER VARYING(64),\\n';\n  proc:=proc||'    titre CHARACTER VARYING(64),\\n';\n  proc:=proc||'    debit_limite NUMERIC(16,2),\\n';\n  proc:=proc||'    credit_limite NUMERIC(16,2),\\n';\n  proc:=proc||'    langue_code CHARACTER VARYING(16),\\n';\n  proc:=proc||'    site_web CHARACTER VARYING(128),\\n';\n  proc:=proc||'    parent_partenaire_id INTEGER,\\n';\n  proc:=proc||'    utilisateur_id INTEGER,\\n';\n  proc:=proc||'    responsible_id INTEGER,\\n';\n  proc:=proc||'    date_naissance DATE,\\n';\n  proc:=proc||'    ean13 CHARACTER VARYING(13),\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_adresse (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    date_stop DATE,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    complement CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    ligne1 CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    ligne2 CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    ligne3 CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    codepostal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    ville_complement CHARACTER VARYING(32) NOT NULL,\\n';\n  proc:=proc||'    telephone CHARACTER VARYING(128),\\n';\n  proc:=proc||'    fax CHARACTER VARYING(128),\\n';\n  proc:=proc||'    email CHARACTER VARYING(128),\\n';\n  proc:=proc||'    mobile CHARACTER VARYING(128)\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_adresse_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    categorie_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    valeur CHARACTER VARYING(128) NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut_categorie (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    attribut_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    latex CHARACTER VARYING,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    classe_id INTEGER NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression_classe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_ecriture (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    devise_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    devise_value NUMERIC(16,6) NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    debit_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    simulation BOOLEAN,\\n';\n  proc:=proc||'    lettrage CHARACTER VARYING(16),\\n';\n  proc:=proc||'    compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compte_numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_date DATE NOT NULL,\\n';\n  proc:=proc||'    journal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    pointage_id INTEGER\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_piece (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    echeance DATE NOT NULL,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    exercice_code INTEGER NOT NULL,\\n';\n  proc:=proc||'    exercice_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_id INTEGER NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_exercice (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    cloture BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_journal (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit_compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    mois INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    annee INTEGER NOT NULL DEFAULT 1900,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) NOT NULL DEFAULT ''false'',\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(32) NOT NULL DEFAULT ''false'',\\n';\n  proc:=proc||'    provisoire BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    visible BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    contrepartie BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_journal_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING(128),\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_pointage (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    banque_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    date INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_banque (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_taxe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    taux NUMERIC(16,6) NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_acces (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64),\\n';\n  proc:=proc||'    valeur INTEGER UNIQUE NOT NULL\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compteperm (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    signe BOOLEAN,\\n';\n  proc:=proc||'    parent_compteperm_id INTEGER,\\n';\n  proc:=proc||'    general BOOLEAN,\\n';\n  proc:=proc||'    accept_aux BOOLEAN,\\n';\n  proc:=proc||'    utilisable BOOLEAN,\\n';\n  proc:=proc||'    lettrable BOOLEAN,\\n';\n  proc:=proc||'    pointable BOOLEAN,\\n';\n  proc:=proc||'    groupable BOOLEAN,\\n';\n  proc:=proc||'    echeance INTEGER DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compte (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    acces_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    exercice_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    signe BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    dernier_lettre CHARACTER VARYING(16),\\n';\n  proc:=proc||'    parent_id INTEGER,\\n';\n  proc:=proc||'    general BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    accept_aux BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    utilisable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    lettrable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    pointable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    groupable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    note CHARACTER VARYING\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compte_cumul (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    mois INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    annee INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  -- Indexes\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_parametre_code_index ON base_societe_parametre(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_service_code_index ON base_societe_service(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_etablissement_code_index ON base_societe_etablissement(code);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_langue_code_index ON base_partenaire(langue_code);\\n';\n  proc:=proc||'  CREATE  INDEX compta_compte_dernier_lettre_index ON compta_compte(dernier_lettre);\\n';\n  proc:=proc||'  -- Constraints\\n';\n  proc:=proc||'  RAISE NOTICE ''Contraintes'';\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint0 FOREIGN KEY (responsable_id) REFERENCES base_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint1 FOREIGN KEY (parent_service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint2 FOREIGN KEY (etablissement_id) REFERENCES base_societe_etablissement(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_etablissement ADD CONSTRAINT base_societe_etablissement_constraint0 FOREIGN KEY (adresse_id) REFERENCES base_partenaire_adresse(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint0 FOREIGN KEY (parent_partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint1 FOREIGN KEY (utilisateur_id) REFERENCES base_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint2 FOREIGN KEY (responsible_id) REFERENCES base_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint3 FOREIGN KEY (langue_code) REFERENCES base_langue(code);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint1 FOREIGN KEY (type_id) REFERENCES base_partenaire_attribut_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint2 FOREIGN KEY (categorie_id) REFERENCES base_partenaire_attribut_categorie(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_categorie ADD CONSTRAINT base_partenaire_attribut_categorie_constraint0 FOREIGN KEY (attribut_type_id) REFERENCES base_partenaire_attribut_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_constraint0 FOREIGN KEY (type_id) REFERENCES base_impression_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_constraint1 FOREIGN KEY (classe_id) REFERENCES base_impression_classe(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint0 FOREIGN KEY (compte_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint1 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint2 FOREIGN KEY (piece_id) REFERENCES compta_piece(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint3 FOREIGN KEY (pointage_id) REFERENCES compta_pointage(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint0 FOREIGN KEY (exercice_id) REFERENCES compta_exercice(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint1 FOREIGN KEY (journal_id) REFERENCES compta_journal(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint0 FOREIGN KEY (type_id) REFERENCES compta_journal_type(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint1 FOREIGN KEY (debit_compte_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_pointage ADD CONSTRAINT compta_pointage_constraint0 FOREIGN KEY (banque_id) REFERENCES compta_banque(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque ADD CONSTRAINT compta_banque_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_taxe ADD CONSTRAINT compta_taxe_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_acces ADD CONSTRAINT compta_acces_constraint0 CHECK (valeur>=0);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_constraint0 FOREIGN KEY (parent_compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint1 FOREIGN KEY (parent_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint2 FOREIGN KEY (acces_id) REFERENCES compta_acces(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint3 FOREIGN KEY (exercice_id) REFERENCES compta_exercice(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte_cumul ADD CONSTRAINT compta_compte_cumul_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  -- Data without triggers\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (1, ''DEFAUT'', ''Par dÃ©faut'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (2, ''DEVIS'', ''Devis'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (3, ''FACTURATION'', ''Facturation'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (4, ''LIVRAISON'', ''Livraison'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_adresse_type VALUES (5, ''CONTACT'', ''Contact'', true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_impression_classe VALUES (1, ''DEFAUT'', ''Par dÃ©faut'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_classe VALUES (2, ''LETTRE'', ''Correspondance'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (1, ''DEVIS'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (2, ''FACTURE'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (3, ''AVOIR'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (4, ''BALANCE'');\\n';\n  proc:=proc||'  INSERT INTO compta_exercice(code, date_debut, date_fin) VALUES (''EX200607'', ''01/09/2006'', ''31/08/2007'');\\n';\n  proc:=proc||'  INSERT INTO compta_acces VALUES (1, ''INVITE'', ''InvitÃ©'', 1000000);\\n';\n  proc:=proc||'  INSERT INTO compta_acces VALUES (2, ''EXPERTCO'', ''Expert comptable'', 0);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id) VALUES (6, ''Comptes de charges'', ''6'', NULL);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id) VALUES (7, ''Comptes de produits'', ''7'', NULL);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, general, parent_compteperm_id) VALUES (60, ''Achats (sauf 603)'', ''60'', true, 6);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id) VALUES (607, ''Achats de marchandises'', ''607'', 60);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general) VALUES (70, ''Ventes de produits fabriquÃ©s, prestations de services, marchandises'', ''70'', 7, true);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general) VALUES (706, ''Prestations de services'', ''706'', 70, true);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general) VALUES (709, ''Rabais, remises et ristournes accordÃ©s par l''''entreprise'', ''709'', 70, true);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general) VALUES (71, ''Production stockÃ©e (ou dÃ©stockage)'', ''71'', 7, true);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id) VALUES (713, ''Variation des stocks (en-cours de production, produits)'', ''713'', 71);\\n';\n  proc:=proc||'  -- Procedures\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION is_search_path(text) RETURNS boolean AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*)  FROM base.base_utilisateur WHERE login=$1 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN (total>0)::boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\\n';\n  proc:=proc||'  -- Triggers\\n';\n  proc:=proc||'  -- Data with triggers\\n';\n  proc:=proc||'  -- Sequences initialization\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_societe_parametre INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_societe_parametre_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_societe_service INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_societe_service_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_societe_etablissement INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_societe_etablissement_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_adresse INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_adresse_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_adresse_type INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_adresse_type_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_attribut INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_attribut_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_attribut_type INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_attribut_type_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_partenaire_attribut_categorie INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_partenaire_attribut_categorie_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_impression INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_impression_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_impression_classe INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_impression_classe_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM base_impression_type INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE base_impression_type_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_ecriture INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_ecriture_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_piece INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_piece_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_exercice INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_exercice_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_journal INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_journal_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_journal_type INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_journal_type_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_pointage INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_pointage_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_banque INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_banque_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_taxe INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_taxe_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_acces INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_acces_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_compteperm INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_compteperm_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_compte INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_compte_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  SELECT COALESCE(MAX(id),0)+1 FROM compta_compte_cumul INTO start_value;\\n';\n  proc:=proc||'  proc := ''ALTER SEQUENCE compta_compte_cumul_id_seq RESTART WITH ''||start_value;\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  CREATE TRIGGER basebase_societeTrigger BEFORE INSERT ON base_societe FOR EACH ROW EXECUTE PROCEDURE SYS_basebase_societeCreator();\n  RETURN 0;\n\nEND; $$ LANGUAGE 'plpgsql' VOLATILE;\n");
  if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage310[16384];
    snprintf(pMessage310,16380,"<error code=\"310\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R310> %s", pMessage310);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage310);
  }
fprintf(stderr, "7");
  sprintf(query,"SELECT pm__InitDatabase('%s', %s);",aDatabase,(aForce)?"true":"false");
  pResult = PQexec(gConn[pId], query);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage311[16384];
    snprintf(pMessage311,16380,"<error code=\"311\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R311> %s", pMessage311);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage311);
  }
fprintf(stderr, "8\n");
  return SOAP_OK;
}


