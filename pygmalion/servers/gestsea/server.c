/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
/* Generated by Pygmalion */
#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <time.h>
#include "libpq-fe.h"
#include "mozH.h"
#include "gestseaBinding.nsmap"

#include <unistd.h>
#define MAX_CONN 256

static char * gAlphabet = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@*=_-(){}[]#$%+|:;.,!?";
static unsigned short gFreeConnID[MAX_CONN];
static unsigned gFreeLast = MAX_CONN-1;
static PGconn * gConn[MAX_CONN];
static char * gKey[MAX_CONN];

/******************************************************************************\
 *
 *      Main
 *
\******************************************************************************/
int main(int argc, char * argv [])
{
  int m, s, i;
  struct soap soap;
  if (argc!=3) {
    fprintf(stderr, "Usage: server server.pem password\n");
    return 0;
  }
  for(i=0;i<MAX_CONN;i++) {
    gFreeConnID[i]=i;
    gConn[i]=NULL;
    gKey[i]=NULL;
  }
  /* init OpenSSL (just once) */
  soap_ssl_init();
  soap_init(&soap);
  if (soap_ssl_server_context(&soap,
                              SOAP_SSL_REQUIRE_SERVER_AUTHENTICATION,
                              argv[1], /* keyfile: required when server must authenticate to clients (see SSL docs on how to obtain this file) */
                              argv[2], /* password to read the key file */
                              NULL, /* optional cacert file to store trusted certificates */
                              NULL, /* optional capath to directory with trusted certificates */
                              NULL, /* DH file, if NULL use RSA */
                              NULL, /* if randfile!=NULL: use a file with random data to seed randomness */
                              NULL /* optional server identification to enable SSL session cache (must be a unique name) */    ))
    {
      soap_print_fault(&soap, stderr);
      exit(1);
    }
  m = soap_bind(&soap, NULL, 15743, 100); // use port 18000
  if (m < 0)
    {
      soap_print_fault(&soap, stderr);
      exit(1);
    }
  fprintf(stderr, "Socket connection successful: master socket = %d\n", m);
  for (;;)
    {
      s = soap_accept(&soap);
      if (s < 0)
        {
          if (soap.errnum)
            soap_print_fault(&soap, stderr);
          else
            fprintf(stderr, "Server timed out\n");
          break;
        }
      fprintf(stderr, "Socket %d connection from IP %d.%d.%d.%d\n", s, (int)(soap.ip>>24)&0xFF, (int)(soap.ip>>16)&0xFF, (int)(soap.ip>>8)&0xFF, (int)soap.ip&0xFF);
      if (soap_ssl_accept(&soap))
        {
          soap_print_fault(&soap, stderr);
          fprintf(stderr, "SSL request failed, continue with next call...\n");
          soap_end(&soap);
          continue;
        }
      soap_serve(&soap);
      soap_end(&soap);
    }
  soap_end(&soap);
  soap_done(&soap); /* deallocates SSL context */
  return 0;
}

/******************************************************************************\
 *
 *      Functions
 *
\******************************************************************************/

int createKey(unsigned short aId, char ** aKey)
{
  if (PQstatus(gConn[aId]) != CONNECTION_OK)
    return 0;
  char pAlea[11];
  float length = (float)(strlen(gAlphabet)-1)/RAND_MAX;
  srand(time(0)); //Initialisation du générateur
  pAlea[0]=gAlphabet[(int)((float)rand()*length)];
  pAlea[1]=gAlphabet[(int)((float)rand()*length)];
  pAlea[2]=gAlphabet[(int)((float)rand()*length)];
  pAlea[3]=gAlphabet[(int)((float)rand()*length)];
  pAlea[4]=gAlphabet[(int)((float)rand()*length)];
  pAlea[5]=gAlphabet[(int)((float)rand()*length)];
  pAlea[6]=gAlphabet[(int)((float)rand()*length)];
  pAlea[7]=gAlphabet[(int)((float)rand()*length)];
  pAlea[8]=gAlphabet[(int)((float)rand()*length)];
  pAlea[9]=gAlphabet[(int)((float)rand()*length)];
  pAlea[10]='\0';
  gKey[aId]=(char *)malloc(13*sizeof(char));
  sprintf(gKey[aId], "%02x%s", aId, pAlea);
  aKey[0]=strdup(gKey[aId]);
  return 1;
}

/******************************************************************************\
 *
 *      Service methods
 *
\******************************************************************************/

SOAP_FMAC5 int SOAP_FMAC6 moz1__Connect(struct soap* aSoap, char * aLogin, char * aPassword, char * aDatabase, char ** aKey)
{
  fprintf(stderr,"Connect\n");
  char pConninfo[1024];
  unsigned short pId;
  if (gFreeLast<=0) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S102> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"102\"/>");
  }
  pId = gFreeConnID[gFreeLast--];
  sprintf(pConninfo,"host='%s' dbname=%s user=%s password=%s sslmode=allow ",
	  "localhost", aDatabase, aLogin, aPassword);
  gConn[pId] = PQconnectdb(pConninfo);
  if (PQstatus(gConn[pId]) != CONNECTION_OK) {
    PQfinish(gConn[pId]);
    gFreeConnID[++gFreeLast] = pId;
    printf("Line %d\n",__LINE__);
    char pMessage103[16384];
    snprintf(pMessage103,16380,"<error code=\"103\">%s</error>", PQerrorMessage(gConn[pId]));
    fprintf(stderr, "R103> %s", pMessage103);
    return soap_receiver_fault(aSoap, "Connexion impossible", pMessage103);
  }
  if (!createKey(pId, aKey)) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S104> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"104\"/>");
  }
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__Finish(struct soap* aSoap, char * aKey, unsigned int * aResult)
{
  fprintf(stderr,"Finish\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  *aResult = 0;
  if (gConn[pId]!=NULL) {
    if (PQstatus(gConn[pId]) == CONNECTION_OK) {
      PQfinish(gConn[pId]);
      gFreeConnID[++gFreeLast]=pId;
      *aResult = 1;
    }
  }
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__Setup(struct soap* aSoap, char * aKey, struct moz1__SetupResponse * aReturn)
{
  fprintf(stderr,"Setup\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  aReturn->name = strdup("gestsea");
  aReturn->uuid = strdup("94c4a73a-37d7-40af-b236-13cf291109fb");
  aReturn->version = strdup("1");
  PGresult * pResult = PQexec(gConn[pId], "SELECT COUNT(*) FROM information_schema.routines WHERE routine_name='set_search_path' AND routine_schema='systeme';");
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage302[16384];
    snprintf(pMessage302,16380,"<error code=\"302\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R302> %s", pMessage302);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage302);
  }
  aReturn->state = strdup(PQgetvalue(pResult,0,0));
  PQclear(pResult);
  if (strcmp(aReturn->state,"0")!=0) {
    pResult = PQexec(gConn[pId], "SELECT systeme.set_search_path(false);");
    if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
      printf("Line %d\n",__LINE__);
      fprintf(stderr, "S105> Connexion impossible");
      return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"105\"/>");
    }
    PQclear(pResult);
  }
  pResult = PQexec(gConn[pId], "SELECT CASE WHEN usesuper THEN 'superuser' ELSE 'normal' END FROM pg_catalog.pg_user WHERE usename=current_user;");
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage303[16384];
    snprintf(pMessage303,16380,"<error code=\"303\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R303> %s", pMessage303);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage303);
  }
  aReturn->userType = strdup(PQgetvalue(pResult,0,0));
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__Prepare(struct soap* aSoap, char * aKey, char * aQuery, char * aName, unsigned int aArity, unsigned int * aResult)
{
  fprintf(stderr,"Prepare\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  PGresult * pResult = PQprepare(gConn[pId], aName, aQuery, aArity, NULL);
  if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage312[16384];
    snprintf(pMessage312,16380,"<error code=\"312\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R312> %s", pMessage312);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage312);
  }
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__PrepareList(struct soap* aSoap, char * aKey, struct moz1__sqlQueryList * aQueries, unsigned int * aResult)
{
  fprintf(stderr,"PrepareList\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  PGresult * pResult;
  unsigned int i,n;
  n = aQueries->__sizedef;
  for (i=0;i<n;i++){
    pResult = PQprepare(gConn[pId], aQueries->def[i].name, aQueries->def[i].query, aQueries->def[i].arity, NULL);
    if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage312[16384];
      snprintf(pMessage312,16380,"<error code=\"312\">%s</error>", PQresultErrorMessage(pResult));
      PQclear(pResult);
      fprintf(stderr, "R312> %s", pMessage312);
      return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage312);
    }
  }
  if (n>0) PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__ExecPreparedSelect(struct soap* aSoap, char * aKey, char * aName, struct moz1__sqlLine * aParams, struct moz1__ExecPreparedSelectResponse * aReturn)
{
  fprintf(stderr,"ExecPreparedSelect\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  unsigned int i,j,n,m;
  char ** line;
  PGresult * pResult = PQexecPrepared(gConn[pId], aName, aParams->__sizev, (const char * const *)aParams->v, NULL, NULL, 0);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage313[16384];
    snprintf(pMessage313,16380,"<error code=\"313\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R313> %s", pMessage313);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage313);
  }
  aReturn->result=(struct moz1__sqlTable *)malloc(sizeof(struct moz1__sqlTable));
  struct moz1__sqlTable * pTable=aReturn->result;
  m=PQnfields(pResult);
  n=PQntuples(pResult);
  pTable->__sizel=n;
  pTable->l=(struct moz1__sqlLine*)malloc(n*sizeof(struct moz1__sqlLine));
  for (i=0;i<n;i++) {
    pTable->l[i].__sizev=m;
    pTable->l[i].v=(char**)malloc(m*sizeof(char*));
    line=pTable->l[i].v;
    for (j=0;j<m;j++)
      line[j] = strdup(PQgetvalue(pResult,i,j));
  }
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__ExecPreparedUpdate(struct soap* aSoap, char * aKey, char * aName, struct moz1__sqlLine * aParams, char ** aResult)
{
  fprintf(stderr,"ExecPreparedUpdate\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  PGresult * pResult = PQexecPrepared(gConn[pId], aName, aParams->__sizev, (const char * const *)aParams->v, NULL, NULL, 0);
  if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage314[16384];
    snprintf(pMessage314,16380,"<error code=\"314\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R314> %s", pMessage314);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage314);
  }
  *aResult=strdup(PQcmdTuples(pResult));
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__ExecSelect(struct soap* aSoap, char * aKey, char * aQuery, struct moz1__sqlLine * aParams, struct moz1__ExecSelectResponse * aReturn)
{
  fprintf(stderr,"ExecSelect\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  unsigned int i,j,n,m;
  char ** line;
  PGresult * pResult = PQexecParams(gConn[pId], aQuery, aParams->__sizev, NULL, (const char * const *)aParams->v, NULL, NULL, 0);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage315[16384];
    snprintf(pMessage315,16380,"<error code=\"315\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R315> %s", pMessage315);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage315);
  }
  aReturn->result=(struct moz1__sqlTable *)malloc(sizeof(struct moz1__sqlTable));
  struct moz1__sqlTable * pTable=aReturn->result;
  m=PQnfields(pResult);
  n=PQntuples(pResult);
  pTable->__sizel=n;
  pTable->l=(struct moz1__sqlLine*)malloc(n*sizeof(struct moz1__sqlLine));
  for (i=0;i<n;i++) {
    pTable->l[i].__sizev=m;
    pTable->l[i].v=(char**)malloc(m*sizeof(char*));
    line=pTable->l[i].v;
    for (j=0;j<m;j++) {
      line[j] = strdup(PQgetvalue(pResult,i,j));
      fprintf(stdout," | %s",line[j]);
    }
    fprintf(stdout,"\n");
  }
  fprintf(stdout,"[");
  PQclear(pResult);
  fprintf(stdout,"]\n");
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__ExecUpdate(struct soap* aSoap, char * aKey, char * aQuery, struct moz1__sqlLine * aParams, char ** aResult)
{
  fprintf(stderr,"ExecUpdate\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  int i;
  for (i=0;i<aParams->__sizev;i++)
    if (strlen(aParams->v[i])==0) aParams->v[i]=NULL;
  PGresult * pResult = PQexecParams(gConn[pId], aQuery, aParams->__sizev,NULL,  (const char * const *)aParams->v, NULL, NULL, 0);
  if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage314[16384];
    snprintf(pMessage314,16380,"<error code=\"314\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R314> %s", pMessage314);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage314);
  }
  *aResult=strdup(PQcmdTuples(pResult));
  PQclear(pResult);
  return SOAP_OK;
}


SOAP_FMAC5 int SOAP_FMAC6 moz1__Init(struct soap* aSoap, char * aKey, char * aDatabase, enum xsd__boolean aForce, unsigned int * aResult)
{
  fprintf(stderr,"Init\n");
  unsigned short pId;
  char pPrefix[3];
  pPrefix[0]=aKey[0];
  pPrefix[1]=aKey[1];
  pPrefix[2]='\0';
  pId = strtol(pPrefix,NULL,16);
  if (gKey[pId][2]!=aKey[2]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][3]!=aKey[3]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][4]!=aKey[4]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][5]!=aKey[5]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][6]!=aKey[6]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][7]!=aKey[7]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][8]!=aKey[8]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gKey[pId][9]!=aKey[9]) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S101> Connexion impossible");
    return soap_sender_fault(aSoap, "Connexion impossible", "<error code=\"101\"/>");
  }
  if (gConn[pId] == NULL) {
    printf("Line %d\n",__LINE__);
    fprintf(stderr, "S201> Non connecté");
    return soap_sender_fault(aSoap, "Non connecté", "<error code=\"201\"/>");
  } else {
    if (PQstatus(gConn[pId]) == CONNECTION_BAD) {
      PQreset(gConn[pId]);
    }
    if (PQstatus(gConn[pId]) != CONNECTION_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage202[16384];
      snprintf(pMessage202,16380,"<error code=\"202\">%s</error>", PQerrorMessage(gConn[pId]));
      fprintf(stderr, "R202> %s", pMessage202);
      return soap_receiver_fault(aSoap, "Non connecté", pMessage202);
    }
  }

  char query[1024];
  PGresult * pResult;
  fprintf(stderr, "0");
  sprintf(query,"SELECT count(*) FROM pg_database WHERE datname='%s';",aDatabase);
  pResult = PQexec(gConn[pId], query);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage305[16384];
    snprintf(pMessage305,16380,"<error code=\"305\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R305> %s", pMessage305);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage305);
  }

  fprintf(stderr, "1");
  if (strcmp(PQgetvalue(pResult,0,0),"0")==0) {
    fprintf(stderr, "2");
    sprintf(query,"CREATE DATABASE %s ENCODING 'UTF-8';", aDatabase);
    pResult = PQexec(gConn[pId], query);
    if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage306[16384];
      snprintf(pMessage306,16380,"<error code=\"306\">%s</error>", PQresultErrorMessage(pResult));
      PQclear(pResult);
      fprintf(stderr, "R306> %s", pMessage306);
      return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage306);
    }
    *aResult = 157;
    return SOAP_OK;
  } else {
    fprintf(stderr, "3");
    sprintf(query,"SELECT CASE WHEN current_database()='%s' THEN '1' ELSE '0' END;", aDatabase);
    pResult = PQexec(gConn[pId], query);
    if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
      printf("Line %d\n",__LINE__);
      char pMessage307[16384];
      snprintf(pMessage307,16380,"<error code=\"307\">%s</error>", PQresultErrorMessage(pResult));
      PQclear(pResult);
      fprintf(stderr, "R307> %s", pMessage307);
      return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage307);
    }
    fprintf(stderr, "(%s)",PQgetvalue(pResult,0,0));
    if (strcmp(PQgetvalue(pResult,0,0),"0")==0) {
      fprintf(stderr, "4");
      *aResult = 159;
      return SOAP_OK;
    }
  }
  fprintf(stderr, "5(%s)", aDatabase);
  sprintf(query,"SELECT count(*) FROM pg_language WHERE lanname LIKE 'plpgsql';");
  pResult = PQexec(gConn[pId], query);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage308[16384];
    snprintf(pMessage308,16380,"<error code=\"308\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R308> %s", pMessage308);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage308);
  } else {
    if (strcmp(PQgetvalue(pResult,0,0),"0")==0) {
      sprintf(query,"CREATE LANGUAGE \"plpgsql\";");
      pResult = PQexec(gConn[pId], query);
      if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
        printf("Line %d\n",__LINE__);
        char pMessage309[16384];
        snprintf(pMessage309,16380,"<error code=\"309\">%s</error>", PQresultErrorMessage(pResult));
        PQclear(pResult);
        fprintf(stderr, "R309> %s", pMessage309);
        return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage309);
      }
    }
  }
fprintf(stderr, "6");
  pResult = PQexec(gConn[pId], "CREATE OR REPLACE FUNCTION pm__InitDatabase(text,boolean) RETURNS INTEGER AS\n$$\nDECLARE\n  TheDatabase ALIAS FOR $1;\n  ForceInit ALIAS FOR $2;\n  query text;\n  schema_name varchar;\n  proc text;\n  start_value integer;\nBEGIN\n\n\n  --\n  -- Schema: systeme\n  --\n\n  CREATE SCHEMA systeme;\n  schema_name := 'systeme'::varchar;\n  SET search_path to systeme;\n  CREATE TABLE systeme_schema (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(32) UNIQUE NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_utilisateur (\n    id SERIAL NOT NULL PRIMARY KEY,\n    login CHARACTER VARYING(32) UNIQUE NOT NULL,\n    password CHARACTER VARYING(32) NOT NULL DEFAULT '**********',\n    email CHARACTER VARYING(128),\n    can_login BOOLEAN NOT NULL DEFAULT false,\n    deja_present BOOLEAN NOT NULL DEFAULT false,\n    superuser BOOLEAN NOT NULL DEFAULT false,\n    createrole BOOLEAN NOT NULL DEFAULT false,\n    maxconn INTEGER NOT NULL DEFAULT -1,\n    jusqua DATE,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL,\n    requete CHARACTER VARYING NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction_parametre (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(64) NOT NULL,\n    extraction_id INTEGER NOT NULL,\n    type_id INTEGER NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction_parametre_type (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL,\n    type_base INTEGER NOT NULL,\n    lien BOOLEAN NOT NULL DEFAULT false,\n    table_etrangere CHARACTER VARYING(64),\n    cle_etrangere CHARACTER VARYING(64),\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction_execution (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(64) NOT NULL,\n    extraction_id INTEGER NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction_execution_parametre (\n    id SERIAL NOT NULL PRIMARY KEY,\n    valeur CHARACTER VARYING NOT NULL,\n    parametre_id INTEGER NOT NULL,\n    execution_id INTEGER NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  -- Indexes\n  -- Constraints\n  RAISE NOTICE 'Contraintes';\n  ALTER TABLE systeme_schema ADD CONSTRAINT systeme_schema_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_schema ADD CONSTRAINT systeme_schema_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_utilisateur ADD CONSTRAINT systeme_utilisateur_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_utilisateur ADD CONSTRAINT systeme_utilisateur_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction ADD CONSTRAINT systeme_extraction_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction ADD CONSTRAINT systeme_extraction_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_parametre ADD CONSTRAINT systeme_extraction_parametre_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_parametre ADD CONSTRAINT systeme_extraction_parametre_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_parametre ADD CONSTRAINT systeme_extraction_parametre_constraint0 FOREIGN KEY (extraction_id) REFERENCES systeme_extraction(id);\n  ALTER TABLE systeme_extraction_parametre ADD CONSTRAINT systeme_extraction_parametre_constraint1 FOREIGN KEY (type_id) REFERENCES systeme_extraction_parametre_type(id);\n  ALTER TABLE systeme_extraction_parametre_type ADD CONSTRAINT systeme_extraction_parametre_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_parametre_type ADD CONSTRAINT systeme_extraction_parametre_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution ADD CONSTRAINT systeme_extraction_execution_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution ADD CONSTRAINT systeme_extraction_execution_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution ADD CONSTRAINT systeme_extraction_execution_constraint0 FOREIGN KEY (extraction_id) REFERENCES systeme_extraction(id);\n  ALTER TABLE systeme_extraction_execution_parametre ADD CONSTRAINT systeme_extraction_execution_parametre_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution_parametre ADD CONSTRAINT systeme_extraction_execution_parametre_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution_parametre ADD CONSTRAINT systeme_extraction_execution_parametre_constraint0 FOREIGN KEY (execution_id) REFERENCES systeme_extraction_execution(id);\n  ALTER TABLE systeme_extraction_execution_parametre ADD CONSTRAINT systeme_extraction_execution_parametre_constraint1 FOREIGN KEY (parametre_id) REFERENCES systeme_extraction_parametre(id);\n  -- Data without triggers\n  INSERT INTO systeme_utilisateur(login, deja_present) VALUES ('brice', true);\n  INSERT INTO systeme_extraction_parametre_type(code, nom, type_base) VALUES ('INTE', 'Entier', 1);\n  INSERT INTO systeme_extraction_parametre_type(code, nom, type_base) VALUES ('REAL', 'RÃ©el', 2);\n  INSERT INTO systeme_extraction_parametre_type(code, nom, type_base) VALUES ('BOOL', 'BoolÃ©en', 3);\n  INSERT INTO systeme_extraction_parametre_type(code, nom, type_base) VALUES ('TEXT', 'Texte', 4);\n  -- Procedures\n  proc:='CREATE OR REPLACE FUNCTION tg_manage_role() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  mdp text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  mdp:=''**********'';\\n';\n  proc:=proc||'  IF TG_OP=''INSERT''  THEN\\n';\n  proc:=proc||'    NEW.login:=LOWER(REPLACE(NEW.login,'' '',''''));\\n';\n  proc:=proc||'    IF NOT NEW.deja_present THEN\\n';\n  proc:=proc||'      query:=''CREATE ROLE ''||NEW.login||'' NOCREATEDB '';\\n';\n  proc:=proc||'      IF NOT NEW.createrole THEN\\n';\n  proc:=proc||'        query:=query||''NO'';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      query:=query||''CREATEROLE '';\\n';\n  proc:=proc||'      IF NOT NEW.superuper THEN\\n';\n  proc:=proc||'        query:=query||''NO'';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      query:=query||''SUPERUSER'';\\n';\n  proc:=proc||'      query:=query||'' LOGIN'';\\n';\n  proc:=proc||'      query:=query||'' ENCRYPTED PASSWORD ''''''||NEW.password||'''''';'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    NEW.password:=mdp;\\n';\n  proc:=proc||'    RETURN NEW;\\n';\n  proc:=proc||'  ELSIF TG_OP=''UPDATE'' THEN\\n';\n  proc:=proc||'    NEW.login:=LOWER(REPLACE(NEW.login,'' '',''''));\\n';\n  proc:=proc||'    IF NEW.login!=OLD.login THEN\\n';\n  proc:=proc||'      query:=''ALTER ROLE ''||OLD.login||'' RENAME TO ''||NEW.login||'';'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    IF NEW.password!=OLD.password THEN\\n';\n  proc:=proc||'      query:=''ALTER ROLE ''||NEW.login||'' ENCRYPTED PASSWORD ''''''||NEW.password||'''''';'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'      New.EM_Password:=mdp;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    IF NEW.superuser!=OLD.superuser THEN\\n';\n  proc:=proc||'      query:=''ALTER ROLE ''||NEW.login;\\n';\n  proc:=proc||'      IF NOT NEW.superuser THEN\\n';\n  proc:=proc||'        query:=query||''NO'';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      query:=query||''SUPERUSER'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    IF NEW.createrole!=OLD.createrole THEN\\n';\n  proc:=proc||'      query:=''ALTER ROLE ''||NEW.login;\\n';\n  proc:=proc||'      IF NOT NEW.createrole THEN\\n';\n  proc:=proc||'        query:=query||''NO'';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      query:=query||''CREATEROLE'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    RETURN NEW;\\n';\n  proc:=proc||'  ELSIF TG_OP=''DELETE'' THEN\\n';\n  proc:=proc||'    query:=''DROP ROLE ''||OLD.login;\\n';\n  proc:=proc||'    EXECUTE query;\\n';\n  proc:=proc||'    RETURN OLD;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION soundex2(IN a_mot CHARACTER VARYING) RETURNS CHARACTER VARYING(4) AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot text;\\n';\n  proc:=proc||'  car varchar(1);\\n';\n  proc:=proc||'  n integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT LOWER(TRIM(a_mot)) INTO mot;\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¢'',''a'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¤'',''a'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã '',''a'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ãª'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã«'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Å'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã©'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¨'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã®'',''i'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¯'',''i'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¬'',''i'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã´'',''o'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¶'',''o'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã²'',''o'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã»'',''u'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¼'',''u'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¹'',''u'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Å·'',''y'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¿'',''y'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''á»³'',''y'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã§'',''c'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''.'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'','','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'':'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'';'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''?'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''!'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''('','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'')'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''-'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''+'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'' '','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''_'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''#'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''*'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'','','''');\\n';\n  proc:=proc||'  mot := UPPER(mot);\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GUI'',''KI'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GUE'',''KE'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GA'',''KA'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GO'',''KO'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GU'',''K'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CA'',''KA'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CO'',''KO'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CU'',''KU'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Q'', ''K'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CC'',''K'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CK'',''K'');\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  IF SUBSTR(mot,1,1)!=''A'' THEN\\n';\n  proc:=proc||'    mot := REPLACE(mot,''E'',''A'');\\n';\n  proc:=proc||'    mot := REPLACE(mot,''I'',''A'');\\n';\n  proc:=proc||'    mot := REPLACE(mot,''O'',''A'');\\n';\n  proc:=proc||'    mot := REPLACE(mot,''U'',''A'');\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  \\n';\n  proc:=proc||'  mot := REPLACE(mot,''MAC'',''MCC'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''ASA'',''AZA'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''KN'', ''NN'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''PF'', ''FF'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''SCH'',''SSS'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''PH'', ''FF'');\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CH'',''#'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''SH'',''*'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''H'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''#'',''CH'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''*'',''SH'');\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot := REPLACE(mot,''AY'',''#'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Y'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''#'',''AY'');\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  car := SUBSTR(mot,LENGTH(mot),1);\\n';\n  proc:=proc||'  IF car=''A'' OR car=''T'' OR car=''D'' OR car=''S'' THEN\\n';\n  proc:=proc||'    mot := SUBSTR(mot,1,LENGTH(mot)-1);\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  car := SUBSTR(mot,1,1);\\n';\n  proc:=proc||'  mot := car||REPLACE(SUBSTR(mot,2,LENGTH(mot)),''A'','''');\\n';\n  proc:=proc||' \\n';\n  proc:=proc||'  FOR n IN 2..LENGTH(mot) LOOP\\n';\n  proc:=proc||'    car := SUBSTR(mot, n, 1);\\n';\n  proc:=proc||'    IF car=SUBSTR(mot, n-1, 1) THEN\\n';\n  proc:=proc||'      mot := SUBSTR(mot, 1, n-1)||SUBSTR(mot, n+1, LENGTH(mot));\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END LOOP;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot := SUBSTR(mot||''    '',1,4);\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  RETURN mot;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION phonex(IN a_mot CHARACTER VARYING) RETURNS DOUBLE PRECISION AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN 0;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION print(IN print_code CHARACTER VARYING(128),IN print_id INTEGER) RETURNS CHARACTER VARYING AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  ret text;\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  total integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  ret:='''';\\n';\n  proc:=proc||'  SELECT count(*) FROM base_impression WHERE code=print_code INTO total;\\n';\n  proc:=proc||'  IF total=1 THEN\\n';\n  proc:=proc||'    query:=''SELECT prPDF_''||print_code||''(''||print_id||'')'';\\n';\n  proc:=proc||'    EXECUTE query INTO ret;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN ret;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION fc_build_printer(IN pfb_schema CHARACTER VARYING,IN pfb_modele CHARACTER VARYING,IN pfb_nom CHARACTER VARYING,IN pfb_tmpdir CHARACTER VARYING) RETURNS INTEGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  fonction     text;\\n';\n  proc:=proc||'  query        text;\\n';\n  proc:=proc||'  q_select     text;\\n';\n  proc:=proc||'  q_suite      text;\\n';\n  proc:=proc||'  q_as         text;\\n';\n  proc:=proc||'  entete       text;\\n';\n  proc:=proc||'  cond         text;\\n';\n  proc:=proc||'  compteur     integer;\\n';\n  proc:=proc||'  ligne        text;\\n';\n  proc:=proc||'  number       integer;\\n';\n  proc:=proc||'  plast        integer; -- prodondeur de bloc\\n';\n  proc:=proc||'  last         integer[64]; -- 0 BEGIN  1 IF  2 ELSE\\n';\n  proc:=proc||'  pparam       integer; -- profondeur parametrique\\n';\n  proc:=proc||'  nbparam      integer[64]; -- nombre de param\\n';\n  proc:=proc||'  numvar       integer[64]; -- numero des records\\n';\n  proc:=proc||'  param        text;\\n';\n  proc:=proc||'  nparam       integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  compteur:=0;\\n';\n  proc:=proc||'  plast   :=0;\\n';\n  proc:=proc||'  pparam  :=0;\\n';\n  proc:=proc||'  entete:=''CREATE OR REPLACE FUNCTION ''||pfb_schema||''.''||pfb_nom||''(IN pkey INTEGER) RETURNS text AS \\\\\\\\n \\\\\\\\$\\\\\\\\$\\\\\\\\n DECLARE\\\\\\\\n'';\\n';\n  proc:=proc||'  entete:=entete||''  doc    text;\\\\\\\\n'';\\n';\n  proc:=proc||'  entete:=entete||''  source text;\\\\\\\\n'';\\n';\n  proc:=proc||'  entete:=entete||''  cible  text;\\\\\\\\n'';\\n';\n  proc:=proc||'  entete:=entete||''  res    integer;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:='''';\\n';\n  proc:=proc||'  fonction:=fonction||''BEGIN\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  doc:=\\\\''\\\\'';\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  SELECT to_char(CURRENT_TIMESTAMP,\\\\''YYYYMMDD_HH24MISSMS\\\\'') INTO source;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  cible :=current_user||\\\\''_''||pfb_nom||''_\\\\''||source||\\\\''.pdf\\\\'';\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  source:=current_user||\\\\''_''||pfb_nom||''_\\\\''||source||\\\\''.tex\\\\'';\\\\\\\\n'';\\n';\n  proc:=proc||'--  fonction:=fonction||''  RAISE NOTICE \\\\''>> %\\\\'',source;\\\\\\\\n'';\\n';\n  proc:=proc||'  ligne   :=''\\\\% Genere par Brice Texier'';\\n';\n  proc:=proc||'  number  :=1;\\n';\n  proc:=proc||'  WHILE NOT ligne ILIKE ''%\\\\\\\\end{document}%'' LOOP\\n';\n  proc:=proc||'-- traitement de la ligne\\n';\n  proc:=proc||'--    ligne:=replace(ligne,'':NUMBER:'',number);\\n';\n  proc:=proc||'    fonction:=fonction||repeat(''  '',plast);\\n';\n  proc:=proc||'    IF ligne LIKE ''\\\\%%BEGIN:%SELECT%'' THEN\\n';\n  proc:=proc||'      query   :=SUBSTRING(ligne FROM POSITION(''BEGIN:'' IN ligne)+6);\\n';\n  proc:=proc||'            query   :=SUBSTRING(query FOR LENGTH(query)-1);\\n';\n  proc:=proc||'      query   :=REPLACE(query,'':KEY:'',''pkey'');\\n';\n  proc:=proc||'      q_select:=SUBSTRING(query FROM POSITION(''SELECT'' IN query)+6);\\n';\n  proc:=proc||'      q_suite :='''';\\n';\n  proc:=proc||'      IF POSITION(''FROM'' IN q_select)>0 THEN\\n';\n  proc:=proc||'        q_select:=SUBSTRING(q_select FOR POSITION(''FROM'' IN q_select)-1);\\n';\n  proc:=proc||'        q_suite :=SUBSTRING(query FROM POSITION(''FROM'' IN query));\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'--      RAISE NOTICE ''q_select (%)'',q_select;\\n';\n  proc:=proc||'      nparam:=0;\\n';\n  proc:=proc||'      q_as  :='''';\\n';\n  proc:=proc||'      LOOP\\n';\n  proc:=proc||'        nparam := nparam+1;\\n';\n  proc:=proc||'        param  := SPLIT_PART(q_select,'','',nparam);\\n';\n  proc:=proc||'        IF REPLACE(param,'' '','''')='''' THEN\\n';\n  proc:=proc||'          EXIT;\\n';\n  proc:=proc||'        END IF;\\n';\n  proc:=proc||'        IF q_as!='''' THEN\\n';\n  proc:=proc||'          q_as:=q_as||'', '';\\n';\n  proc:=proc||'        END IF;\\n';\n  proc:=proc||'        IF POSITION(''DISTINCT'' IN param)>0 THEN\\n';\n  proc:=proc||'          param:=SUBSTRING(param FROM POSITION(''DISTINCT'' IN param)+8);\\n';\n  proc:=proc||'          q_as:=q_as||''DISTINCT '';\\n';\n  proc:=proc||'        END IF;\\n';\n  proc:=proc||'        q_as:=q_as||''REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(COALESCE((''||param||'')::text,\\\\''\\\\''),\\\\''\\\\$\\\\'',\\\\''\\\\\\\\\\\\\\\\\\\\$\\\\''),\\\\''%\\\\'',\\\\''\\\\\\\\\\\\\\\\%\\\\''),\\\\''[\\\\'',\\\\''\\\\\\\\$[\\\\\\\\$\\\\''),\\\\'']\\\\'',\\\\''\\\\\\\\$]\\\\\\\\$\\\\''),\\\\''&\\\\'',\\\\''\\\\\\\\\\\\\\\\&\\\\'') AS p''||nparam;\\n';\n  proc:=proc||'      END LOOP;\\n';\n  proc:=proc||'      query:=''SELECT ''||q_as||'' ''||q_suite;\\n';\n  proc:=proc||'  --    RAISE NOTICE ''query %'',query;\\n';\n  proc:=proc||'      IF pparam>0 THEN\\n';\n  proc:=proc||'        FOR i IN 1..nbparam[pparam] LOOP\\n';\n  proc:=proc||'          query:=REPLACE(query,''<''||i-1||''>'',''record''||numvar[pparam]||''.p''||i);\\n';\n  proc:=proc||'        END LOOP;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'      compteur       := compteur+1;\\n';\n  proc:=proc||'      plast          := plast+1;\\n';\n  proc:=proc||'      last[plast]    := 0;\\n';\n  proc:=proc||'      pparam         := pparam+1;\\n';\n  proc:=proc||'      nbparam[pparam]:= nparam-1;\\n';\n  proc:=proc||'      numvar[pparam] := compteur;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'      fonction:=fonction||''  FOR record''||compteur||'' IN ''||query||'' LOOP\\\\\\\\n'';\\n';\n  proc:=proc||'      entete:=entete||''  record''||compteur||'' record;\\\\\\\\n'';\\n';\n  proc:=proc||'    ELSIF ligne LIKE ''\\\\%%IF:%'' THEN\\n';\n  proc:=proc||'      cond:=SUBSTRING(ligne FROM POSITION(''IF:'' IN ligne)+3);\\n';\n  proc:=proc||'      cond:=REPLACE(cond,'':KEY:'',''pkey'');\\n';\n  proc:=proc||'      IF pparam>0 THEN\\n';\n  proc:=proc||'        FOR i IN 1..nbparam[pparam] LOOP\\n';\n  proc:=proc||'          cond:=REPLACE(cond,''<''||i-1||''>'',''record''||numvar[pparam]||''.p''||i);\\n';\n  proc:=proc||'        END LOOP;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      fonction:=fonction||''  IF (''||cond||'')::boolean THEN\\\\\\\\n'';\\n';\n  proc:=proc||'      plast          := plast+1;\\n';\n  proc:=proc||'      last[plast]    := 1;\\n';\n  proc:=proc||'    ELSIF ligne LIKE ''\\\\%%ELSE'' THEN\\n';\n  proc:=proc||'      fonction:=fonction||''ELSE\\\\\\\\n'';\\n';\n  proc:=proc||'    ELSIF ligne LIKE ''\\\\%%END%'' THEN\\n';\n  proc:=proc||'--      RAISE NOTICE ''END % %'',plast,compteur;\\n';\n  proc:=proc||'      IF plast<=0 THEN\\n';\n  proc:=proc||'        RAISE EXCEPTION ''Le modÃ¨le est mal formatÃ©. Un END est inattendu. Ligne %'', number;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      IF last[plast]=0	 THEN\\n';\n  proc:=proc||'        fonction:=fonction||''END LOOP;\\\\\\\\n'';\\n';\n  proc:=proc||'        plast :=plast-1;\\n';\n  proc:=proc||'        pparam:=pparam-1;\\n';\n  proc:=proc||'      ELSIF last[plast]=1 THEN\\n';\n  proc:=proc||'        fonction:=fonction||''END IF;\\\\\\\\n'';\\n';\n  proc:=proc||'        plast :=plast-1;\\n';\n  proc:=proc||'      ELSE\\n';\n  proc:=proc||'        RAISE EXCEPTION ''Le modÃ¨le est mal formatÃ©. Type de boucle inconnu. Ligne %'', number;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'    ELSE      \\n';\n  proc:=proc||'      ligne:=''  doc:=doc||''||quote_literal(ligne)||''||\\\\''\\\\\\\\\\\\n\\\\''''||'';\\\\\\\\n'';\\n';\n  proc:=proc||'      IF pparam>0 THEN\\n';\n  proc:=proc||'        FOR i IN 1..nbparam[pparam] LOOP\\n';\n  proc:=proc||'          ligne:=REPLACE(ligne,''<''||i-1||''>'',''\\\\''||record''||numvar[pparam]||''.p''||i||''||\\\\'''');\\n';\n  proc:=proc||'        END LOOP;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      fonction:=fonction||ligne;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'    END IF;    \\n';\n  proc:=proc||'    ligne:=split_part(pfb_modele,''\\\\\\\\n'',number);\\n';\n  proc:=proc||'    number:=number+1;\\n';\n  proc:=proc||'  END LOOP;\\n';\n  proc:=proc||'  fonction:=fonction||''  doc:=doc||\\\\''\\\\\\\\\\\\\\\\end{document}\\\\'';\\\\\\\\n'';\\n';\n  proc:=proc||'--  fonction:=fonction||''  RAISE NOTICE \\\\''[%]\\\\'', doc;\\\\\\\\n'';\\n';\n  proc:=proc||' \\n';\n  proc:=proc||'  fonction:=fonction||''  SELECT writefile(\\\\''''||pfb_tmpdir||''/\\\\''||source,doc) INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  SELECT execution(\\\\''chmod 777 ''||pfb_tmpdir||''/\\\\''||source) INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  SELECT execution(\\\\''cd ''||pfb_tmpdir||'' ; pdflatex \\\\''||source||\\\\'' ; pdflatex \\\\''||source||\\\\'' ; chmod 755 \\\\''||cible||\\\\'' ;\\\\'') INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'--    fonction:=fonction||''  SELECT execution(\\\\''cd ''||pfb_tmpdir||'' ; pdflatex \\\\''||source||\\\\'' ; pdflatex \\\\''||source||\\\\'' ; chmod 755 \\\\''||cible||\\\\'' ; rm -f \\\\''||source) INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'--    fonction=fonction||''  SELECT execution(\\\\''rm -f ''||pfb_tmpdir||''/\\\\''||source) INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  RETURN \\\\''file://''||pfb_tmpdir||''/\\\\''||cible;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''END;\\\\\\\\n\\\\\\\\$\\\\\\\\$ LANGUAGE \\\\''plpgsql\\\\'' VOLATILE;'';\\n';\n  proc:=proc||'  fonction:=entete||fonction;\\n';\n  proc:=proc||'-- Execution de la requete\\n';\n  proc:=proc||'--  RAISE NOTICE ''=> %'', pfb_modele;\\n';\n  proc:=proc||'--  RAISE NOTICE ''=>  %'', fonction;\\n';\n  proc:=proc||'  EXECUTE fonction;\\n';\n  proc:=proc||'  \\n';\n  proc:=proc||'  RETURN 0; \\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION update_controls() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  IF TG_OP=''INSERT'' THEN\\n';\n  proc:=proc||'    SELECT id, CURRENT_TIMESTAMP FROM systeme.systeme_utilisateur WHERE login=CURRENT_USER INTO NEW.insert_uid, NEW.insert_date;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF TG_OP=''UPDATE'' THEN\\n';\n  proc:=proc||'    NEW.insert_uid  := OLD.insert_uid;\\n';\n  proc:=proc||'    NEW.insert_date := OLD.insert_date;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  SELECT id, CURRENT_TIMESTAMP FROM systeme.systeme_utilisateur WHERE login=CURRENT_USER INTO NEW.update_uid, NEW.update_date;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION set_search_path(IN only_static boolean) RETURNS text AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'  s record;\\n';\n  proc:=proc||'  is_search_path boolean;\\n';\n  proc:=proc||'  rpath text;\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  rpath:='''';\\n';\n  proc:=proc||'  FOR s IN SELECT nom FROM systeme.systeme_schema ORDER BY id LOOP\\n';\n  proc:=proc||'    query:=''SELECT ''||s.nom||''.is_search_path(current_user::text, ''||CASE WHEN only_static THEN ''true'' ELSE ''false'' END||'');'';\\n';\n  proc:=proc||'    EXECUTE query INTO is_search_path;\\n';\n  proc:=proc||'    IF is_search_path THEN\\n';\n  proc:=proc||'      IF LENGTH(rpath)>0 THEN\\n';\n  proc:=proc||'        rpath:=rpath||'','';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      rpath:=rpath||s.nom;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END LOOP;\\n';\n  proc:=proc||'  IF rpath IS NOT NULL THEN\\n';\n  proc:=proc||'    query:=''SET SEARCH_PATH TO ''||rpath;\\n';\n  proc:=proc||'    EXECUTE query;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN rpath;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION is_search_path(in the_user text, in only_static boolean) RETURNS boolean AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN true;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\n  -- Triggers\n  CREATE TRIGGER systeme_schema_trgctl BEFORE INSERT OR UPDATE ON systeme_schema FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_utilisateur_trgctl BEFORE INSERT OR UPDATE ON systeme_utilisateur FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_parametre_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction_parametre FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_parametre_type_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction_parametre_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_execution_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction_execution FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_execution_parametre_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction_execution_parametre FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  proc:='CREATE TRIGGER T0_tg_manage_role0 BEFORE INSERT ON systeme_utilisateur FOR ROW EXECUTE PROCEDURE tg_manage_role();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T0_tg_manage_role1 BEFORE UPDATE ON systeme_utilisateur FOR ROW EXECUTE PROCEDURE tg_manage_role();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T0_tg_manage_role2 BEFORE DELETE ON systeme_utilisateur FOR ROW EXECUTE PROCEDURE tg_manage_role();';\n  EXECUTE proc;\n  -- Data with triggers\n  -- Sequences initialization\n  PERFORM setval('systeme_schema_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_schema;\n  PERFORM setval('systeme_utilisateur_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_utilisateur;\n  PERFORM setval('systeme_extraction_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction;\n  PERFORM setval('systeme_extraction_parametre_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction_parametre;\n  PERFORM setval('systeme_extraction_parametre_type_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction_parametre_type;\n  PERFORM setval('systeme_extraction_execution_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction_execution;\n  PERFORM setval('systeme_extraction_execution_parametre_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction_execution_parametre;\n\n\n  --\n  -- Schema: base\n  --\n\n  CREATE SCHEMA base;\n  schema_name := 'base'::varchar;\n  SELECT systeme.set_search_path(true) INTO query;\n  SELECT 'SET search_path TO '||schema_name||','||query INTO query;\n  EXECUTE query;\n  CREATE TABLE base_langue (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_devise (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(32) UNIQUE NOT NULL,\n    symbole CHARACTER VARYING(4) UNIQUE NOT NULL,\n    abrev CHARACTER VARYING(4) UNIQUE NOT NULL,\n    taux NUMERIC(16,8) NOT NULL,\n    defaut BOOLEAN NOT NULL DEFAULT false,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_societe (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\n    siren CHARACTER VARYING(9) UNIQUE NOT NULL,\n    rcs_ville CHARACTER VARYING(32),\n    rcs_type CHARACTER VARYING(1) DEFAULT 'A',\n    rm_numero CHARACTER VARYING(32),\n    nui CHARACTER VARYING(32) NOT NULL,\n    naf CHARACTER VARYING(32),\n    code_pays CHARACTER VARYING(2),\n    tic_prefixe CHARACTER VARYING(2),\n    tic CHARACTER VARYING(32),\n    adresse CHARACTER VARYING(128),\n    schema CHARACTER VARYING(32),\n    note CHARACTER VARYING,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_societe_utilisateur_rel (\n    id SERIAL NOT NULL PRIMARY KEY,\n    societe_id INTEGER NOT NULL,\n    utilisateur_login CHARACTER VARYING(32) UNIQUE NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_codepostal_commune_rel (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\n    codepostal_id INTEGER NOT NULL,\n    commune_id INTEGER NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_codepostal (\n    id SERIAL NOT NULL PRIMARY KEY,\n    numero CHARACTER VARYING(16) UNIQUE,\n    cedex BOOLEAN NOT NULL DEFAULT false,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_commune (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(128) NOT NULL,\n    cedex BOOLEAN NOT NULL DEFAULT false,\n    canton_id INTEGER,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_canton (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(128) NOT NULL,\n    arrondissement_id INTEGER,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE gestsea_cotisation (\n    id SERIAL NOT NULL PRIMARY KEY,\n    partenaire_id INTEGER NOT NULL,\n    date DATE NOT NULL,\n    reglement_autre BOOLEAN NOT NULL DEFAULT false,\n    reglement_id INTEGER,\n    reglement_libelle CHARACTER VARYING,\n    reglement_mode_id INTEGER NOT NULL,\n    reglement_date DATE,\n    reglement_banque CHARACTER VARYING(64),\n    reglement_numcompte CHARACTER VARYING(64),\n    reglement_reference CHARACTER VARYING(64),\n    montant_ttc NUMERIC(16,2) NOT NULL,\n    montant_ht NUMERIC(16,2) NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE gestsea_cotisation_ligne (\n    id SERIAL NOT NULL PRIMARY KEY,\n    cotisation_id INTEGER NOT NULL,\n    produit_id INTEGER NOT NULL,\n    produit_code CHARACTER VARYING(16) NOT NULL,\n    quantite NUMERIC(12,2) NOT NULL DEFAULT 1,\n    montant_ttc NUMERIC(16,2) NOT NULL,\n    montant_ht NUMERIC(16,2) NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE gestsea_cotisation_produit (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\n    code CHARACTER VARYING(16) NOT NULL,\n    societe_id INTEGER NOT NULL,\n    montant_ttc NUMERIC(16,2) NOT NULL,\n    montant_ht NUMERIC(16,2) NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  -- Indexes\n  CREATE  INDEX base_societe_tic_index ON base_societe(tic);\n  CREATE  UNIQUE INDEX base_codepostal_numero_index ON base_codepostal(numero);\n  CREATE  INDEX gestsea_cotisation_partenaire_id_index ON gestsea_cotisation(partenaire_id);\n  CREATE  INDEX gestsea_cotisation_reglement_id_index ON gestsea_cotisation(reglement_id);\n  CREATE  INDEX gestsea_cotisation_reglement_mode_id_index ON gestsea_cotisation(reglement_mode_id);\n  -- Constraints\n  RAISE NOTICE 'Contraintes';\n  ALTER TABLE base_langue ADD CONSTRAINT base_langue_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_langue ADD CONSTRAINT base_langue_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_devise ADD CONSTRAINT base_devise_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_devise ADD CONSTRAINT base_devise_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_devise ADD CONSTRAINT base_devise_constraint0 CHECK (taux>0);\n  ALTER TABLE base_societe ADD CONSTRAINT base_societe_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_societe ADD CONSTRAINT base_societe_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_societe_utilisateur_rel ADD CONSTRAINT base_societe_utilisateur_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_societe_utilisateur_rel ADD CONSTRAINT base_societe_utilisateur_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_societe_utilisateur_rel ADD CONSTRAINT base_societe_utilisateur_rel_constraint0 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\n  ALTER TABLE base_societe_utilisateur_rel ADD CONSTRAINT base_societe_utilisateur_rel_constraint1 FOREIGN KEY (utilisateur_login) REFERENCES systeme_utilisateur(login);\n  ALTER TABLE base_codepostal_commune_rel ADD CONSTRAINT base_codepostal_commune_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_codepostal_commune_rel ADD CONSTRAINT base_codepostal_commune_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_codepostal_commune_rel ADD CONSTRAINT base_codepostal_commune_rel_constraint0 FOREIGN KEY (codepostal_id) REFERENCES base_codepostal(id);\n  ALTER TABLE base_codepostal_commune_rel ADD CONSTRAINT base_codepostal_commune_rel_constraint1 FOREIGN KEY (commune_id) REFERENCES base_commune(id);\n  ALTER TABLE base_codepostal ADD CONSTRAINT base_codepostal_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_codepostal ADD CONSTRAINT base_codepostal_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_commune ADD CONSTRAINT base_commune_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_commune ADD CONSTRAINT base_commune_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_commune ADD CONSTRAINT base_commune_constraint0 FOREIGN KEY (canton_id) REFERENCES base_canton(id);\n  ALTER TABLE base_canton ADD CONSTRAINT base_canton_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_canton ADD CONSTRAINT base_canton_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation ADD CONSTRAINT gestsea_cotisation_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation ADD CONSTRAINT gestsea_cotisation_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation ADD CONSTRAINT gestsea_cotisation_constraint0 CHECK ((NOT reglement_autre AND reglement_date IS NOT NULL AND reglement_banque IS NOT NULL AND reglement_numcompte IS NOT NULL AND reglement_reference IS NOT NULL) OR (reglement_autre AND reglement_id IS NOT NULL));\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_constraint0 CHECK (quantite>0);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_constraint1 CHECK (montant_ttc>=0 AND montant_ht>=0);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_constraint2 FOREIGN KEY (cotisation_id) REFERENCES gestsea_cotisation(id);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_constraint3 FOREIGN KEY (produit_id) REFERENCES gestsea_cotisation_produit(id);\n  ALTER TABLE gestsea_cotisation_produit ADD CONSTRAINT gestsea_cotisation_produit_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation_produit ADD CONSTRAINT gestsea_cotisation_produit_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation_produit ADD CONSTRAINT gestsea_cotisation_produit_constraint0 CHECK (montant_ttc>=0 AND montant_ht>=0);\n  ALTER TABLE gestsea_cotisation_produit ADD CONSTRAINT gestsea_cotisation_produit_constraint1 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\n  -- Data without triggers\n  INSERT INTO base_langue VALUES (1, 'fr-FR', 'FranÃ§ais (France)');\n  INSERT INTO base_langue VALUES (2, 'en-US', 'Anglais (U.S.A.)');\n  INSERT INTO base_langue VALUES (3, 'en-GB', 'Anglais (Royaume-Uni)');\n  INSERT INTO base_langue VALUES (4, 'es-ES', 'Espagnol (Espagne)');\n  INSERT INTO base_devise VALUES (1, 'Euro', 'â¬', 'EUR', 1, true);\n  INSERT INTO base_devise VALUES (2, 'Dollar amÃ©ricain', '$', 'USD', 0.77296461, false);\n  -- Procedures\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_societe() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  IF TG_OP=''UPDATE'' THEN\\n';\n  proc:=proc||'    IF OLD.code!=NEW.code THEN\\n';\n  proc:=proc||'      NEW.code:=OLD.code;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF NEW.siren IS NULL THEN\\n';\n  proc:=proc||'    NEW.siren:=''000000000'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  NEW.tic := to_char(NEW.siren::integer,''FM009 009 009'');\\n';\n  proc:=proc||'  IF LENGTH(COALESCE(NEW.rcs_ville,''''))>1 THEN\\n';\n  proc:=proc||'    NEW.rm_numero := NULL;\\n';\n  proc:=proc||'    NEW.rcs_ville:=UPPER(NEW.rcs_ville);\\n';\n  proc:=proc||'    NEW.rcs_type:=UPPER(NEW.rcs_type);\\n';\n  proc:=proc||'    IF LENGTH(COALESCE(NEW.rcs_type,''''))!=1 THEN\\n';\n  proc:=proc||'      NEW.rcs_type:=''A'';\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    IF NEW.rcs_type!=''A'' THEN\\n';\n  proc:=proc||'      NEW.rcs_type:=''B'';\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    NEW.nui := ''RCS ''||NEW.rcs_ville||'' ''||NEW.rcs_type||'' ''||NEW.tic;\\n';\n  proc:=proc||'  ELSIF 1<=LENGTH(COALESCE(NEW.rm_numero,'''')) AND LENGTH(COALESCE(NEW.rm_numero,''''))<=3 THEN\\n';\n  proc:=proc||'    NEW.rcs_ville := NULL;\\n';\n  proc:=proc||'    NEW.rcs_type  := NULL;\\n';\n  proc:=proc||'    NEW.rm_numero := to_char(NEW.rm_numero::integer,''FM099'');\\n';\n  proc:=proc||'    NEW.nui := NEW.tic||'' RM ''||NEW.rm_numero;\\n';\n  proc:=proc||'  ELSE\\n';\n  proc:=proc||'    NEW.rcs_ville := NULL;\\n';\n  proc:=proc||'    NEW.rcs_type  := NULL;\\n';\n  proc:=proc||'    NEW.rm_numero := NULL;\\n';\n  proc:=proc||'    NEW.nui := NEW.tic;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF LENGTH(COALESCE(NEW.code_pays,''''))!=2 THEN\\n';\n  proc:=proc||'    NEW.code_pays := ''FR'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF LENGTH(COALESCE(NEW.tic_prefixe,''''))!=2 THEN\\n';\n  proc:=proc||'    NEW.tic_prefixe := ''--'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  NEW.tic := ''FR ''||NEW.tic_prefixe||'' ''||NEW.tic;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION fc_get_current_contact_version(IN a_contact_id INTEGER) RETURNS INTEGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  p_ret integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  IF a_contact_id IS NULL THEN\\n';\n  proc:=proc||'    RETURN NULL;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  SELECT id FROM base_partenaire_contact_version \\n';\n  proc:=proc||'    WHERE contact_id=a_contact_id AND datetime_fin=''infinity'' \\n';\n  proc:=proc||'    INTO p_ret;\\n';\n  proc:=proc||'  IF p_ret IS NULL THEN\\n';\n  proc:=proc||'    RAISE EXCEPTION ''Erreur systÃ¨me : Pas de version en cours pour le contact ''''%''''.'',COALESCE(a_contact_id,''NULL'');\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN p_ret;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_codepostal_commune_rel() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  cp varchar(5);\\n';\n  proc:=proc||'  ville varchar(32); \\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT numero FROM base_codepostal WHERE id=NEW.codepostal_id INTO cp;\\n';\n  proc:=proc||'  SELECT nom FROM base_commune WHERE id=NEW.commune_id INTO ville;\\n';\n  proc:=proc||'  NEW.nom = cp||'' ''||ville;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION fc_get_nb_jours_dans_mois(IN a_date DATE) RETURNS INTEGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  p_mois_nb_jours CONSTANT integer[12] = ''{31,28,31,30,31,30,31,31,30,31,30,31}'';\\n';\n  proc:=proc||'  p_annee integer;\\n';\n  proc:=proc||'  p_mois  integer;\\n';\n  proc:=proc||'  p_jours integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  p_annee:=EXTRACT(YEAR FROM a_date)::integer;\\n';\n  proc:=proc||'  p_mois:=EXTRACT(MONTH FROM a_date)::integer;\\n';\n  proc:=proc||'  p_jours:=p_mois_nb_jours[p_mois];\\n';\n  proc:=proc||'  IF (p_mois=2) AND (p_annee%4=0) AND ((p_annee%100!=0) OR (p_annee%400=0)) THEN\\n';\n  proc:=proc||'    p_jours := p_jours+1;\\n';\n  proc:=proc||'  END IF;    \\n';\n  proc:=proc||'  RETURN p_jours;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION fc_get_compte(IN a_compteperm_id INTEGER) RETURNS INTEGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  total integer;\\n';\n  proc:=proc||'  p_ret integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT count(*) FROM compta_compte WHERE compteperm_id=a_compteperm_id INTO total;\\n';\n  proc:=proc||'  IF 0>=total THEN\\n';\n  proc:=proc||'    INSERT INTO compta_compte(compteperm_id) VALUES (a_compteperm_id);\\n';\n  proc:=proc||'  ELSIF total>1 THEN\\n';\n  proc:=proc||'    RAISE EXCEPTION ''Impossible mais plusieurs comptes auraient pour parent le mÃªme compte permanent.'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  SELECT compteperm_id FROM compta_compte WHERE compteperm_id=a_compteperm_id INTO p_ret;\\n';\n  proc:=proc||'  RETURN p_ret;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_cotisation() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  total integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT count(*) FROM gestsea_cotisation_parametrage INTO total;\\n';\n  proc:=proc||'  IF total!=1 THEN\\n';\n  proc:=proc||'    RAISE EXCEPTION ''Le paramÃ¨trage des cotisations est incorrect (nb_enreg!=1).'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF NEW.reglement_autre THEN\\n';\n  proc:=proc||'    SELECT count(*) FROM gestion_ventes_reglement WHERE id=NEW.reglement_id INTO total;\\n';\n  proc:=proc||'    IF 0>=total THEN\\n';\n  proc:=proc||'      RAISE EXCEPTION ''Le reglement que vous indiquez n''''existe pas.'';\\n';\n  proc:=proc||'    ELSE\\n';\n  proc:=proc||'      SELECT partenaire.nom||'' ''||reglement.montant||'' â¬ (''||reglement.date_reglement||'')'' \\n';\n  proc:=proc||'        FROM gestion_ventes_reglement AS reg JOIN base_partenaire AS p ON (p.id=partenaire_id)\\n';\n  proc:=proc||'        WHERE reg.id=NEW.reglement_id INTO NEW.reglement_libelle;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  INSERT INTO gestsea_cotisation_lot (lot,cotisation_id,en_facture)\\n';\n  proc:=proc||'    SELECT lot_dernier_numero,NEW.cotisation_id,false FROM gestsea_cotisation_parametrage;\\n';\n  proc:=proc||'  RETURN NEW;  \\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_cotisation_ligne() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  p_cotisation_id gestsea_cotisation.id%TYPE;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  IF TG_OP=''INSERT'' OR TG_OP=''UPDATE'' THEN\\n';\n  proc:=proc||'    SELECT NEW.quantite*montant_ttc,NEW.quantite*montant_ht,code \\n';\n  proc:=proc||'      FROM gestsea_cotisation_produit\\n';\n  proc:=proc||'      WHERE id=NEW.produit_id INTO NEW.montant_ttc, NEW.montant_ht, NEW.produit_code;\\n';\n  proc:=proc||'    p_cotisation_id = NEW.cotisation_id;\\n';\n  proc:=proc||'  ELSE\\n';\n  proc:=proc||'    p_cotisation_id = OLD.cotisation_id;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  UPDATE gestsea_cotisation SET montant_ttc=COALESCE(sum(lig.montant_ttc),0), montant_ht=COALESCE(SUM(lig.montant_ht),0)\\n';\n  proc:=proc||'    FROM gestsea_cotisation_ligne AS lig WHERE cotisation_id=p_cotisation_id;\\n';\n  proc:=proc||'  RETURN NEW;  \\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_cotisation_produit() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  total integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT ''SELECT count(*) FROM ''||schema||''.gestion_produit WHERE code=''''''||NEW.code||''''''''\\n';\n  proc:=proc||'    FROM base_societe WHERE id=NEW.societe_id INTO query;\\n';\n  proc:=proc||'  EXECUTE query INTO total;\\n';\n  proc:=proc||'  IF total!=1 THEN\\n';\n  proc:=proc||'    RAISE EXCEPTION ''Le produit que vous indiquez est invalide (nb!=1).'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN NEW;  \\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION is_search_path(in the_user text, in only_static boolean) RETURNS boolean AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN true;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\n  -- Triggers\n  CREATE TRIGGER base_langue_trgctl BEFORE INSERT OR UPDATE ON base_langue FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_devise_trgctl BEFORE INSERT OR UPDATE ON base_devise FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_societe_trgctl BEFORE INSERT OR UPDATE ON base_societe FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_societe_utilisateur_rel_trgctl BEFORE INSERT OR UPDATE ON base_societe_utilisateur_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_codepostal_commune_rel_trgctl BEFORE INSERT OR UPDATE ON base_codepostal_commune_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_codepostal_trgctl BEFORE INSERT OR UPDATE ON base_codepostal FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_commune_trgctl BEFORE INSERT OR UPDATE ON base_commune FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_canton_trgctl BEFORE INSERT OR UPDATE ON base_canton FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER gestsea_cotisation_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER gestsea_cotisation_ligne_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER gestsea_cotisation_produit_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation_produit FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  proc:='CREATE TRIGGER T1_tg_complete_societe0 BEFORE INSERT ON base_societe FOR ROW EXECUTE PROCEDURE tg_complete_societe();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T1_tg_complete_societe1 BEFORE UPDATE ON base_societe FOR ROW EXECUTE PROCEDURE tg_complete_societe();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T12_tg_complete_codepostal_commune_rel0 BEFORE INSERT ON base_codepostal_commune_rel FOR ROW EXECUTE PROCEDURE tg_complete_codepostal_commune_rel();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T12_tg_complete_codepostal_commune_rel1 BEFORE UPDATE ON base_codepostal_commune_rel FOR ROW EXECUTE PROCEDURE tg_complete_codepostal_commune_rel();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T38_tg_complete_cotisation0 BEFORE INSERT ON gestsea_cotisation FOR ROW EXECUTE PROCEDURE tg_complete_cotisation();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T38_tg_complete_cotisation1 BEFORE UPDATE ON gestsea_cotisation FOR ROW EXECUTE PROCEDURE tg_complete_cotisation();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T39_tg_complete_cotisation_ligne0 BEFORE INSERT ON gestsea_cotisation_ligne FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_ligne();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T39_tg_complete_cotisation_ligne1 BEFORE UPDATE ON gestsea_cotisation_ligne FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_ligne();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T39_tg_complete_cotisation_ligne2 BEFORE DELETE ON gestsea_cotisation_ligne FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_ligne();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T40_tg_complete_cotisation_produit0 BEFORE INSERT ON gestsea_cotisation_produit FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_produit();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T40_tg_complete_cotisation_produit1 BEFORE UPDATE ON gestsea_cotisation_produit FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_produit();';\n  EXECUTE proc;\n  -- Data with triggers\n  -- Sequences initialization\n  PERFORM setval('base_langue_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_langue;\n  PERFORM setval('base_devise_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_devise;\n  PERFORM setval('base_societe_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_societe;\n  PERFORM setval('base_societe_utilisateur_rel_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_societe_utilisateur_rel;\n  PERFORM setval('base_codepostal_commune_rel_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_codepostal_commune_rel;\n  PERFORM setval('base_codepostal_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_codepostal;\n  PERFORM setval('base_commune_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_commune;\n  PERFORM setval('base_canton_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_canton;\n  PERFORM setval('gestsea_cotisation_id_seq',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation;\n  PERFORM setval('gestsea_cotisation_ligne_id_seq',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation_ligne;\n  PERFORM setval('gestsea_cotisation_produit_id_seq',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation_produit;\n\n\n  --\n  -- Schema: code\n  --\n\n  SET search_path to base;\n  proc:='CREATE OR REPLACE FUNCTION tgs_base_base_societe_() RETURNS TRIGGER AS\\n';\n  proc:=proc||' \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  schema_name varchar;\\n';\n  proc:=proc||'  start_value integer;\\n';\n  proc:=proc||'  proc text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  NEW.code:=lower(replace(NEW.code,'' '',''''));\\n';\n  proc:=proc||'  schema_name := NEW.code::varchar;\\n';\n  proc:=proc||'  SELECT ''CREATE SCHEMA ''||schema_name INTO query;\\n';\n  proc:=proc||'  EXECUTE query;\\n';\n  proc:=proc||'  SELECT systeme.set_search_path(true) INTO query;\\n';\n  proc:=proc||'  SELECT ''SET search_path TO ''||schema_name||'',''||query INTO query;\\n';\n  proc:=proc||'  EXECUTE query;\\n';\n  proc:=proc||'  SELECT setting FROM pg_settings where name=''search_path'' INTO query;\\n';\n  proc:=proc||'  RAISE NOTICE ''SP: %'',query;\\n';\n  proc:=proc||'  CREATE TABLE base_societe_etablissement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    societe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    nic CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    siret CHARACTER VARYING(32) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    adresse CHARACTER VARYING(128),\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_parametre (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    valeur CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_service (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    parent_service_id INTEGER,\\n';\n  proc:=proc||'    etablissement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_droits_profil (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_droits_profil_module (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    profil_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    module_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    selection BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insertion BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    modification BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    suppression BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_droits_module (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    code_interface CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    parent_module_id INTEGER,\\n';\n  proc:=proc||'    objets CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_acces (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    valeur INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_employe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    service_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    utilisateur_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    utilisateur_login CHARACTER VARYING(32) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    profil_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    acces_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    prenom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    initiales CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    role CHARACTER VARYING(32),\\n';\n  proc:=proc||'    telephone CHARACTER VARYING(32),\\n';\n  proc:=proc||'    mobile CHARACTER VARYING(32),\\n';\n  proc:=proc||'    fax CHARACTER VARYING(32),\\n';\n  proc:=proc||'    email CHARACTER VARYING(128),\\n';\n  proc:=proc||'    bureau CHARACTER VARYING(128),\\n';\n  proc:=proc||'    note CHARACTER VARYING(32),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    morale BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    masculin BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    titre CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    civilites CHARACTER VARYING(64),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    prenom CHARACTER VARYING(64),\\n';\n  proc:=proc||'    morale BOOLEAN NOT NULL,\\n';\n  proc:=proc||'    titre CHARACTER VARYING(64),\\n';\n  proc:=proc||'    debit_limite NUMERIC(16,2),\\n';\n  proc:=proc||'    credit_limite NUMERIC(16,2),\\n';\n  proc:=proc||'    langue_id INTEGER,\\n';\n  proc:=proc||'    site_web CHARACTER VARYING(128),\\n';\n  proc:=proc||'    parent_id INTEGER,\\n';\n  proc:=proc||'    responsable_id INTEGER,\\n';\n  proc:=proc||'    naissance_date DATE,\\n';\n  proc:=proc||'    ean13 CHARACTER VARYING(13),\\n';\n  proc:=proc||'    nom_soundex2 CHARACTER VARYING(4) NOT NULL,\\n';\n  proc:=proc||'    nom_phonex DOUBLE PRECISION,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_contact (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    date_fin DATE,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    complement CHARACTER VARYING(38),\\n';\n  proc:=proc||'    ligne3 CHARACTER VARYING(38),\\n';\n  proc:=proc||'    numero CHARACTER VARYING(5),\\n';\n  proc:=proc||'    voie CHARACTER VARYING(32),\\n';\n  proc:=proc||'    ligne5 CHARACTER VARYING(38),\\n';\n  proc:=proc||'    codepostal_commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    codepostal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    codepostal CHARACTER VARYING(5),\\n';\n  proc:=proc||'    commune CHARACTER VARYING(32),\\n';\n  proc:=proc||'    telephone CHARACTER VARYING(16),\\n';\n  proc:=proc||'    mobile CHARACTER VARYING(16),\\n';\n  proc:=proc||'    fax CHARACTER VARYING(16),\\n';\n  proc:=proc||'    email CHARACTER VARYING(128),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_contact_version (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    datetime_debut TIMESTAMP NOT NULL,\\n';\n  proc:=proc||'    datetime_fin TIMESTAMP NOT NULL,\\n';\n  proc:=proc||'    contact_id INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    complement CHARACTER VARYING(38),\\n';\n  proc:=proc||'    ligne3 CHARACTER VARYING(38),\\n';\n  proc:=proc||'    numero CHARACTER VARYING(5),\\n';\n  proc:=proc||'    voie CHARACTER VARYING(32),\\n';\n  proc:=proc||'    ligne5 CHARACTER VARYING(38),\\n';\n  proc:=proc||'    codepostal_commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    codepostal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    codepostal CHARACTER VARYING(5),\\n';\n  proc:=proc||'    commune CHARACTER VARYING(32),\\n';\n  proc:=proc||'    telephone CHARACTER VARYING(128),\\n';\n  proc:=proc||'    mobile CHARACTER VARYING(128),\\n';\n  proc:=proc||'    fax CHARACTER VARYING(128),\\n';\n  proc:=proc||'    email CHARACTER VARYING(128),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_contact_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_observation (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    importance_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    contenu CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_observation_importance (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    niveau INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    categorie_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    categorie_nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING(128),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut_categorie (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    attribut_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_delai (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    nb_mois INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_jours INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    fin_de_mois BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    prolongation BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    jour_du_mois INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression_modele (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    impression_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    datetime_debut TIMESTAMP NOT NULL,\\n';\n  proc:=proc||'    datetime_fin TIMESTAMP NOT NULL,\\n';\n  proc:=proc||'    modele CHARACTER VARYING NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    modele CHARACTER VARYING NOT NULL DEFAULT ''%% Saisissez votre modÃ¨le'',\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_ecriture (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    devise_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    devise_taux NUMERIC(16,8) NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    debit_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    cumul_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    simulation BOOLEAN,\\n';\n  proc:=proc||'    lettrage CHARACTER VARYING(16),\\n';\n  proc:=proc||'    compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compte_numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_date DATE NOT NULL,\\n';\n  proc:=proc||'    journal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    pointage_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_piece (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    echeance DATE NOT NULL,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    exercice_code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    exercice_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_exercice (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    cloture BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_journal (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit_compteperm_id INTEGER,\\n';\n  proc:=proc||'    mois INTEGER NOT NULL,\\n';\n  proc:=proc||'    annee INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    provisoire BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    contrepartie BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_journal_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    abrev CHARACTER VARYING(4) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    provisoire BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    contrepartie BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    debit_compteperm_id INTEGER,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_pointage (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    banque_compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compteperm_partenaire_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_banque_compte (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(32) NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    banque_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_banque (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compteperm (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    acces_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    parent_compteperm_id INTEGER,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    signe BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    general BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    accept_aux BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    utilisable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    lettrable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    pointable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    groupable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    echeance INTEGER DEFAULT -1,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compte (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    compteperm_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    acces_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    parent_compte_id INTEGER,\\n';\n  proc:=proc||'    exercice_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    derniere_lettre CHARACTER VARYING(16),\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    signe BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    general BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    accept_aux BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    utilisable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    lettrable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    pointable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    groupable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    echeance INTEGER DEFAULT -1,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compte_cumul (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    mois INTEGER NOT NULL,\\n';\n  proc:=proc||'    annee INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_sequence (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    sequence CHARACTER VARYING(32) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    quotidienne BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    mensuelle BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    annuelle BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    prefixe CHARACTER VARYING(32) DEFAULT ''YYYY'',\\n';\n  proc:=proc||'    corps CHARACTER VARYING(32) NOT NULL DEFAULT ''FM099999'',\\n';\n  proc:=proc||'    suffixe CHARACTER VARYING(32),\\n';\n  proc:=proc||'    start INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    dernier_numero CHARACTER VARYING(32),\\n';\n  proc:=proc||'    jour INTEGER,\\n';\n  proc:=proc||'    mois INTEGER,\\n';\n  proc:=proc||'    annee INTEGER,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_compteperm_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    reduction BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    inquantifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    sans_stock BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    service BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    ean13 CHARACTER VARYING(13),\\n';\n  proc:=proc||'    categorie_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_categorie (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    parent_categorie_id INTEGER,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_service_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    service_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_taxe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    taux NUMERIC(16,8) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_prix_taxe_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    prix_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    taxe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    base_montant NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_prix (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    achat BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    partenaire_id INTEGER,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_lien (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    partenaire1_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire2_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    role_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE,\\n';\n  proc:=proc||'    date_fin DATE,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_lien_role (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    prefixe CHARACTER VARYING(128) NOT NULL DEFAULT '' en tant que '',\\n';\n  proc:=proc||'    suffixe CHARACTER VARYING(128) NOT NULL DEFAULT ''.'',\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    nom_etendu CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_lien_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    phrase_directe CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    phrase_inverse CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_reduction (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    taux NUMERIC(16,8) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    facture_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    periode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    reduction_id INTEGER,\\n';\n  proc:=proc||'    periode_date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    periode_date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    type_nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    produit_nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    reduction_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_type_produit_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    adhesion_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_periode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_type_periode_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    periode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_transmission (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    adhesion_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    lien_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    sens_inverse BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_commande_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    avec_signature BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    validite_delai_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    paiement_delai_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_commande (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    validite_delai_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    validite_date DATE NOT NULL,\\n';\n  proc:=proc||'    avec_signature BOOLEAN NOT NULL,\\n';\n  proc:=proc||'    signature_client BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    avec_bons_livraison BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commande_contact_id INTEGER,\\n';\n  proc:=proc||'    commande_version_id INTEGER,\\n';\n  proc:=proc||'    facture_contact_id INTEGER,\\n';\n  proc:=proc||'    livraison_contact_id INTEGER,\\n';\n  proc:=proc||'    impression_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    modele_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    reduction_taux NUMERIC(16,8) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    acompte BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    objet CHARACTER VARYING(128),\\n';\n  proc:=proc||'    civilites CHARACTER VARYING(128),\\n';\n  proc:=proc||'    introduction CHARACTER VARYING,\\n';\n  proc:=proc||'    conclusion CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_commande_ligne (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    a_inclure BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    inclus BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prix_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    stock_id INTEGER,\\n';\n  proc:=proc||'    stock_mouvement_id INTEGER,\\n';\n  proc:=proc||'    reduction BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    montant_unitaire_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_unitaire_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    montant_brut_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_facture (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    paiement_delai_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    paiement_date DATE NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    facture_version_id INTEGER,\\n';\n  proc:=proc||'    livraison_version_id INTEGER,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    impression_id INTEGER,\\n';\n  proc:=proc||'    modele_id INTEGER,\\n';\n  proc:=proc||'    reduction_taux NUMERIC(16,8) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    objet CHARACTER VARYING(128),\\n';\n  proc:=proc||'    civilites CHARACTER VARYING(128),\\n';\n  proc:=proc||'    message CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_facture_ligne (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commande_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    ecriture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    a_inclure BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    inclus BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prix_id INTEGER,\\n';\n  proc:=proc||'    stock_mouvement_id INTEGER,\\n';\n  proc:=proc||'    reduction BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    montant_unitaire_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_unitaire_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_avoir (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    commande_id INTEGER,\\n';\n  proc:=proc||'    facture_id INTEGER,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER,\\n';\n  proc:=proc||'    date DATE,\\n';\n  proc:=proc||'    impression_id INTEGER,\\n';\n  proc:=proc||'    modele_id INTEGER,\\n';\n  proc:=proc||'    reduction_taux NUMERIC(16,8) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2),\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2),\\n';\n  proc:=proc||'    objet CHARACTER VARYING(128),\\n';\n  proc:=proc||'    civilites CHARACTER VARYING(128),\\n';\n  proc:=proc||'    message CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_avoir_ligne (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    facture_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    avoir_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prix_id INTEGER,\\n';\n  proc:=proc||'    stock_mouvement_id INTEGER,\\n';\n  proc:=proc||'    montant_unitaire_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_unitaire_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_relance (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    datetime TIMESTAMP UNIQUE NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_relance_lettre (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    relance_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    etape_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    echeance_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_relance_mode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_relance_mode_etape (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    relance_mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nb_jours INTEGER NOT NULL,\\n';\n  proc:=proc||'    message CHARACTER VARYING NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_facture_reglement_echeance (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    relance_mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prevision_montant NUMERIC(16,2),\\n';\n  proc:=proc||'    date DATE,\\n';\n  proc:=proc||'    part_montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    partiel BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    reglement_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_reglement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    banque CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    numero_compte CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    reference CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    date_reglement DATE NOT NULL,\\n';\n  proc:=proc||'    date_saisie DATE NOT NULL,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_reglement_mode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    banque_compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_reversement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    reglement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_reversement_mode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    societe_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_facture (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    impression_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    modele_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_facture_ligne (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prix_id INTEGER,\\n';\n  proc:=proc||'    stock_mouvement_id INTEGER,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_facture_reglement_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    reglement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partiel BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_reglement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    reference CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    date_reglement DATE NOT NULL,\\n';\n  proc:=proc||'    date_saisie DATE NOT NULL,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_reglement_mode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    banque_compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_stock_lieu (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    lieu_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_stock (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    stock_lieu_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    quantite_init NUMERIC(12,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    quantite_max NUMERIC(12,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_stock_mouvement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    stock_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    virtuel BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    date DATE,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_cotisation_parametrage (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    avec_defaut_produit BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    defaut_produit_code CHARACTER VARYING(16),\\n';\n  proc:=proc||'    lot_dernier_numero INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    facture_objet CHARACTER VARYING NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_cotisation_lot (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    cotisation_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    facturable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    en_facture BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    erreur_message CHARACTER VARYING NOT NULL DEFAULT ''false'',\\n';\n  proc:=proc||'    commande_id INTEGER,\\n';\n  proc:=proc||'    facture_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_canton_groupe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_canton_groupe_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    canton_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    groupe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_structure (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    code_etendu CHARACTER VARYING UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    externe BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    parent_structure_id INTEGER,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_structure_commune_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    structure_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_procedure_commande_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    procedure_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    ordre INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    complement CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_procedure (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_tache (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    duree NUMERIC(12,2) NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    dossier_id INTEGER,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_tache_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_dossier (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    complement CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    etat_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    date_ouverture DATE,\\n';\n  proc:=proc||'    date_cloture DATE,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_dossier_commande (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    ordre INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    dossier_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_dossier_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    service_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_dossier_etat (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    nb_prerelances INTEGER NOT NULL,\\n';\n  proc:=proc||'    nb_postrelances INTEGER NOT NULL,\\n';\n  proc:=proc||'    numero_prochain INTEGER NOT NULL,\\n';\n  proc:=proc||'    contact_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication_parution (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    publication_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    numero INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    titre CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication_abonnement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    publication_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nb_numeros INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    differe INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication_abonnement_commande (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    commande_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    abonnement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    publication_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    contact_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nb_exemplaires INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication_abonnement_routage (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    facture_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    contact_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    abonnement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    publication_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nb_exemplaires INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    numero_debut INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    numero_fin INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    suspendu BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  -- Indexes\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_etablissement_code_index ON base_societe_etablissement(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_parametre_code_index ON base_societe_parametre(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_parametre_nom_index ON base_societe_parametre(nom);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_service_code_index ON base_societe_service(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_partenaire_type_nom_index ON base_partenaire_type(nom);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_type_titre_index ON base_partenaire_type(titre);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_nom_index ON base_partenaire(nom);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_type_id_index ON base_partenaire(type_id);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_libelle_index ON base_partenaire(libelle);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_prenom_index ON base_partenaire(prenom);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_titre_index ON base_partenaire(titre);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_langue_id_index ON base_partenaire(langue_id);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_nom_soundex2_index ON base_partenaire(nom_soundex2);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_nom_phonex_index ON base_partenaire(nom_phonex);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_codepostal_index ON base_partenaire_contact(codepostal);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_commune_index ON base_partenaire_contact(commune);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_telephone_index ON base_partenaire_contact(telephone);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_mobile_index ON base_partenaire_contact(mobile);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_fax_index ON base_partenaire_contact(fax);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_email_index ON base_partenaire_contact(email);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_codepostal_index ON base_partenaire_contact_version(codepostal);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_commune_index ON base_partenaire_contact_version(commune);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_telephone_index ON base_partenaire_contact_version(telephone);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_mobile_index ON base_partenaire_contact_version(mobile);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_fax_index ON base_partenaire_contact_version(fax);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_email_index ON base_partenaire_contact_version(email);\\n';\n  proc:=proc||'  CREATE  INDEX compta_compteperm_parent_compteperm_id_index ON compta_compteperm(parent_compteperm_id);\\n';\n  proc:=proc||'  CREATE  INDEX compta_compte_derniere_lettre_index ON compta_compte(derniere_lettre);\\n';\n  proc:=proc||'  CREATE  INDEX gestion_produit_prix_libelle_index ON gestion_produit_prix(libelle);\\n';\n  proc:=proc||'  CREATE  INDEX gestion_produit_prix_produit_id_index ON gestion_produit_prix(produit_id);\\n';\n  proc:=proc||'  CREATE  INDEX gestion_produit_prix_date_debut_index ON gestion_produit_prix(date_debut);\\n';\n  proc:=proc||'  CREATE  INDEX gestion_produit_prix_date_fin_index ON gestion_produit_prix(date_fin);\\n';\n  proc:=proc||'  CREATE  INDEX gestsea_cotisation_lot_commande_id_index ON gestsea_cotisation_lot(commande_id);\\n';\n  proc:=proc||'  CREATE  INDEX gestsea_cotisation_lot_facture_id_index ON gestsea_cotisation_lot(facture_id);\\n';\n  proc:=proc||'  -- Constraints\\n';\n  proc:=proc||'  RAISE NOTICE ''Contraintes'';\\n';\n  proc:=proc||'  ALTER TABLE base_societe_etablissement ADD CONSTRAINT base_societe_etablissement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_etablissement ADD CONSTRAINT base_societe_etablissement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_etablissement ADD CONSTRAINT base_societe_etablissement_constraint0 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_parametre ADD CONSTRAINT base_societe_parametre_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_parametre ADD CONSTRAINT base_societe_parametre_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint0 FOREIGN KEY (parent_service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint1 FOREIGN KEY (etablissement_id) REFERENCES base_societe_etablissement(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil ADD CONSTRAINT base_droits_profil_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil ADD CONSTRAINT base_droits_profil_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_constraint0 UNIQUE (profil_id,module_id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_constraint1 FOREIGN KEY (module_id) REFERENCES base_droits_module(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_constraint2 FOREIGN KEY (profil_id) REFERENCES base_droits_profil(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_module ADD CONSTRAINT base_droits_module_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_module ADD CONSTRAINT base_droits_module_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_module ADD CONSTRAINT base_droits_module_constraint0 FOREIGN KEY (parent_module_id) REFERENCES base_droits_module(id);\\n';\n  proc:=proc||'  ALTER TABLE base_acces ADD CONSTRAINT base_acces_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_acces ADD CONSTRAINT base_acces_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_acces ADD CONSTRAINT base_acces_constraint0 CHECK (valeur>=0);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint0 FOREIGN KEY (service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint1 FOREIGN KEY (utilisateur_id) REFERENCES systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint2 FOREIGN KEY (utilisateur_login) REFERENCES systeme_utilisateur(login);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint3 FOREIGN KEY (profil_id) REFERENCES base_droits_profil(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint4 FOREIGN KEY (acces_id) REFERENCES base_acces(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_type ADD CONSTRAINT base_partenaire_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_type ADD CONSTRAINT base_partenaire_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint0 FOREIGN KEY (parent_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint1 FOREIGN KEY (responsable_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint2 FOREIGN KEY (langue_id) REFERENCES base_langue(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint3 FOREIGN KEY (type_id) REFERENCES base_partenaire_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint1 FOREIGN KEY (type_id) REFERENCES base_partenaire_contact_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint2 FOREIGN KEY (codepostal_commune_id) REFERENCES base_codepostal_commune_rel(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint3 FOREIGN KEY (codepostal_id) REFERENCES base_codepostal(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint4 FOREIGN KEY (commune_id) REFERENCES base_commune(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint0 CHECK (datetime_fin>=datetime_debut);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint1 FOREIGN KEY (contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint2 FOREIGN KEY (codepostal_commune_id) REFERENCES base_codepostal_commune_rel(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint3 FOREIGN KEY (codepostal_id) REFERENCES base_codepostal(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint4 FOREIGN KEY (commune_id) REFERENCES base_commune(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_type ADD CONSTRAINT base_partenaire_contact_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_type ADD CONSTRAINT base_partenaire_contact_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation ADD CONSTRAINT base_partenaire_observation_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation ADD CONSTRAINT base_partenaire_observation_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation ADD CONSTRAINT base_partenaire_observation_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation ADD CONSTRAINT base_partenaire_observation_constraint1 FOREIGN KEY (importance_id) REFERENCES base_partenaire_observation_importance(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation_importance ADD CONSTRAINT base_partenaire_observation_importance_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation_importance ADD CONSTRAINT base_partenaire_observation_importance_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint1 FOREIGN KEY (type_id) REFERENCES base_partenaire_attribut_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint2 FOREIGN KEY (categorie_id) REFERENCES base_partenaire_attribut_categorie(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_type ADD CONSTRAINT base_partenaire_attribut_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_type ADD CONSTRAINT base_partenaire_attribut_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_categorie ADD CONSTRAINT base_partenaire_attribut_categorie_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_categorie ADD CONSTRAINT base_partenaire_attribut_categorie_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_categorie ADD CONSTRAINT base_partenaire_attribut_categorie_constraint0 FOREIGN KEY (attribut_type_id) REFERENCES base_partenaire_attribut_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_constraint0 CHECK (nb_mois>=0);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_constraint1 CHECK (nb_jours>=0);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_constraint2 CHECK (jour_du_mois BETWEEN 1 AND 31);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_modele ADD CONSTRAINT base_impression_modele_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_modele ADD CONSTRAINT base_impression_modele_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_modele ADD CONSTRAINT base_impression_modele_constraint0 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_constraint0 FOREIGN KEY (type_id) REFERENCES base_impression_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_type ADD CONSTRAINT base_impression_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_type ADD CONSTRAINT base_impression_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint0 FOREIGN KEY (compte_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint1 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint2 FOREIGN KEY (piece_id) REFERENCES compta_piece(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint3 FOREIGN KEY (pointage_id) REFERENCES compta_pointage(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint4 FOREIGN KEY (journal_id) REFERENCES compta_journal(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint5 FOREIGN KEY (cumul_id) REFERENCES compta_compte_cumul(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint0 FOREIGN KEY (exercice_id) REFERENCES compta_exercice(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint1 FOREIGN KEY (exercice_code) REFERENCES compta_exercice(code);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint2 FOREIGN KEY (journal_id) REFERENCES compta_journal(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint3 FOREIGN KEY (journal_type_id) REFERENCES compta_journal_type(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_exercice ADD CONSTRAINT compta_exercice_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_exercice ADD CONSTRAINT compta_exercice_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint0 UNIQUE (type_id,annee,mois);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint1 FOREIGN KEY (type_id) REFERENCES compta_journal_type(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint2 FOREIGN KEY (debit_compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal_type ADD CONSTRAINT compta_journal_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal_type ADD CONSTRAINT compta_journal_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal_type ADD CONSTRAINT compta_journal_type_constraint0 FOREIGN KEY (debit_compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_pointage ADD CONSTRAINT compta_pointage_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_pointage ADD CONSTRAINT compta_pointage_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_pointage ADD CONSTRAINT compta_pointage_constraint0 FOREIGN KEY (banque_compte_id) REFERENCES compta_banque_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_constraint0 UNIQUE (partenaire_id,compteperm_id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_constraint2 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_constraint0 UNIQUE (numero,banque_id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_constraint1 FOREIGN KEY (banque_id) REFERENCES compta_banque(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_constraint2 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque ADD CONSTRAINT compta_banque_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque ADD CONSTRAINT compta_banque_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque ADD CONSTRAINT compta_banque_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_constraint0 FOREIGN KEY (acces_id) REFERENCES base_acces(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_constraint1 FOREIGN KEY (parent_compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint1 FOREIGN KEY (parent_compte_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint2 FOREIGN KEY (acces_id) REFERENCES base_acces(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint3 FOREIGN KEY (exercice_id) REFERENCES compta_exercice(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte_cumul ADD CONSTRAINT compta_compte_cumul_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte_cumul ADD CONSTRAINT compta_compte_cumul_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte_cumul ADD CONSTRAINT compta_compte_cumul_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_sequence ADD CONSTRAINT gestion_sequence_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_sequence ADD CONSTRAINT gestion_sequence_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_compteperm_rel ADD CONSTRAINT gestion_produit_compteperm_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_compteperm_rel ADD CONSTRAINT gestion_produit_compteperm_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_compteperm_rel ADD CONSTRAINT gestion_produit_compteperm_rel_constraint0 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_compteperm_rel ADD CONSTRAINT gestion_produit_compteperm_rel_constraint1 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit ADD CONSTRAINT gestion_produit_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit ADD CONSTRAINT gestion_produit_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit ADD CONSTRAINT gestion_produit_constraint0 CHECK (date_fin IS NULL OR (date_fin IS NOT NULL AND date_fin>=date_debut));\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit ADD CONSTRAINT gestion_produit_constraint1 FOREIGN KEY (categorie_id) REFERENCES gestion_produit_categorie(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_categorie ADD CONSTRAINT gestion_produit_categorie_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_categorie ADD CONSTRAINT gestion_produit_categorie_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_categorie ADD CONSTRAINT gestion_produit_categorie_constraint0 FOREIGN KEY (parent_categorie_id) REFERENCES gestion_produit_categorie(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_constraint0 UNIQUE (produit_id,service_id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_constraint2 FOREIGN KEY (service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_taxe ADD CONSTRAINT gestion_produit_taxe_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_taxe ADD CONSTRAINT gestion_produit_taxe_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_taxe ADD CONSTRAINT gestion_produit_taxe_constraint0 CHECK (taux>=0);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_taxe ADD CONSTRAINT gestion_produit_taxe_constraint1 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix_taxe_rel ADD CONSTRAINT gestion_produit_prix_taxe_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix_taxe_rel ADD CONSTRAINT gestion_produit_prix_taxe_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix_taxe_rel ADD CONSTRAINT gestion_produit_prix_taxe_rel_constraint0 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix_taxe_rel ADD CONSTRAINT gestion_produit_prix_taxe_rel_constraint1 FOREIGN KEY (taxe_id) REFERENCES gestion_produit_taxe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_constraint0 CHECK (date_fin>=date_debut);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_constraint1 CHECK (NOT achat OR (achat AND partenaire_id IS NOT NULL));\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_constraint2 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_constraint3 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_constraint0 FOREIGN KEY (partenaire1_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_constraint1 FOREIGN KEY (partenaire2_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_constraint2 FOREIGN KEY (type_id) REFERENCES gestion_lien_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_constraint3 FOREIGN KEY (role_id) REFERENCES gestion_lien_role(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_role ADD CONSTRAINT gestion_lien_role_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_role ADD CONSTRAINT gestion_lien_role_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_role ADD CONSTRAINT gestion_lien_role_constraint0 FOREIGN KEY (type_id) REFERENCES gestion_lien_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_type ADD CONSTRAINT gestion_lien_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_type ADD CONSTRAINT gestion_lien_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_reduction ADD CONSTRAINT gestion_reduction_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_reduction ADD CONSTRAINT gestion_reduction_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint0 UNIQUE (type_id,partenaire_id,periode_id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint1 FOREIGN KEY (type_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint2 FOREIGN KEY (periode_id) REFERENCES gestion_adhesion_periode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint3 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint4 FOREIGN KEY (reduction_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint5 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint6 FOREIGN KEY (facture_ligne_id) REFERENCES gestion_ventes_facture_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type ADD CONSTRAINT gestion_adhesion_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type ADD CONSTRAINT gestion_adhesion_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type ADD CONSTRAINT gestion_adhesion_type_constraint0 FOREIGN KEY (reduction_id) REFERENCES gestion_reduction(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_produit_rel ADD CONSTRAINT gestion_adhesion_type_produit_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_produit_rel ADD CONSTRAINT gestion_adhesion_type_produit_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_produit_rel ADD CONSTRAINT gestion_adhesion_type_produit_rel_constraint0 FOREIGN KEY (adhesion_type_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_produit_rel ADD CONSTRAINT gestion_adhesion_type_produit_rel_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_periode ADD CONSTRAINT gestion_adhesion_periode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_periode ADD CONSTRAINT gestion_adhesion_periode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_constraint0 UNIQUE (type_id,periode_id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_constraint1 FOREIGN KEY (type_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_constraint2 FOREIGN KEY (periode_id) REFERENCES gestion_adhesion_periode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_transmission ADD CONSTRAINT gestion_adhesion_transmission_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_transmission ADD CONSTRAINT gestion_adhesion_transmission_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_transmission ADD CONSTRAINT gestion_adhesion_transmission_constraint0 FOREIGN KEY (adhesion_type_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_transmission ADD CONSTRAINT gestion_adhesion_transmission_constraint1 FOREIGN KEY (lien_type_id) REFERENCES gestion_lien_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_type ADD CONSTRAINT gestion_ventes_commande_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_type ADD CONSTRAINT gestion_ventes_commande_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_type ADD CONSTRAINT gestion_ventes_commande_type_constraint0 FOREIGN KEY (validite_delai_id) REFERENCES base_delai(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_type ADD CONSTRAINT gestion_ventes_commande_type_constraint1 FOREIGN KEY (paiement_delai_id) REFERENCES base_delai(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint0 FOREIGN KEY (type_id) REFERENCES gestion_ventes_commande_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint2 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint3 FOREIGN KEY (commande_contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint4 FOREIGN KEY (commande_version_id) REFERENCES base_partenaire_contact_version(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint5 FOREIGN KEY (facture_contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint6 FOREIGN KEY (livraison_contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint7 FOREIGN KEY (modele_id) REFERENCES base_impression_modele(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint8 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint9 FOREIGN KEY (validite_delai_id) REFERENCES base_delai(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint0 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint2 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint3 FOREIGN KEY (stock_id) REFERENCES gestion_stock(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint4 FOREIGN KEY (stock_mouvement_id) REFERENCES gestion_stock_mouvement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint0 FOREIGN KEY (paiement_delai_id) REFERENCES base_delai(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint1 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint2 FOREIGN KEY (piece_id) REFERENCES compta_piece(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint3 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint4 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint5 FOREIGN KEY (facture_version_id) REFERENCES base_partenaire_contact_version(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint6 FOREIGN KEY (livraison_version_id) REFERENCES base_partenaire_contact_version(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint7 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint8 FOREIGN KEY (modele_id) REFERENCES base_impression_modele(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint0 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint1 FOREIGN KEY (commande_ligne_id) REFERENCES gestion_ventes_commande_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint2 FOREIGN KEY (ecriture_id) REFERENCES compta_ecriture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint3 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint4 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint5 FOREIGN KEY (stock_mouvement_id) REFERENCES gestion_stock_mouvement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint0 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint1 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint2 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint3 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint4 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint5 FOREIGN KEY (modele_id) REFERENCES base_impression_modele(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint0 FOREIGN KEY (avoir_id) REFERENCES gestion_ventes_avoir(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint1 FOREIGN KEY (facture_ligne_id) REFERENCES gestion_ventes_facture_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint2 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint3 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint4 FOREIGN KEY (stock_mouvement_id) REFERENCES gestion_stock_mouvement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance ADD CONSTRAINT gestion_ventes_relance_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance ADD CONSTRAINT gestion_ventes_relance_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_constraint0 FOREIGN KEY (relance_id) REFERENCES gestion_ventes_relance(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_constraint1 FOREIGN KEY (etape_id) REFERENCES gestion_ventes_relance_mode_etape(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_constraint2 FOREIGN KEY (echeance_id) REFERENCES gestion_ventes_facture_reglement_echeance(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_constraint3 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode ADD CONSTRAINT gestion_ventes_relance_mode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode ADD CONSTRAINT gestion_ventes_relance_mode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode_etape ADD CONSTRAINT gestion_ventes_relance_mode_etape_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode_etape ADD CONSTRAINT gestion_ventes_relance_mode_etape_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode_etape ADD CONSTRAINT gestion_ventes_relance_mode_etape_constraint0 FOREIGN KEY (relance_mode_id) REFERENCES gestion_ventes_relance_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_constraint0 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_constraint2 FOREIGN KEY (relance_mode_id) REFERENCES gestion_ventes_relance_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_constraint3 FOREIGN KEY (reglement_id) REFERENCES gestion_ventes_reglement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement ADD CONSTRAINT gestion_ventes_reglement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement ADD CONSTRAINT gestion_ventes_reglement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement ADD CONSTRAINT gestion_ventes_reglement_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement ADD CONSTRAINT gestion_ventes_reglement_constraint1 FOREIGN KEY (mode_id) REFERENCES gestion_ventes_reglement_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement_mode ADD CONSTRAINT gestion_ventes_reglement_mode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement_mode ADD CONSTRAINT gestion_ventes_reglement_mode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement_mode ADD CONSTRAINT gestion_ventes_reglement_mode_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement_mode ADD CONSTRAINT gestion_ventes_reglement_mode_constraint1 FOREIGN KEY (banque_compte_id) REFERENCES compta_banque_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement ADD CONSTRAINT gestion_ventes_reversement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement ADD CONSTRAINT gestion_ventes_reversement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement ADD CONSTRAINT gestion_ventes_reversement_constraint0 FOREIGN KEY (reglement_id) REFERENCES gestion_ventes_reglement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement ADD CONSTRAINT gestion_ventes_reversement_constraint1 FOREIGN KEY (mode_id) REFERENCES gestion_ventes_reversement_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement_mode ADD CONSTRAINT gestion_ventes_reversement_mode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement_mode ADD CONSTRAINT gestion_ventes_reversement_mode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement_mode ADD CONSTRAINT gestion_ventes_reversement_mode_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement_mode ADD CONSTRAINT gestion_ventes_reversement_mode_constraint1 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_constraint1 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_constraint2 FOREIGN KEY (modele_id) REFERENCES base_impression_modele(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_constraint0 FOREIGN KEY (facture_id) REFERENCES gestion_achats_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_constraint2 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_constraint3 FOREIGN KEY (stock_mouvement_id) REFERENCES gestion_stock_mouvement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_reglement_rel ADD CONSTRAINT gestion_achats_facture_reglement_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_reglement_rel ADD CONSTRAINT gestion_achats_facture_reglement_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_reglement_rel ADD CONSTRAINT gestion_achats_facture_reglement_rel_constraint0 FOREIGN KEY (facture_id) REFERENCES gestion_achats_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_reglement_rel ADD CONSTRAINT gestion_achats_facture_reglement_rel_constraint1 FOREIGN KEY (reglement_id) REFERENCES gestion_achats_reglement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement ADD CONSTRAINT gestion_achats_reglement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement ADD CONSTRAINT gestion_achats_reglement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement ADD CONSTRAINT gestion_achats_reglement_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement ADD CONSTRAINT gestion_achats_reglement_constraint1 FOREIGN KEY (mode_id) REFERENCES gestion_achats_reglement_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement_mode ADD CONSTRAINT gestion_achats_reglement_mode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement_mode ADD CONSTRAINT gestion_achats_reglement_mode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement_mode ADD CONSTRAINT gestion_achats_reglement_mode_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement_mode ADD CONSTRAINT gestion_achats_reglement_mode_constraint1 FOREIGN KEY (banque_compte_id) REFERENCES compta_banque_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_lieu ADD CONSTRAINT gestion_stock_lieu_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_lieu ADD CONSTRAINT gestion_stock_lieu_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_lieu ADD CONSTRAINT gestion_stock_lieu_constraint0 FOREIGN KEY (lieu_id) REFERENCES gestion_stock_lieu(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock ADD CONSTRAINT gestion_stock_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock ADD CONSTRAINT gestion_stock_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock ADD CONSTRAINT gestion_stock_constraint0 FOREIGN KEY (stock_lieu_id) REFERENCES gestion_stock_lieu(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock ADD CONSTRAINT gestion_stock_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_mouvement ADD CONSTRAINT gestion_stock_mouvement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_mouvement ADD CONSTRAINT gestion_stock_mouvement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_mouvement ADD CONSTRAINT gestion_stock_mouvement_constraint0 FOREIGN KEY (stock_id) REFERENCES gestion_stock(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_parametrage ADD CONSTRAINT gestsea_cotisation_parametrage_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_parametrage ADD CONSTRAINT gestsea_cotisation_parametrage_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_parametrage ADD CONSTRAINT gestsea_cotisation_parametrage_constraint0 CHECK (NOT avec_defaut_produit OR (avec_defaut_produit AND defaut_produit_code IS NOT NULL));\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_lot ADD CONSTRAINT gestsea_cotisation_lot_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_lot ADD CONSTRAINT gestsea_cotisation_lot_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_lot ADD CONSTRAINT gestsea_cotisation_lot_constraint0 FOREIGN KEY (cotisation_id) REFERENCES gestsea_cotisation(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe ADD CONSTRAINT gestsea_canton_groupe_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe ADD CONSTRAINT gestsea_canton_groupe_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe_rel ADD CONSTRAINT gestsea_canton_groupe_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe_rel ADD CONSTRAINT gestsea_canton_groupe_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe_rel ADD CONSTRAINT gestsea_canton_groupe_rel_constraint0 FOREIGN KEY (canton_id) REFERENCES base_canton(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe_rel ADD CONSTRAINT gestsea_canton_groupe_rel_constraint1 FOREIGN KEY (groupe_id) REFERENCES gestsea_canton_groupe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure ADD CONSTRAINT gestsea_structure_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure ADD CONSTRAINT gestsea_structure_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure ADD CONSTRAINT gestsea_structure_constraint0 FOREIGN KEY (parent_structure_id) REFERENCES gestsea_structure(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure ADD CONSTRAINT gestsea_structure_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure_commune_rel ADD CONSTRAINT gestsea_structure_commune_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure_commune_rel ADD CONSTRAINT gestsea_structure_commune_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure_commune_rel ADD CONSTRAINT gestsea_structure_commune_rel_constraint0 FOREIGN KEY (structure_id) REFERENCES gestsea_structure(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure_commune_rel ADD CONSTRAINT gestsea_structure_commune_rel_constraint1 FOREIGN KEY (commune_id) REFERENCES base_commune(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure_commande_rel ADD CONSTRAINT gestsea_juridique_procedure_commande_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure_commande_rel ADD CONSTRAINT gestsea_juridique_procedure_commande_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure_commande_rel ADD CONSTRAINT gestsea_juridique_procedure_commande_rel_constraint0 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure_commande_rel ADD CONSTRAINT gestsea_juridique_procedure_commande_rel_constraint1 FOREIGN KEY (procedure_id) REFERENCES gestsea_juridique_procedure(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure ADD CONSTRAINT gestsea_juridique_procedure_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure ADD CONSTRAINT gestsea_juridique_procedure_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_constraint1 FOREIGN KEY (type_id) REFERENCES gestsea_juridique_tache_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_constraint2 FOREIGN KEY (dossier_id) REFERENCES gestsea_juridique_dossier(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_constraint3 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache_type ADD CONSTRAINT gestsea_juridique_tache_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache_type ADD CONSTRAINT gestsea_juridique_tache_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_constraint0 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_constraint1 FOREIGN KEY (etat_id) REFERENCES gestsea_juridique_dossier_etat(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_constraint2 FOREIGN KEY (type_id) REFERENCES gestsea_juridique_dossier_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_commande ADD CONSTRAINT gestsea_juridique_dossier_commande_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_commande ADD CONSTRAINT gestsea_juridique_dossier_commande_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_commande ADD CONSTRAINT gestsea_juridique_dossier_commande_constraint0 FOREIGN KEY (dossier_id) REFERENCES gestsea_juridique_dossier(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_commande ADD CONSTRAINT gestsea_juridique_dossier_commande_constraint1 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_type ADD CONSTRAINT gestsea_juridique_dossier_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_type ADD CONSTRAINT gestsea_juridique_dossier_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_type ADD CONSTRAINT gestsea_juridique_dossier_type_constraint0 FOREIGN KEY (service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_etat ADD CONSTRAINT gestsea_juridique_dossier_etat_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_etat ADD CONSTRAINT gestsea_juridique_dossier_etat_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication ADD CONSTRAINT gestsea_publication_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication ADD CONSTRAINT gestsea_publication_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication ADD CONSTRAINT gestsea_publication_constraint0 FOREIGN KEY (contact_type_id) REFERENCES base_partenaire_contact_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_parution ADD CONSTRAINT gestsea_publication_parution_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_parution ADD CONSTRAINT gestsea_publication_parution_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_parution ADD CONSTRAINT gestsea_publication_parution_constraint0 FOREIGN KEY (publication_id) REFERENCES gestsea_publication(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement ADD CONSTRAINT gestsea_publication_abonnement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement ADD CONSTRAINT gestsea_publication_abonnement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement ADD CONSTRAINT gestsea_publication_abonnement_constraint0 FOREIGN KEY (publication_id) REFERENCES gestsea_publication(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement ADD CONSTRAINT gestsea_publication_abonnement_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint0 FOREIGN KEY (commande_ligne_id) REFERENCES gestion_ventes_commande_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint1 FOREIGN KEY (publication_id) REFERENCES gestsea_publication(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint2 FOREIGN KEY (abonnement_id) REFERENCES gestsea_publication_abonnement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint3 FOREIGN KEY (contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint4 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint0 FOREIGN KEY (commande_id) REFERENCES gestsea_publication_abonnement_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint2 FOREIGN KEY (contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint3 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint4 FOREIGN KEY (facture_ligne_id) REFERENCES gestion_ventes_facture_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint5 FOREIGN KEY (abonnement_id) REFERENCES gestsea_publication_abonnement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint6 FOREIGN KEY (publication_id) REFERENCES gestsea_publication(id);\\n';\n  proc:=proc||'  -- Data without triggers\\n';\n  proc:=proc||'  INSERT INTO base_acces VALUES (1, ''INVITE'', ''InvitÃ©'', 1000000);\\n';\n  proc:=proc||'  INSERT INTO base_acces VALUES (2, ''EXPERTCO'', ''Expert comptable'', 0);\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (1, ''DEFAUT'', ''Par dÃ©faut'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (2, ''DEVIS'', ''Devis'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (3, ''FACTURATION'', ''Facturation'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (4, ''LIVRAISON'', ''Livraison'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (5, ''CONTACT'', ''Contact'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom) VALUES (''Comptant Ã  rÃ©ception'');\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_mois) VALUES (''1 mois'', 1);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, fin_de_mois, defaut) VALUES (''Fin de mois'', true, true);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours) VALUES (''30 jours'', 30);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours) VALUES (''60 jours'', 60);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours) VALUES (''90 jours'', 90);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours, fin_de_mois) VALUES (''30 jours fin de mois'', 30, true);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours, fin_de_mois, prolongation, jour_du_mois) VALUES (''30 jours fin de mois le 10'', 30, true, true, 10);\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (1, ''DEVIS'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (2, ''FACTURE'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (3, ''AVOIR'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (4, ''BALANCE'');\\n';\n  proc:=proc||'  INSERT INTO compta_exercice(code, date_debut, date_fin) VALUES (''EX200607'', ''01/09/2006'', ''31/08/2007'');\\n';\n  proc:=proc||'  INSERT INTO compta_journal_type VALUES (1, ''PURCHASES'', ''AC'', ''Journal des achats'', false, false, NULL, NULL);\\n';\n  proc:=proc||'  INSERT INTO compta_journal_type VALUES (2, ''SALES'', ''VT'', ''Journal des ventes'', false, false, NULL, NULL);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, acces_id) VALUES (6, ''Comptes de charges'', ''6'', NULL, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, acces_id) VALUES (7, ''Comptes de produits'', ''7'', NULL, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, general, parent_compteperm_id, acces_id) VALUES (60, ''Achats (sauf 603)'', ''60'', true, 6, 2);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, acces_id) VALUES (607, ''Achats de marchandises'', ''607'', 60, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general, acces_id) VALUES (70, ''Ventes de produits fabriquÃ©s, prestations de services, marchandises'', ''70'', 7, true, 2);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general, acces_id) VALUES (706, ''Prestations de services'', ''706'', 70, true, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general, acces_id) VALUES (709, ''Rabais, remises et ristournes accordÃ©s par l''''entreprise'', ''709'', 70, true, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general, acces_id) VALUES (71, ''Production stockÃ©e (ou dÃ©stockage)'', ''71'', 7, true, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, acces_id) VALUES (713, ''Variation des stocks (en-cours de production, produits)'', ''713'', 71, 1);\\n';\n  proc:=proc||'  INSERT INTO gestion_produit_categorie(code, nom) VALUES (''GENERAL'', ''Tous les produits'');\\n';\n  proc:=proc||'  INSERT INTO gestion_lien_type VALUES (1, ''ADHESION'', ''Transmission d''''adhÃ©sion'', ''adhÃ¨re pour'', ''a pour adhÃ©rent'');\\n';\n  proc:=proc||'  INSERT INTO gestion_lien_type VALUES (2, ''MEMBRE'', ''Membre'', ''est membre de'', ''a pour membre'');\\n';\n  proc:=proc||'  INSERT INTO gestion_lien_type VALUES (3, ''EMPLOI'', ''Relations professionnelles'', ''travaille pour'', ''a pour employÃ©'');\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_commande_type(nom, validite_delai_id, paiement_delai_id) VALUES (''Standard'', 2, 1);\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode VALUES (1, ''0'', ''Pas de relances'', false);\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode VALUES (2, ''30-50-65'', ''Relances Ã  30, 50 et 65 jours'', true);\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode_etape VALUES (1, 1, 30, ''Message (30 jours)'');\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode_etape VALUES (2, 1, 50, ''Message (50 jours)'');\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode_etape VALUES (3, 1, 65, ''Message (65 jours)'');\\n';\n  proc:=proc||'  INSERT INTO gestsea_juridique_dossier_etat VALUES (1, ''Ouvert'', '''');\\n';\n  proc:=proc||'  INSERT INTO gestsea_juridique_dossier_etat VALUES (2, ''CloturÃ©'', '''');\\n';\n  proc:=proc||'  INSERT INTO gestsea_juridique_dossier_etat VALUES (3, ''AbandonnÃ©'', '''');\\n';\n  proc:=proc||'  -- Procedures\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_rights() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  query     text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  employe   base_societe_employe%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  module    base_droits_module%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  profil    base_droits_profil%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  droits    record;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  nb_priv   integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  tt_revoke integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  tt_grant  integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  reste_emp  integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  tt_revoke:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  tt_grant :=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''-- revoke all on all from all;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  FOR module IN SELECT * FROM base_droits_module LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    query:=''''REVOKE ALL ON ''''||module.objets||'''' FROM '''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    reste_emp:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FOR employe IN SELECT * FROM base_societe_employe AS emp WHERE emp.utilisateur_login IN (SELECT usename FROM pg_user) LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF reste_emp>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:=query||employe.utilisateur_login;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      reste_emp:=1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    tt_revoke:=tt_revoke+1;	\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''-- grant pro on pro to pro;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  FOR profil IN SELECT * FROM base_droits_profil LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FOR droits IN SELECT objets, COALESCE(selection,false) AS sel, COALESCE(insertion,false) AS ins, COALESCE(modification,false) AS mod, COALESCE(suppression,false) AS sup \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''                    FROM base_droits_profil_module LEFT JOIN base_droits_module ON (module_id=base_droits_module.id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''                    WHERE base_droits_profil_module.profil_id=profil.id LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:='''''''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      nb_priv:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF droits.sel THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||''''SELECT'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        nb_priv:=nb_priv+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF droits.ins THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF nb_priv>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||''''INSERT'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        nb_priv:=nb_priv+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF droits.mod THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF nb_priv>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||''''UPDATE'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        nb_priv:=nb_priv+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF droits.sup THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF nb_priv>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||''''DELETE'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        nb_priv:=nb_priv+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:=''''GRANT ''''||query||'''' ON ''''||droits.objets||'''' TO '''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF nb_priv>0 AND query IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        reste_emp:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FOR employe IN SELECT * FROM base_societe_employe AS emp WHERE emp.profil_id=profil.id AND emp.utilisateur_login IN (SELECT usename FROM pg_user) LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          IF reste_emp>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''            query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          query:=query||employe.utilisateur_login;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          reste_emp:=1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        tt_grant :=tt_grant+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RAISE NOTICE ''''REVOKE %, GRANT %.'''',tt_revoke,tt_grant;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN New;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_societe_etablissement() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nui||'''' ''''||NEW.nic FROM base_societe WHERE id=NEW.societe_id INTO NEW.siret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_societe_employe() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT login FROM systeme_utilisateur WHERE id=NEW.utilisateur_id INTO NEW.utilisateur_login;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_partenaire() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.nom_soundex2 := soundex2(NEW.nom);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.nom_phonex   := phonex(NEW.nom);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT morale, titre FROM base_partenaire_type\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.type_id INTO NEW.morale, NEW.titre;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.libelle := SUBSTR(COALESCE(NEW.titre||'''' '''','''''''')||NEW.nom||COALESCE('''' ''''||NEW.prenom,''''''''),1,38);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_partenaire_type() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.morale!=OLD.morale OR NEW.titre!=OLD.titre THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      UPDATE base_partenaire SET titre=NEW.titre, morale=NEW.morale WHERE type_id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.civilites IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.civilites := NEW.titre;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_contact() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT codepostal_id, commune_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM base_codepostal_commune_rel \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.codepostal_commune_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.codepostal_id, NEW.commune_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT numero FROM base_codepostal WHERE id=NEW.codepostal_id INTO NEW.codepostal;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nom FROM base_commune WHERE id=NEW.commune_id INTO NEW.commune;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT UPPER(NEW.numero), UPPER(NEW.voie), UPPER(NEW.ligne5)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.numero,NEW.voie,NEW.ligne5;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NOT NEW.actif AND OLD.actif THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date_fin := ''''now''''::DATE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.actif := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_contact() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INSERT INTO base_partenaire_contact_version(contact_id) VALUES (NEW.id);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_contact_version() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Cette opÃ©ration est interdite. Une version ne peut Ãªtre supprimÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime_debut := OLD.datetime_debut;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.complement := OLD.complement;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.ligne3     := OLD.ligne3;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.numero     := OLD.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.voie       := OLD.voie;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.ligne5     := OLD.ligne5;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.codepostal_commune_id := OLD.codepostal_commune_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.codepostal_id := OLD.codepostal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.commune_id := OLD.commune_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.codepostal := OLD.codepostal;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.commune    := OLD.commune;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.telephone  := OLD.telephone;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.mobile     := OLD.mobile;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.fax        := OLD.fax;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.email      := OLD.email;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM base_partenaire_contact_version\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE contact_id=NEW.contact_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total=0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.datetime_debut := ''''-infinity''''::timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.datetime_debut := ''''now''''::timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE base_partenaire_contact_version SET datetime_fin=''''now''''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE datetime_fin>CURRENT_TIMESTAMP AND contact_id=NEW.contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime_fin := ''''infinity''''::timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT complement,ligne3,numero,voie,ligne5,codepostal_commune_id,codepostal_id,commune_id,codepostal,commune\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM base_partenaire_contact\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE id=NEW.contact_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO NEW.complement,NEW.ligne3,NEW.numero,NEW.voie,NEW.ligne5,NEW.codepostal_commune_id,NEW.codepostal_id, NEW.commune_id, NEW.codepostal, NEW.commune;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_contact_type() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (TG_OP=''''DELETE'''') THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''This type mustn''''''''t be removed.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN OLD;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.id := OLD.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.code := OLD.code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immuable := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;    \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_partenaire_attribut() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nom FROM base_partenaire_attribut_type WHERE id=NEW.type_id INTO NEW.type_nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nom FROM base_partenaire_attribut_categorie WHERE id=NEW.categorie_id INTO NEW.categorie_nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_get_delai_date(IN a_delai_id INTEGER,IN a_date DATE) RETURNS DATE AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_interval integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_delai base_delai%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_ret date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT * FROM base_delai WHERE id=a_delai_id INTO p_delai;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_ret := a_date+(p_delai.nb_mois||'''' months'''')::interval;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_ret := a_date+p_delai.nb_jours;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_delai.fin_de_mois THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT fc_get_nb_jours_dans_mois(p_ret) INTO p_interval;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_ret := p_interval::text||''''/''''||EXTRACT(MONTH FROM p_ret)||''''/''''||EXTRACT(YEAR FROM p_ret)::text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF p_delai.prolongation THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT fc_get_nb_jours_dans_mois(p_ret+1) INTO p_interval;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      p_ret := p_ret + CASE WHEN p_delai.jour_du_mois>p_interval THEN p_interval ELSE p_delai.jour_du_mois END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN p_ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_impression_modele() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE base_impression_modele SET datetime_fin=''''now'''' WHERE datetime_fin=''''infinity'''' AND impression_id=NEW.impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime_debut := ''''now'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime_fin   := ''''infinity'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.impression_id!=OLD.impression_id THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.impression_id:=OLD.impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.modele!=OLD.modele THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO base_impression_modele (impression_id,modele) SELECT NEW.impression_id, NEW.modele;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.modele := OLD.modele;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_impression() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO base_impression_modele (impression_id,modele) SELECT NEW.id, NEW.modele;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.modele!=OLD.modele THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO base_impression_modele (impression_id,modele) SELECT NEW.id, NEW.modele;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_impression_type() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''This type mustn''''''''t be removed.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_get_impression_modele_id(IN a_impression_id INTEGER,IN a_modele_id INTEGER) RETURNS INTEGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ret base_impression_modele.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_modele_id base_impression_modele.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF a_impression_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''La vÃ©rification du modÃ¨le de l''''''''impression n''''''''est pas possible car l''''''''impression Ã  vÃ©rifier est inconnue.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_modele_id := a_modele_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_modele_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_impression_modele WHERE id=p_modele_id AND impression_id=a_impression_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      p_modele_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ret := p_modele_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_modele_id IS NULL THEN     \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_impression_modele WHERE impression_id=a_impression_id AND datetime_fin=''''infinity'''' INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Il n''''''''y a pas de modÃ¨le d''''''''impressions en service pour ce type de document.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF total>1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Erreur du systÃ¨me : Plusieurs modÃ¨les sont en service pour l''''''''impression %'''',a_impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_impression_modele WHERE impression_id=a_impression_id AND datetime_fin=''''infinity'''' INTO ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_get_impression_id(IN a_impression_id INTEGER,IN a_type_id INTEGER) RETURNS INTEGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_impression_id base_impression.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ret base_impression.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF a_type_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''La vÃ©rification de l''''''''impression n''''''''est pas possible car le type d''''''''impression est inconnu.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_impression_id := a_impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_impression_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_impression WHERE id=p_impression_id AND type_id=a_type_id AND actif INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      p_impression_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ret := p_impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_impression_id IS NULL THEN     \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_impression WHERE type_id=a_type_id AND actif INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Il n''''''''y a pas d''''''''impressions en service pour ce type de document.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_impression WHERE type_id=a_type_id AND actif ORDER BY defaut DESC INTO ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_build_printer() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  pfb_modele text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  print_code text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  query text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM information_schema.routines WHERE routine_schema=pfb_schema AND routine_name=''''prPDF_''''||NEW.code INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (total>=1) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    query:=''''DROP FUNCTION ''''||pfb_schema||''''.prPDF_''''||print_code||''''(integer);'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (TG_OP!=''''DELETE'''') THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT fc_build_printer(pfb_schema,NEW.modele,''''prPDF_''''||NEW.code,''''/tmp'''');\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_ecriture() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (NEW.debit_d>0 AND NEW.credit_d>0) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Le dÃ©bit ou le crÃ©dit doit Ãªtre Ã  0.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (NEW.compteperm IS NULL) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Le compte (permanent) de l''''''''Ã©criture doit Ãªtre renseignÃ©.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.devis_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_devise WHERE defaut INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Une seule et unique devise doit Ãªtre dÃ©finie par dÃ©faut.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_devise WHERE defaut INTO NEW.devise_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT taux FROM base_devise WHERE id=NEW.devise_id INTO NEW.devise_taux;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.debit_d-NEW.credit_d INTO NEW.solde_d;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.debit_d*NEW.devise_taux INTO NEW.debit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.credit_d*NEW.devise_taux INTO NEW.credit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.debit-NEW.credit INTO NEW.solde;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT numero, compteperm_id, fc_get_compte(compteperm_id) FROM compta_compteperm WHERE id=NEW.compteperm_id INTO NEW.compte_numero, NEW.compteperm_id, NEW.compte_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT date, journal_id FROM compta_piece WHERE id=NEW.piece_id INTO NEW.piece_date, NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT code FROM compta_journal WHERE id=NEW.journal_id INTO NEW.journal_code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM compta_compte_cumul WHERE mois=EXTRACT(MONTH FROM NEW.piece_date)::integer AND annee=EXTRACT(YEAR FROM NEW.piece_date)::integer AND compteperm_id=NEW.compteperm_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO compta_compte_cumul(compteperm_id,mois,annee) SELECT NEW.compteperm_id, EXTRACT(MONTH FROM NEW.piece_date)::integer, EXTRACT(YEAR FROM NEW.piece_date)::integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF total>1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Un seul cumul par mois et par compte peut Ãªtre crÃ©Ã©.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM compta_compte_cumul WHERE mois=EXTRACT(MONTH FROM NEW.piece_date)::integer AND annee=EXTRACT(YEAR FROM NEW.piece_date)::integer AND compteperm_id=NEW.compteperm_id INTO NEW.cumul_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_compta_ecriture() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE compta_piece SET debit=sum(ecr.debit), credit=sum(ecr.credit) FROM compta_ecriture as ecr WHERE compta_piece.id=piece_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE compta_pointage SET debit=sum(ecr.debit), credit=sum(ecr.credit), nb_ecritures=count(ecr.id) FROM compta_ecriture as ecr WHERE compta_pointage.id=pointage_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE compta_compte SET debit=sum(ecr.debit), credit=sum(ecr.credit), nb_ecritures=count(ecr.id) FROM compta_ecriture as ecr WHERE compta_compte.id=compte_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE compta_compte_cumul SET debit=sum(ecr.debit), credit=sum(ecr.credit), nb_ecritures=count(ecr.id) FROM compta_ecriture as ecr WHERE compta_compte_cumul.id=cumul_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_piece() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.debit:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.credit:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM compta_exercice WHERE actif AND NOT cloture INTO total; \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Il n''''''''y a pas un seul et unique exercice actif.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.exercice_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT id FROM compta_exercice WHERE actif AND NOT cloture INTO NEW.exercice_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT cloture FROM compta_exercice WHERE id=NEW.exercice_id INTO ok; \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''L''''''''exercice comptable choisi est dÃ©jÃ  clotÃ»rÃ©. Vous ne pouvez pas rajouter des piÃ¨ces.''''; \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (NEW.date IS NULL) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''La piÃ¨ce doit Ãªtre datÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT code FROM compta_exercice WHERE id=NEW.exercice_id INTO NEW.exercice_code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.debit-NEW.credit INTO NEW.solde;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM compta_journal WHERE mois=EXTRACT(MONTH FROM NEW.date)::integer AND annee=EXTRACT(YEAR FROM NEW.date)::integer AND type_id=NEW.journal_type_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO compta_journal(type_id,mois,annee) SELECT NEW.journal_type_id, EXTRACT(MONTH FROM NEW.date)::integer, EXTRACT(YEAR FROM NEW.date)::integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF total>1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Un seul journal par mois et par type doit Ãªtre ouvert.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT id FROM compta_journal WHERE mois=EXTRACT(MONTH FROM NEW.date)::integer AND annee=EXTRACT(YEAR FROM NEW.date)::integer AND type_id=NEW.journal_type_id INTO NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT COALESCE(MAX(numero),0)+1 FROM compta_piece WHERE journal_id=NEW.journal_id INTO NEW.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_compta_piece() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_journal  SET debit=debit+NEW.debit, credit=credit+NEW.credit WHERE id=NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_exercice SET debit=debit+NEW.debit, credit=credit+NEW.credit, nb_ecritures=nb_ecritures+1 WHERE id=NEW.exercice_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_journal  SET debit=debit+NEW.debit-OLD.debit, credit=credit+NEW.credit-OLD.credit WHERE id=NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_exercice SET debit=debit+NEW.debit-OLD.debit, credit=credit+NEW.credit-OLD.credit WHERE id=NEW.exercice_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_journal  SET debit=debit-OLD.debit, credit=credit-OLD.credit WHERE id=NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_exercice SET debit=debit-OLD.debit, credit=credit-OLD.credit, nb_ecritures=nb_ecritures-1 WHERE id=NEW.exercice_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_standard() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.debit  := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.credit := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.nb_ecritures := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.solde := NEW.debit-NEW.credit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_journal() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.debit  := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.credit := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT debit_compteperm_id, provisoire, contrepartie, code||NEW.annee||to_char(NEW.mois,''''FM09''''), nom||'''' (''''||to_char(NEW.mois,''''FM09'''')||''''/''''||NEW.annee||'''')'''' FROM compta_journal_type WHERE id=NEW.type_id INTO NEW.debit_compteperm_id, NEW.provisoire, NEW.contrepartie, NEW.code, NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.solde := NEW.debit-NEW.credit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_compte() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  parent_numero text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.debit  := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.credit := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.nb_ecritures    := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.derniere_lettre := '''''''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT parent.numero FROM compta_compteperm AS fils LEFT JOIN compta_compteperm AS parent ON (parent.id=fils.parent_compteperm_id) WHERE fils.id=NEW.compteperm_id INTO parent_numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF LENGTH(COALESCE(parent_numero,''''''''))!=0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT count(*) FROM compta_compte WHERE numero=parent_numero INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        INSERT INTO compta_compte(compteperm_id, exercice_id) SELECT parent_compteperm_id, NEW.exercice_id FROM compta_compteperm WHERE id=NEW.compteperm_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT nom,numero,acces_id,immuable,signe,general,accept_aux,utilisable,lettrable,pointable,groupable,echeance,note FROM compta_compteperm WHERE id=NEW.compteperm_id INTO NEW.nom,NEW.numero,NEW.acces_id,NEW.immuable,NEW.signe,NEW.general,NEW.accept_aux,NEW.utilisable,NEW.lettrable,NEW.pointable,NEW.groupable,NEW.echeance,NEW.note;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM compta_compte WHERE numero=parent_numero INTO NEW.parent_compte_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.numero:=OLD.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immuable := TRUE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT OLD.nom,OLD.numero,OLD.acces_id,OLD.immuable,OLD.signe,OLD.general,OLD.accept_aux,OLD.utilisable,OLD.lettrable,OLD.pointable,OLD.groupable,OLD.echeance INTO NEW.nom,NEW.numero,NEW.acces_id,NEW.immuable,NEW.signe,NEW.general,NEW.accept_aux,NEW.utilisable,NEW.lettrable,NEW.pointable,NEW.groupable,NEW.echeance;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.solde := NEW.debit-NEW.credit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compte_cumul() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.compteperm_id := OLD.compteperm_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT numero, nom||'''' (''''||NEW.mois||''''/''''||NEW.annee||'''')'''' FROM compta_compteperm WHERE id=NEW.compteperm_id INTO NEW.numero, NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_nextval(IN a_sequence_code CHARACTER VARYING(16)) RETURNS INTEGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  number gestion_sequence.dernier_numero%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  cle integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  indice_jour integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  indice_mois integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  indice_annee integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  datetime timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  seq gestion_sequence%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT CURRENT_TIMESTAMP INTO datetime;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT * FROM gestion_sequence WHERE code=a_sequence_code FOR UPDATE INTO seq;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT EXTRACT(YEAR FROM datetime) INTO indice_jour, indice_mois, indice_annee;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE gestion_sequence SET jour=seq.jour,mois=seq.mois,annee=seq.annee WHERE code=seq.code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nextval(seq.sequence) INTO cle;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT COALESCE(TO_CHAR(CURRENT_TIMESTAMP, seq.prefixe),'''''''')||COALESCE(TO_CHAR(cle, seq.corps),'''''''')||COALESCE(TO_CHAR(CURRENT_TIMESTAMP, seq.suffixe),'''''''') INTO number;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN number;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_sequence() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  query text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' OR TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT TO_CHAR(CURRENT_TIMESTAMP,NEW.prefixe) INTO query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT TO_CHAR(4,NEW.corps) INTO query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT TO_CHAR(CURRENT_TIMESTAMP,NEW.suffixe) INTO query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.sequence:=LOWER(''''gestion_sequences_''''||NEW.code||round(99*random())||''''_seq'''');\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    query:=''''CREATE SEQUENCE ''''||NEW.sequence||'''' INCREMENT BY 1 START WITH ''''||NEW.start;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    return NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immuable := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.code     := OLD.code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.sequence := OLD.sequence;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.start!=OLD.start THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:=''''ALTER SEQUENCE ''''||NEW.sequence||'''' RESTART WITH ''''||NEW.start;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF (NEW.quotidienne AND OLD.jour!=NEW.jour) OR (NEW.mensuelle AND OLD.mois!=NEW.mois) OR (NEW.annuelle AND OLD.annee!=NEW.annee) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:=''''ALTER SEQUENCE ''''||NEW.sequence||'''' RESTART WITH 0'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    query:=''''DROP SEQUENCE ''''||NEW.sequence;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    return OLD;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_produit_taxe() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.code:=OLD.code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.taux!=NEW.taux OR OLD.montant!=NEW.montant OR OLD.compteperm_id!=NEW.compteperm_id THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Une taxe ne peut pas Ãªtre mise Ã  jour. Il est seulement possible d''''''''en ajouter ou d''''''''en supprimer.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_produit_prix_taxe_rel() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_prix_id gestion_produit_prix.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_montant_ht gestion_produit_prix.montant_ht%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_montant_taxes gestion_produit_prix.montant_ht%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' OR TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_prix_id := NEW.prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_prix_id := OLD.prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT montant_ht FROM gestion_produit_prix WHERE id=p_prix_id INTO p_montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT ROUND(COALESCE(SUM(rel.base_montant+taxe.taux*p_montant_ht+taxe.montant),0),2)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_produit_prix_taxe_rel AS rel \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         JOIN gestion_produit_taxe AS taxe ON (taxe_id=taxe.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE rel.prix_id=p_prix_id INTO p_montant_taxes;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE gestion_produit_prix SET montant_ttc=p_montant_ht+p_montant_taxes WHERE id=p_prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_produit_prix() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_prix_id gestion_produit_prix.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_ttc := NEW.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM gestion_produit_prix \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE date_fin IN (SELECT max(date_fin) FROM gestion_produit_prix WHERE produit_id=NEW.produit_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO p_prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestion_produit_prix_taxe_rel (prix_id, taxe_id, base_montant)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT prix_id, taxe_id, base_montant\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_produit_prix_taxe_rel WHERE prix_id=p_prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.produit_id    := OLD.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.achat         := OLD.achat;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.partenaire_id := OLD.partenaire_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_ht    := OLD.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.date_debut    := OLD.date_debut;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.date_fin>NEW.date_fin THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date_fin := OLD.date_fin;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.date_debut>OLD.date_debut THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date_debut := OLD.date_debut;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT code||'''' ''''||TRIM(nom)||'''' / ''''||NEW.montant_ttc||'''' TTC / ''''||NEW.montant_ht||'''' HT''''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_produit\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.produit_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.libelle;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_get_reduction_rate(IN a_partenaire_id INTEGER,IN a_date DATE) RETURNS NUMERIC(16,8) AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_periode_id gestion_adhesion_periode.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_ret gestion_reduction.taux%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_adhesion \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE periode_date_fin>=a_date AND a_date>=periode_date_debut AND partenaire_id=a_partenaire_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ORDER BY periode_date_fin DESC\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INTO p_periode_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT COALESCE(MAX(reduc.taux),0.00)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_adhesion AS adhesion \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         JOIN gestion_reduction AS reduc ON (reduc.id=reduction_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE periode_id=p_periode_id AND partenaire_id=a_partenaire_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INTO p_ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_ret IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_ret := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN p_ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_lien() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_role_type_id gestion_lien_type.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT type_id FROM gestion_lien_role WHERE id=NEW.role_id INTO p_role_type_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.type_id!=p_role_type_id THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Le rÃ´le et le type de lien doivent Ãªtre en adÃ©quation.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT p1.libelle||'''' ''''||t.phrase_directe||'''' ''''||p2.libelle||r.prefixe||r.nom||r.suffixe\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM base_partenaire AS p1,\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         base_partenaire AS p2,\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''	 gestion_lien_type AS t,\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''	 gestion_lien_role AS r\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE p1.id=NEW.partenaire1_id AND p2.id=NEW.partenaire2_id AND t.id=NEW.type_id AND r.id=NEW.role_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.libelle;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_lien_role() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT ''''[''''||type.code||''''] ''''||NEW.nom FROM gestion_lien_type AS type WHERE id=NEW.type_id INTO NEW.nom_etendu;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_adhesion() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nom, facture_id, COALESCE(NEW.partenaire_id,partenaire_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_ventes_facture_ligne JOIN gestion_ventes_facture AS facture ON (facture_id=facture.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.facture_ligne_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.produit_nom, NEW.facture_id, NEW.partenaire_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT date_debut, date_fin \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_adhesion_periode \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.periode_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.periode_date_debut, NEW.periode_date_fin;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT type_nom\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_adhesion_type\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.type_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.type_nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM gestion_adhesion_transmission WHERE adhesion_type_id=NEW.type_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF total>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestion_adhesion (partenaire_id,facture_ligne_id,periode_id,type_id,reduction_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT lien.pid,NEW.facture_ligne_id,NEW.periode_id,NEW.type_id,NEW.reduction_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM (SELECT CASE WHEN sens_inverse THEN partenaire1_id ELSE partenaire2_id END AS pid\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''                FROM gestion_lien JOIN gestion_adhesion_transmission ON (type_id=lien_type_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''                WHERE adhesion_type_id=NEW.type_id AND (CASE WHEN sens_inverse THEN partenaire2_id ELSE partenaire1_id END)=NEW.partenaire_id) AS lien;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_commande() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  default_contact_id base_partenaire_contact.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  contact_id base_partenaire_contact.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_montant_ttc gestion_ventes_commande.montant_ttc%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_montant_ht  gestion_ventes_commande.montant_ht%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' OR TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immodifiable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Une commande passÃ©e en facture est verrouillÃ©e et ne peut Ãªtre modifiÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.partenaire_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Une commande doit Ãªtre faite pour une personne/sociÃ©tÃ© donnÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.employe_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_societe_employe WHERE utilisateur_login=CURRENT_USER INTO NEW.employe_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.type_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM gestion_ventes_commande_type WHERE defaut AND actif INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT id FROM gestion_ventes_commande_type WHERE defaut AND actif INTO NEW.type_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Aucun type n''''''''a Ã©tÃ© spÃ©cifiÃ©.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT COALESCE(SUM(lig.montant_ttc),0), COALESCE(SUM(lig.montant_ht),0) FROM gestion_ventes_commande_ligne AS lig WHERE lig.commande_id=NEW.id INTO NEW.montant_ttc, NEW.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT rolsuper FROM pg_authid WHERE rolname=current_user INTO ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (NEW.commande_contact_id IS NULL OR NEW.facture_contact_id IS NULL OR NEW.livraison_contact_id IS NULL) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    default_contact_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''Pour rÃ©aliser une commande le client doit avoir au moins une adresse.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF total=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id INTO default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.commande_contact_id  := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.facture_contact_id   := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.livraison_contact_id := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id ORDER BY type_id INTO default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NEW.commande_contact_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT count(*) FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=2 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          NEW.commande_contact_id := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=2 INTO NEW.commande_contact_id;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NEW.facture_contact_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT count(*) FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=3 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          NEW.facture_contact_id := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=3 INTO NEW.facture_contact_id;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NEW.livraison_contact_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT count(*) FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=4 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          NEW.livraison_contact_id := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=4 INTO NEW.livraison_contact_id;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_current_contact_version(NEW.commande_contact_id) INTO NEW.commande_version_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_impression_id(NEW.impression_id,1) INTO NEW.impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_impression_modele_id(NEW.impression_id, NEW.modele_id) INTO NEW.modele_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT validite_delai_id, avec_signature, fc_get_delai_date(validite_delai_id,NEW.date)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_ventes_commande_type\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.type_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.validite_delai_id, NEW.avec_signature, NEW.validite_date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_reduction_rate(NEW.partenaire_id, NEW.date) INTO NEW.reduction_taux;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.numero IS NULL OR NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT fc_nextval(''''COMMANDE'''') INTO NEW.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_commande_ligne() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  commande_date gestion_ventes_commande.date%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  commande_reduction gestion_ventes_commande.reduction_taux%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  sans_stock boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' OR TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immodifiable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''Une ligne d''''''''une commande passÃ©e en facture est immodifiable et ineffaÃ§able.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immodifiable     := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.nom               := OLD.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.commande_id        := OLD.commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.produit_id         := OLD.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.prix_id             := OLD.prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_id            := OLD.stock_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_mouvement_id   := OLD.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.reduction            := OLD.reduction;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_unitaire_ttc := OLD.montant_unitaire_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_unitaire_ht  := OLD.montant_unitaire_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.quantite            := OLD.quantite;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_brut_ttc    := OLD.montant_brut_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_brut_ht    := OLD.montant_brut_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ttc        := OLD.montant_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ht        := OLD.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.description      := OLD.description;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.inclus    := FALSE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.inclus AND NOT NEW.a_inclure THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.inclus  := FALSE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' OR TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.prix_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Il faut spÃ©cifier quel produit/prix vous voulez utiliser.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT montant_ht, montant_ttc, produit_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestion_produit_prix \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE id=NEW.prix_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO NEW.montant_unitaire_ht, NEW.montant_unitaire_ttc, NEW.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT date, reduction FROM gestion_ventes_commande WHERE id=NEW.commande_id INTO commande_date, commande_reduction;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT nom, reduction, sans_stock FROM gestion_produit WHERE id=NEW.produit_id INTO NEW.nom, NEW.reduction, sans_stock;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM gestion_produit WHERE id=NEW.produit_id  AND COALESCE(date_fin,''''31/12/9999'''')>=commande_date AND commande_date>=date_debut INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Le produit ''''''''%'''''''' n''''''''est pas en service au moment de l''''''''Ã©tablissement du commande.'''',NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF sans_stock THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_mouvement_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT count(*) FROM gestion_stock WHERE id=NEW.stock_id AND produit_id=NEW.produit_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        NEW.stock_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NEW.stock_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT count(*) FROM gestion_stock WHERE produit_id=NEW.produit_id AND actif INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          RAISE EXCEPTION ''''Le produit ''''''''%'''''''' qui est dÃ©clarÃ© comme possÃ©dant un stock, n''''''''en possÃ¨de pas en rÃ©alitÃ©.'''',NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT id FROM gestion_stock WHERE produit_id=NEW.produit_id AND actif ORDER BY defaut DESC INTO NEW.stock_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=NEW.quantite THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''La quantitÃ© du produit doit Ãªtre supÃ©rieure ou Ã©gale Ã  1.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_brut_ht  := NEW.quantite*NEW.montant_unitaire_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_brut_ttc := NEW.quantite*NEW.montant_unitaire_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NOT NEW.reduction THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      commande_reduction := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_ht  := NEW.montant_brut_ht*(1-commande_reduction);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_ttc := NEW.montant_brut_ttc*(1-commande_reduction);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN OLD;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_ventes_commande_ligne() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_id gestion_ventes_commande.date%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.stock_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT nextval(''''gestion_stock_mouvement_id_seq'''') INTO NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO gestion_stock_mouvement (id,stock_id,quantite,virtuel,date) SELECT NEW.stock_mouvement_id, NEW.stock_id, -NEW.quantite, true, ''''now''''::date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.stock_id IS NULL AND OLD.stock_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      DELETE FROM gestion_stock_mouvement WHERE id=NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF NEW.stock_id IS NOT NULL AND OLD.stock_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      UPDATE gestion_stock_mouvement SET stock_id=NEW.stock_id, quantite=-NEW.quantite, virtuel=true, date=''''now''''::date WHERE id=NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF NEW.stock_id IS NOT NULL AND OLD.stock_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT nextval(''''gestion_stock_mouvement_id_seq'''') INTO NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO gestion_stock_mouvement (id,stock_id,quantite,virtuel,date) SELECT NEW.stock_mouvement_id, NEW.stock_id, -NEW.quantite, true, ''''now''''::date;      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.stock_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      DELETE FROM gestion_stock_mouvement WHERE id=NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;    \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_commande_id := OLD.commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_commande_id := NEW.commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE gestion_ventes_commande SET montant_ttc=COALESCE(SUM(lig.montant_ttc),0), montant_ht=COALESCE(SUM(lig.montant_ht),0) FROM gestion_ventes_commande_ligne AS lig WHERE id=p_commande_id AND lig.commande_id=p_commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_facture() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_piece_id compta_piece.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_piece_libelle compta_piece.libelle%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_piece_journal_type_id compta_piece.journal_type_id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_abrev text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' OR TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immodifiable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''Une facture ne peut pas Ãªtre supprimÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immodifiable   := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.commande_id    := OLD.commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.employe_id     := OLD.employe_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.partenaire_id  := OLD.partenaire_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.numero         := OLD.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date           := OLD.date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.reduction_taux := OLD.reduction_taux;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ttc    := OLD.montant_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ht     := OLD.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' OR TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.commande_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Vous devez obligatoirement utiliser une commande pour crÃ©er une facture.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT avec_bons_livraison FROM gestion_ventes_commande WHERE id=NEW.commande_id INTO ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''La gestion des bons de livraison n''''''''est pas encore implÃ©mentÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT fc_get_impression_id(NEW.impression_id,2) INTO NEW.impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT fc_get_impression_modele_id(NEW.impression_id, NEW.modele_id) INTO NEW.modele_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.date IS NULL OR NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date := ''''now''''::date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT partenaire_id,employe_id,reduction_taux, objet, civilites, montant_ht, montant_ttc, fc_get_current_contact_version(facture_contact_id), fc_get_current_contact_version(livraison_contact_id),paiement_delai_id, fc_get_delai_date(paiement_delai_id,NEW.date)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestion_ventes_commande AS com\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''           JOIN gestion_ventes_commande_type AS type ON (type_id=type.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE com.id=NEW.commande_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO NEW.partenaire_id, NEW.employe_id, NEW.reduction_taux, NEW.objet, NEW.civilites, NEW.montant_ht, NEW.montant_ttc, NEW.facture_version_id, NEW.livraison_version_id,NEW.paiement_delai_id,NEW.paiement_date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    /* Piece */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''/*\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT nextval(''''compta_piece_id_seq'''') INTO p_piece_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id, abrev FROM compta_journal_type WHERE code=''''SALES'''' INTO p_piece_journal_type_id, p_abrev;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF p_piece_journal_type_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Un seul et unique journal de ventes (SALES) doit exister pour faire des factures.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_piece_libelle :=''''[''''||COALESCE(p_abrev,'''''''')||''''][''''||NEW.partenaire_id||''''] ''''''''''''||COALESCE(NEW.objet,'''''''')||'''''''''''''''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO compta_piece(id,libelle,date,echeance,journal_type_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      VALUES (p_piece_id,p_piece_libelle,NEW.date,NEW.delai_date,p_piece_journal_type_id);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.piece_id  := p_piece_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''*/\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT rolsuper FROM pg_authid WHERE rolname=current_user INTO ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.numero IS NULL OR NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT fc_nextval(''''FACTURE'''') INTO NEW.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_ventes_facture() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Lignes (Ecritures, Adhesion...) */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INSERT INTO gestion_ventes_facture_ligne (facture_id, commande_ligne_id)  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT NEW.id, ligne.id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestion_ventes_commande_ligne AS ligne \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE ligne.a_inclure AND NOT ligne.inclus;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Ligne TVA\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INSERT INTO compta_ecriture (libelle,debit_d,credit_d,compte_id,piece_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT taxe.nom, 0, SUM(fc_get_taxe_montant(ligne.montant_ht,taxe.id)), fc_get_compte(taxe.compteperm_id), NEW.piece_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestion_ventes_facture_ligne AS ligne LEFT JOIN gestion_produit_taxe_rel AS rel USING (produit_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''           LEFT JOIN gestion_produit_taxe AS taxe ON (taxe.id=taxe_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE taxe.actif GROUP BY taxe.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Ligne Contrepartie\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INSERT INTO compta_ecriture (libelle,debit_d,credit_d,compte_id,piece_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT partenaire.id||'''' ''''||partenaire.nom, NEW.montant_ttc, 0, fc_get_compte(partenaire.compteperm_id), NEW.piece_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM base_partenaire LEFT JOIN compta_compteperm_partenaire_rel ON (partenaire.id=partenaire_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE partenaire.id = NEW.partenaire_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_facture_ligne() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_facture_reduction gestion_ventes_facture.reduction_taux%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_piece_id compta_piece.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_compteperm_id compta_compteperm.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_facture_date gestion_ventes_facture.date%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  sans_stock boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_avec_bons_livraison boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_id integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' OR TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immodifiable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''Une ligne de facture ne peut pas Ãªtre supprimÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immodifiable         := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.nom                  := OLD.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.ecriture_id          := OLD.ecriture_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.commande_ligne_id    := OLD.commande_ligne_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.facture_id           := OLD.facture_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.produit_id           := OLD.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.prix_id              := OLD.prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_id             := OLD.stock_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_mouvement_id   := OLD.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.reduction            := OLD.reduction;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_unitaire_ttc := OLD.montant_unitaire_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_unitaire_ht  := OLD.montant_unitaire_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.quantite             := OLD.quantite;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_brut_ttc     := OLD.montant_brut_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_brut_ht      := OLD.montant_brut_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ttc          := OLD.montant_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ht           := OLD.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.description          := OLD.description;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    /* Affectation des principales valeurs */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT produit_id,prix_id,stock_mouvement_id,reduction, description, commande_id FROM gestion_ventes_commande_ligne WHERE id=NEW.commande_ligne_id INTO NEW.produit_id, NEW.prix_id, NEW.stock_mouvement_id, NEW.reduction, NEW.description, p_commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT avec_bons_livraison FROM gestion_ventes_commande WHERE id=p_commande_id INTO p_avec_bons_livraison;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT date, reduction, piece_id FROM gestion_ventes_facture WHERE id=NEW.facture_id INTO p_facture_date, p_facture_reduction, p_piece_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF p_avec_bons_livraison THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Les bons de livraisons ne sont pas encore gÃ©rÃ©s.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      /* Recup des montants tel que (sans bons de livraisons) */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT quantite, montant_unitaire_ttc, montant_unitaire_ht, montant_brut_ttc, montant_brut_ht, montant_ttc, montant_ht \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_ventes_commande_ligne \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        INTO NEW.quantite, NEW.montant_unitaire_ttc, NEW.montant_unitaire_ht, NEW.montant_brut_ttc, NEW.montant_brut_ht, NEW.montant_ttc, NEW.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    /* Ecriture */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM gestion_produit_compteperm_rel WHERE produit_id=NEW.produit_id AND date_fin>=p_facture_date AND p_facture_date>=date_debut INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Le produit % n''''''''est pas rattachÃ© Ã  un compte comptable au moment de l''''''''Ã©tablissmeent de la facture.'''',NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT compteperm_id FROM gestion_produit_compteperm_rel WHERE produit_id=NEW.produit_id AND date_fin>=p_facture_date AND p_facture_date>=date_debut INTO p_compteperm_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO compta_ecriture(libelle,debit_d,credit_d,compte_id,piece_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      VALUES (NEW.nom, 0, NEW.montant_ht, fc_get_compte(p_compteperm_id), p_piece_id);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    /* Adhesion */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestion_adhesion (facture_ligne_id,periode_id,type_id,reduction_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT NEW.id, periode.id, atype.id, atype.reduction_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_type_produit_rel AS tprel\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_adhesion_type AS atype ON (adhesion_type_id=atype.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_adhesion_periode_rel AS rel ON (atype.id=rel.type_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_adhesion_periode AS periode ON (periode.id=rel.periode_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE produit_id=NEW.produit_id AND periode.date_fin>=p_facture_date AND p_facture_date>=periode.date_debut;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_relance() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.dateheure:=OLD.dateheure;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime := ''''now''''::timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestion_ventes_relance_lettre (relance_id,etape_id,echeance_id,partenaire_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT NEW.id, etape.id, echeance.id, echeance.partenaire_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_ventes_facture_reglement_echeance AS echeance\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_ventes_relance_mode_etape AS etape USING (relance_mode_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE ''''now''''::date-echeance.date>=0 AND NOT echeance.id||''''X''''||etape.id IN (SELECT echeance_id||''''X''''||etape_id FROM gestion_ventes_relance_lettre);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_traite_lot(IN a_lot_numero INTEGER) RETURNS INTEGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_societe_id base_societe.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_id gestion_ventes_commande.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_facture_id gestion_ventes_facture.id%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  l record;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  cotis gestsea_cotisation%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  cotis_ligne gestsea_cotisation_ligne%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Verifications  (du parametrage et des produits Ã  faire!)*/\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM gestsea_cotisation_parametrage INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Le paramÃ¨trage des cotisations est incorrect (nb_enreg!=1).'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM gestsea_cotisation_lot WHERE numero=a_lot_numero AND NOT en_facture INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  FOR l IN SELECT lot.id AS lid, cot.* FROM gestsea_cotisation_lot AS lot JOIN gestsea_cotisation AS cot ON (cot.id=cotisation_id) WHERE lot.numero=a_lot_numero AND NOT en_facture LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ok:=TRUE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_partenaire WHERE id=l.partenaire_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ok:=FALSE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      UPDATE gestsea_cotisation_lot SET facturable=FALSE, erreur_message=''''Le partenaire n''''''''existe pas.'''' WHERE id=l.lid;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Facturation */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT societe_id FROM base_societe_utilisateur_rel WHERE utilisateur_login=CURRENT_USER INTO p_societe_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  FOR l IN SELECT cotisation_id AS cid FROM gestsea_cotisation_lot WHERE lot.numero=a_lot_numero AND NOT en_facture AND facturable LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestsea_cotisation_ligne AS lig JOIN gestsea_cotisation_produit AS prod ON (produit_id=prod.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE cotisation_id=l.cid AND societe_id=p_societe_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT avec_defaut_produit FROM gestsea_cotisation_parametrage INTO ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF ok OR total>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT * FROM gestsea_cotisation WHERE id=l.cid INTO cotis;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT nextval(''''gestion_ventes_commande_id_seq'''') INTO p_commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO gestion_ventes_commande(id,date,partenaire_id,objet)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT p_commande_id,CURRENT_DATE, cotis.partenaire_id, ''''[''''||to_char(cotis.id,''''FM099999'''')||''''] ''''||facture_objet||'''' (''''||EXTRACT(YEAR FROM CURRENT_DATE)||'''')''''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          FROM gestsea_cotisation_parametrage;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF total>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FOR cotis_ligne IN SELECT * FROM gestsea_cotisation_ligne WHERE cotisation_id=l.cid LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          INSERT INTO gestion_ventes_commande_ligne(commande_id,produit_id,quantite)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''            SELECT p_commande_id,produit.id,cotis_ligne.quantite\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''              FROM gestion_produit AS produit \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''              WHERE produit.code=cotis_ligne.produit_code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        INSERT INTO gestion_ventes_commande_ligne(commande_id,produit_id,quantite)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT p_commande_id,produit.id,cotis_ligne.quantite\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''            FROM gestsea_cotisation_parametrage JOIN gestion_produit AS produit ON (produit.code=defaut_produit_code);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      /* Passage en facturation */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT nextval(''''gestion_ventes_facture_id_seq'''') INTO p_facture_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO gestion_ventes_facture (id,commande_id) VALUES (p_facture_id,p_commande_id);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      /* Reglement ??? */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      /* Cotisation enregistrÃ©e */      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      UPDATE gestsea_cotisation_lot SET commande_id=p_commande_id,facture_id=p_facture_id WHERE cotisation_id=l.cid;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE gestsea_cotisation_lot SET en_facture=TRUE WHERE cotisation_id=l.cid;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    total := total+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_structure() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_length integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT MAX(LENGTH(RTRIM(code,''''#''''))) FROM gestsea_structure WHERE parent_id=NEW.parent_id AND id!=NEW.id INTO p_length;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.code:=UPPER(RTRIM(NEW.code,''''#''''));  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF LENGTH(NEW.code)>p_length THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_length := LENGTH(NEW.code);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE gestsea_structure SET code=RPAD(code,p_length,''''#'''') WHERE id!=NEW.id AND parent_id=NEW.parent_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.code:=RPAD(NEW.code,p_length,''''#'''');\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT code_etendu||NEW.code FROM gestsea_structure WHERE id=NEW.parent_structure_id INTO NEW.code_etendu;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF OLD.code_etendu!=NEW.code_etendu THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE gestsea_structure SET code_etendu=NEW.code_etendu||code WHERE parent_id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_ventes_commande_ligne_2() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestsea_publication_abonnement_commande (commande_ligne_id,abonnement_id,partenaire_id,nb_exemplaires)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT ligne.id, abonnement.id,commande.partenaire_id,ligne.quantite\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_ventes_commande_ligne AS ligne\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_ventes_commande AS commande ON (commande.id=commande_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestsea_publication_abonnement AS abonnement USING (produit_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE ligne.id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.abonnement_id!=NEW.abonnement_id THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT count(*) FROM gestsea_publication_abonnement WHERE produit_id=NEW.produit_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        DELETE FROM gestsea_publication_abonnement_commande WHERE commande_ligne_id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        UPDATE gestsea_publication_abonnement_commande SET abonnement_id=abonnement.id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          FROM gestsea_publication_abonnement AS abonnement WHERE produit_id=NEW.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.quantite!=NEW.quantite THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT sum(nb_exemplaires) FROM gestsea_publication_abonnement_commande \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE commande_ligne_id=NEW.id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF total>NEW.quantite THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        UPDATE gestion_ventes_commande_ligne SET quantite=total WHERE id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    DELETE FROM gestsea_publication_abonnement_commande WHERE commande_ligne_id=OLD.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_ventes_facture_ligne_2() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestsea_publication_abonnement_routage (commande_id, facture_ligne_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT id, NEW.id FROM gestsea_publication_abonnement_commande \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE commande_ligne_id=NEW.commande_ligne_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Depuis quand on supprime des lignes de facture ?!'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_publication_abonnement_commande() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_contact(NEW.partenaire_id,contact_type_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication WHERE id=NEW.publication_id INTO NEW.contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.contact_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Il n''''''''est pas possible d''''''''ajouter cette personne Ã  la liste des abonnÃ©s car elle ne possÃ¨de pas une seule adresse active.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT publication_id FROM gestsea_publication_abonnement \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.abonnement_id INTO NEW.publication_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_publication_abonnement_routage() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_numero gestsea_publication_abonnement_routage.numero_debut%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT com.quantite-fac.quantite, lig.facture_id, fac.facture_id=fac2.facture_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_ventes_facture_ligne AS fac, \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         gestsea_publication_abonnement_commande AS lig \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         JOIN gestion_ventes_commande_ligne AS com ON (com.id=lig.commande_ligne_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         JOIN gestion_ventes_facture_ligne AS fac2 ON (com.id=fac2.commande_ligne_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE fac.id=NEW.facture_ligne_id AND lig.id=NEW.id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO total, NEW.facture_id, ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF total!=0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''La totalitÃ© d''''''''une ligne de commande comprenant un routage de publication doit Ãªtre facturÃ©e en intÃ©gralitÃ©.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Les numÃ©ros de facture ne correspondent pas lors de l''''''''Ã©tablissement du routage.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT partenaire_id,contact_id,abonnement_id,publication_id,nb_exemplaires\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication_abonnement_commande\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.commande_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.partenaire_id, NEW.contact_id,NEW.abonnement_id,NEW.publication_id,NEW.nb_exemplaires;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT MAX(numero_fin)+1\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication_abonnement_routage\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE partenaire_id=NEW.partenaire_id INTO p_numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT CASE WHEN p_numero>numero_prochain THEN p_numero ELSE numero_prochain END \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication WHERE id=NEW.publication_id INTO p_numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT p_numero+differe, p_numero+differe+nb_numeros\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication_abonnement \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.abonnement_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.numero_debut,NEW.numero_fin;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION is_search_path(in the_user text, in only_static boolean) RETURNS boolean AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*)  FROM base.base_societe_utilisateur_rel WHERE utilisateur_login=$1 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN (NOT only_static AND total>0)::boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\\n';\n  proc:=proc||'  NEW.schema := schema_name;\\n';\n  proc:=proc||'  -- Triggers\\n';\n  proc:=proc||'  CREATE TRIGGER base_societe_etablissement_trgctl BEFORE INSERT OR UPDATE ON base_societe_etablissement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_societe_parametre_trgctl BEFORE INSERT OR UPDATE ON base_societe_parametre FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_societe_service_trgctl BEFORE INSERT OR UPDATE ON base_societe_service FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_droits_profil_trgctl BEFORE INSERT OR UPDATE ON base_droits_profil FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_droits_profil_module_trgctl BEFORE INSERT OR UPDATE ON base_droits_profil_module FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_droits_module_trgctl BEFORE INSERT OR UPDATE ON base_droits_module FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_acces_trgctl BEFORE INSERT OR UPDATE ON base_acces FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_societe_employe_trgctl BEFORE INSERT OR UPDATE ON base_societe_employe FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_type_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_trgctl BEFORE INSERT OR UPDATE ON base_partenaire FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_contact_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_contact FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_contact_version_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_contact_version FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_contact_type_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_contact_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_observation_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_observation FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_observation_importance_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_observation_importance FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_attribut_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_attribut FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_attribut_type_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_attribut_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_attribut_categorie_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_attribut_categorie FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_delai_trgctl BEFORE INSERT OR UPDATE ON base_delai FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_impression_modele_trgctl BEFORE INSERT OR UPDATE ON base_impression_modele FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_impression_trgctl BEFORE INSERT OR UPDATE ON base_impression FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_impression_type_trgctl BEFORE INSERT OR UPDATE ON base_impression_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_ecriture_trgctl BEFORE INSERT OR UPDATE ON compta_ecriture FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_piece_trgctl BEFORE INSERT OR UPDATE ON compta_piece FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_exercice_trgctl BEFORE INSERT OR UPDATE ON compta_exercice FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_journal_trgctl BEFORE INSERT OR UPDATE ON compta_journal FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_journal_type_trgctl BEFORE INSERT OR UPDATE ON compta_journal_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_pointage_trgctl BEFORE INSERT OR UPDATE ON compta_pointage FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_compteperm_partenaire_rel_trgctl BEFORE INSERT OR UPDATE ON compta_compteperm_partenaire_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_banque_compte_trgctl BEFORE INSERT OR UPDATE ON compta_banque_compte FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_banque_trgctl BEFORE INSERT OR UPDATE ON compta_banque FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_compteperm_trgctl BEFORE INSERT OR UPDATE ON compta_compteperm FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_compte_trgctl BEFORE INSERT OR UPDATE ON compta_compte FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_compte_cumul_trgctl BEFORE INSERT OR UPDATE ON compta_compte_cumul FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_sequence_trgctl BEFORE INSERT OR UPDATE ON gestion_sequence FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_compteperm_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_compteperm_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_trgctl BEFORE INSERT OR UPDATE ON gestion_produit FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_categorie_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_categorie FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_service_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_service_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_taxe_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_taxe FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_prix_taxe_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_prix_taxe_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_prix_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_prix FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_lien_trgctl BEFORE INSERT OR UPDATE ON gestion_lien FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_lien_role_trgctl BEFORE INSERT OR UPDATE ON gestion_lien_role FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_lien_type_trgctl BEFORE INSERT OR UPDATE ON gestion_lien_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_reduction_trgctl BEFORE INSERT OR UPDATE ON gestion_reduction FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_type_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_type_produit_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_type_produit_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_periode_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_periode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_type_periode_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_type_periode_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_transmission_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_transmission FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_commande_type_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_commande_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_commande_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_commande FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_commande_ligne_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_commande_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_facture_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_facture FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_facture_ligne_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_facture_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_avoir_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_avoir FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_avoir_ligne_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_avoir_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_relance_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_relance FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_relance_lettre_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_relance_lettre FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_relance_mode_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_relance_mode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_relance_mode_etape_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_relance_mode_etape FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_facture_reglement_echeance_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_facture_reglement_echeance FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_reglement_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_reglement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_reglement_mode_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_reglement_mode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_reversement_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_reversement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_reversement_mode_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_reversement_mode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_facture_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_facture FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_facture_ligne_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_facture_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_facture_reglement_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_facture_reglement_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_reglement_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_reglement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_reglement_mode_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_reglement_mode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_stock_lieu_trgctl BEFORE INSERT OR UPDATE ON gestion_stock_lieu FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_stock_trgctl BEFORE INSERT OR UPDATE ON gestion_stock FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_stock_mouvement_trgctl BEFORE INSERT OR UPDATE ON gestion_stock_mouvement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_cotisation_parametrage_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation_parametrage FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_cotisation_lot_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation_lot FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_canton_groupe_trgctl BEFORE INSERT OR UPDATE ON gestsea_canton_groupe FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_canton_groupe_rel_trgctl BEFORE INSERT OR UPDATE ON gestsea_canton_groupe_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_structure_trgctl BEFORE INSERT OR UPDATE ON gestsea_structure FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_structure_commune_rel_trgctl BEFORE INSERT OR UPDATE ON gestsea_structure_commune_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_procedure_commande_rel_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_procedure_commande_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_procedure_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_procedure FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_tache_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_tache FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_tache_type_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_tache_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_dossier_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_dossier FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_dossier_commande_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_dossier_commande FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_dossier_type_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_dossier_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_dossier_etat_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_dossier_etat FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_parution_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication_parution FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_abonnement_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication_abonnement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_abonnement_commande_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication_abonnement_commande FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_abonnement_routage_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication_abonnement_routage FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T2_tg_complete_societe_etablissement0 BEFORE INSERT ON base_societe_etablissement FOR ROW EXECUTE PROCEDURE tg_complete_societe_etablissement();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T2_tg_complete_societe_etablissement1 BEFORE UPDATE ON base_societe_etablissement FOR ROW EXECUTE PROCEDURE tg_complete_societe_etablissement();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T3_tg_build_printer0 AFTER INSERT ON base_impression FOR ROW EXECUTE PROCEDURE tg_build_printer(''||schema_name||'');'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T3_tg_build_printer1 AFTER UPDATE ON base_impression FOR ROW EXECUTE PROCEDURE tg_build_printer(''||schema_name||'');'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T3_tg_build_printer2 AFTER DELETE ON base_impression FOR ROW EXECUTE PROCEDURE tg_build_printer(''||schema_name||'');'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights0 AFTER INSERT ON base_droits_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights1 AFTER UPDATE ON base_droits_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights2 AFTER DELETE ON base_droits_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights3 AFTER INSERT ON base_droits_profil_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights4 AFTER UPDATE ON base_droits_profil_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights5 AFTER DELETE ON base_droits_profil_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights6 AFTER INSERT ON base_societe_employe FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights7 AFTER UPDATE ON base_societe_employe FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights8 AFTER DELETE ON base_societe_employe FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T5_tg_complete_societe_employe0 BEFORE INSERT ON base_societe_employe FOR ROW EXECUTE PROCEDURE tg_complete_societe_employe();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T5_tg_complete_societe_employe1 BEFORE UPDATE ON base_societe_employe FOR ROW EXECUTE PROCEDURE tg_complete_societe_employe();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T6_tg_complete_partenaire0 BEFORE INSERT ON base_partenaire FOR ROW EXECUTE PROCEDURE tg_complete_partenaire();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T6_tg_complete_partenaire1 BEFORE UPDATE ON base_partenaire FOR ROW EXECUTE PROCEDURE tg_complete_partenaire();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T7_tg_complete_partenaire_type0 BEFORE INSERT ON base_partenaire_type FOR ROW EXECUTE PROCEDURE tg_complete_partenaire_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T7_tg_complete_partenaire_type1 BEFORE UPDATE ON base_partenaire_type FOR ROW EXECUTE PROCEDURE tg_complete_partenaire_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T8_tg_complete_contact0 BEFORE INSERT ON base_partenaire_contact FOR ROW EXECUTE PROCEDURE tg_complete_contact();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T8_tg_complete_contact1 BEFORE UPDATE ON base_partenaire_contact FOR ROW EXECUTE PROCEDURE tg_complete_contact();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T9_tg_manage_contact0 AFTER INSERT ON base_partenaire_contact FOR ROW EXECUTE PROCEDURE tg_manage_contact();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T9_tg_manage_contact1 AFTER UPDATE ON base_partenaire_contact FOR ROW EXECUTE PROCEDURE tg_manage_contact();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T10_tg_complete_contact_version0 BEFORE INSERT ON base_partenaire_contact_version FOR ROW EXECUTE PROCEDURE tg_complete_contact_version();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T10_tg_complete_contact_version1 BEFORE UPDATE ON base_partenaire_contact_version FOR ROW EXECUTE PROCEDURE tg_complete_contact_version();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T10_tg_complete_contact_version2 BEFORE DELETE ON base_partenaire_contact_version FOR ROW EXECUTE PROCEDURE tg_complete_contact_version();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T11_tg_complete_contact_type0 BEFORE INSERT ON base_partenaire_contact_type FOR ROW EXECUTE PROCEDURE tg_complete_contact_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T11_tg_complete_contact_type1 BEFORE UPDATE ON base_partenaire_contact_type FOR ROW EXECUTE PROCEDURE tg_complete_contact_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T11_tg_complete_contact_type2 BEFORE DELETE ON base_partenaire_contact_type FOR ROW EXECUTE PROCEDURE tg_complete_contact_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T13_tg_complete_partenaire_attribut0 BEFORE INSERT ON base_partenaire_attribut FOR ROW EXECUTE PROCEDURE tg_complete_partenaire_attribut();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T13_tg_complete_partenaire_attribut1 BEFORE UPDATE ON base_partenaire_attribut FOR ROW EXECUTE PROCEDURE tg_complete_partenaire_attribut();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T14_tg_complete_impression_modele0 BEFORE INSERT ON base_impression_modele FOR ROW EXECUTE PROCEDURE tg_complete_impression_modele();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T14_tg_complete_impression_modele1 BEFORE UPDATE ON base_impression_modele FOR ROW EXECUTE PROCEDURE tg_complete_impression_modele();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T15_tg_manage_impression0 AFTER INSERT ON base_impression FOR ROW EXECUTE PROCEDURE tg_manage_impression();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T15_tg_manage_impression1 AFTER UPDATE ON base_impression FOR ROW EXECUTE PROCEDURE tg_manage_impression();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T16_tg_complete_impression_type0 BEFORE UPDATE ON base_impression_type FOR ROW EXECUTE PROCEDURE tg_complete_impression_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T16_tg_complete_impression_type1 BEFORE DELETE ON base_impression_type FOR ROW EXECUTE PROCEDURE tg_complete_impression_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T17_tg_complete_compta_ecriture0 BEFORE INSERT ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_complete_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T17_tg_complete_compta_ecriture1 BEFORE UPDATE ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_complete_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T18_tg_manage_compta_ecriture0 AFTER INSERT ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_manage_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T18_tg_manage_compta_ecriture1 AFTER UPDATE ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_manage_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T18_tg_manage_compta_ecriture2 AFTER DELETE ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_manage_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T19_tg_complete_compta_piece0 BEFORE INSERT ON compta_piece FOR ROW EXECUTE PROCEDURE tg_complete_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T19_tg_complete_compta_piece1 BEFORE UPDATE ON compta_piece FOR ROW EXECUTE PROCEDURE tg_complete_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T20_tg_manage_compta_piece0 AFTER INSERT ON compta_piece FOR ROW EXECUTE PROCEDURE tg_manage_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T20_tg_manage_compta_piece1 AFTER UPDATE ON compta_piece FOR ROW EXECUTE PROCEDURE tg_manage_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T20_tg_manage_compta_piece2 AFTER DELETE ON compta_piece FOR ROW EXECUTE PROCEDURE tg_manage_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard0 BEFORE INSERT ON compta_exercice FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard1 BEFORE UPDATE ON compta_exercice FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard2 BEFORE INSERT ON compta_pointage FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard3 BEFORE UPDATE ON compta_pointage FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard4 BEFORE INSERT ON compta_compte_cumul FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard5 BEFORE UPDATE ON compta_compte_cumul FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T22_tg_complete_compta_journal0 BEFORE INSERT ON compta_journal FOR ROW EXECUTE PROCEDURE tg_complete_compta_journal();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T22_tg_complete_compta_journal1 BEFORE UPDATE ON compta_journal FOR ROW EXECUTE PROCEDURE tg_complete_compta_journal();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T23_tg_complete_compta_compte0 BEFORE INSERT ON compta_compte FOR ROW EXECUTE PROCEDURE tg_complete_compta_compte();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T23_tg_complete_compta_compte1 BEFORE UPDATE ON compta_compte FOR ROW EXECUTE PROCEDURE tg_complete_compta_compte();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T24_tg_complete_compte_cumul0 BEFORE INSERT ON compta_compte_cumul FOR ROW EXECUTE PROCEDURE tg_complete_compte_cumul();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T24_tg_complete_compte_cumul1 BEFORE UPDATE ON compta_compte_cumul FOR ROW EXECUTE PROCEDURE tg_complete_compte_cumul();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T25_tg_complete_sequence0 BEFORE INSERT ON gestion_sequence FOR ROW EXECUTE PROCEDURE tg_complete_sequence();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T25_tg_complete_sequence1 BEFORE UPDATE ON gestion_sequence FOR ROW EXECUTE PROCEDURE tg_complete_sequence();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T25_tg_complete_sequence2 BEFORE DELETE ON gestion_sequence FOR ROW EXECUTE PROCEDURE tg_complete_sequence();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T26_tg_complete_produit_taxe0 BEFORE INSERT ON gestion_produit_taxe FOR ROW EXECUTE PROCEDURE tg_complete_produit_taxe();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T26_tg_complete_produit_taxe1 BEFORE UPDATE ON gestion_produit_taxe FOR ROW EXECUTE PROCEDURE tg_complete_produit_taxe();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T27_tg_manage_produit_prix_taxe_rel0 AFTER INSERT ON gestion_produit_prix_taxe_rel FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix_taxe_rel();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T27_tg_manage_produit_prix_taxe_rel1 AFTER UPDATE ON gestion_produit_prix_taxe_rel FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix_taxe_rel();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T27_tg_manage_produit_prix_taxe_rel2 AFTER DELETE ON gestion_produit_prix_taxe_rel FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix_taxe_rel();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T28_tg_complete_produit_prix0 BEFORE INSERT ON gestion_produit_prix FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T28_tg_complete_produit_prix1 BEFORE UPDATE ON gestion_produit_prix FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T29_tg_complete_lien0 BEFORE INSERT ON gestion_lien FOR ROW EXECUTE PROCEDURE tg_complete_lien();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T29_tg_complete_lien1 BEFORE UPDATE ON gestion_lien FOR ROW EXECUTE PROCEDURE tg_complete_lien();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T30_tg_complete_lien_role0 BEFORE INSERT ON gestion_lien_role FOR ROW EXECUTE PROCEDURE tg_complete_lien_role();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T30_tg_complete_lien_role1 BEFORE UPDATE ON gestion_lien_role FOR ROW EXECUTE PROCEDURE tg_complete_lien_role();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T31_tg_complete_adhesion0 BEFORE INSERT ON gestion_adhesion FOR ROW EXECUTE PROCEDURE tg_complete_adhesion();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T31_tg_complete_adhesion1 BEFORE UPDATE ON gestion_adhesion FOR ROW EXECUTE PROCEDURE tg_complete_adhesion();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T32_tg_complete_ventes_commande0 BEFORE INSERT ON gestion_ventes_commande FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T32_tg_complete_ventes_commande1 BEFORE UPDATE ON gestion_ventes_commande FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T33_tg_complete_ventes_commande_ligne0 BEFORE INSERT ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T33_tg_complete_ventes_commande_ligne1 BEFORE UPDATE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T33_tg_complete_ventes_commande_ligne2 BEFORE DELETE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T34_tg_manage_ventes_commande_ligne0 AFTER INSERT ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T34_tg_manage_ventes_commande_ligne1 AFTER UPDATE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T34_tg_manage_ventes_commande_ligne2 AFTER DELETE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T35_tg_complete_ventes_facture0 BEFORE INSERT ON gestion_ventes_facture FOR ROW EXECUTE PROCEDURE tg_complete_ventes_facture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T35_tg_complete_ventes_facture1 BEFORE UPDATE ON gestion_ventes_facture FOR ROW EXECUTE PROCEDURE tg_complete_ventes_facture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T35_tg_complete_ventes_facture2 BEFORE DELETE ON gestion_ventes_facture FOR ROW EXECUTE PROCEDURE tg_complete_ventes_facture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T36_tg_manage_ventes_facture0 AFTER INSERT ON gestion_ventes_facture FOR ROW EXECUTE PROCEDURE tg_manage_ventes_facture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T37_tg_complete_ventes_relance0 BEFORE INSERT ON gestion_ventes_relance FOR ROW EXECUTE PROCEDURE tg_complete_ventes_relance();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T37_tg_complete_ventes_relance1 BEFORE UPDATE ON gestion_ventes_relance FOR ROW EXECUTE PROCEDURE tg_complete_ventes_relance();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T37_tg_complete_ventes_relance2 BEFORE DELETE ON gestion_ventes_relance FOR ROW EXECUTE PROCEDURE tg_complete_ventes_relance();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T41_tg_complete_structure0 BEFORE INSERT ON gestsea_structure FOR ROW EXECUTE PROCEDURE tg_complete_structure();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T41_tg_complete_structure1 BEFORE UPDATE ON gestsea_structure FOR ROW EXECUTE PROCEDURE tg_complete_structure();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T42_tg_manage_ventes_commande_ligne_20 AFTER INSERT ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_commande_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T42_tg_manage_ventes_commande_ligne_21 AFTER UPDATE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_commande_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T42_tg_manage_ventes_commande_ligne_22 AFTER DELETE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_commande_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T43_tg_manage_ventes_facture_ligne_20 AFTER INSERT ON gestion_ventes_facture_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_facture_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T43_tg_manage_ventes_facture_ligne_21 AFTER UPDATE ON gestion_ventes_facture_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_facture_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T43_tg_manage_ventes_facture_ligne_22 AFTER DELETE ON gestion_ventes_facture_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_facture_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T44_tg_complete_publication_abonnement_commande0 BEFORE INSERT ON gestsea_publication_abonnement_commande FOR ROW EXECUTE PROCEDURE tg_complete_publication_abonnement_commande();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T44_tg_complete_publication_abonnement_commande1 BEFORE UPDATE ON gestsea_publication_abonnement_commande FOR ROW EXECUTE PROCEDURE tg_complete_publication_abonnement_commande();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T45_tg_complete_publication_abonnement_routage0 BEFORE INSERT ON gestsea_publication_abonnement_routage FOR ROW EXECUTE PROCEDURE tg_complete_publication_abonnement_routage();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T45_tg_complete_publication_abonnement_routage1 BEFORE UPDATE ON gestsea_publication_abonnement_routage FOR ROW EXECUTE PROCEDURE tg_complete_publication_abonnement_routage();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  -- Data with triggers\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_type(nom, morale, masculin, titre) VALUES (''Homme'', false, true, ''Monsieur'');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_type(nom, morale, masculin, titre) VALUES (''Femme'', false, false, ''Madame'');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_type(nom, titre) VALUES (''SA'', ''S.A.'');\\n';\n  proc:=proc||'  INSERT INTO gestion_sequence(immuable, code, nom, mensuelle, prefixe, corps) VALUES (true, ''COMMANDE'', ''SÃ©quence des commande'', true, ''YYYYMM'', ''FM0999'');\\n';\n  proc:=proc||'  INSERT INTO gestion_sequence(immuable, code, nom) VALUES (true, ''FACTURE'', ''SÃ©quence des factures'');\\n';\n  proc:=proc||'  INSERT INTO gestion_sequence(immuable, code, nom) VALUES (true, ''AVOIR'', ''SÃ©quence des avoirs'');\\n';\n  proc:=proc||'  -- Sequences initialization\\n';\n  proc:=proc||'  PERFORM setval(''base_societe_etablissement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_societe_etablissement;\\n';\n  proc:=proc||'  PERFORM setval(''base_societe_parametre_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_societe_parametre;\\n';\n  proc:=proc||'  PERFORM setval(''base_societe_service_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_societe_service;\\n';\n  proc:=proc||'  PERFORM setval(''base_droits_profil_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_droits_profil;\\n';\n  proc:=proc||'  PERFORM setval(''base_droits_profil_module_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_droits_profil_module;\\n';\n  proc:=proc||'  PERFORM setval(''base_droits_module_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_droits_module;\\n';\n  proc:=proc||'  PERFORM setval(''base_acces_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_acces;\\n';\n  proc:=proc||'  PERFORM setval(''base_societe_employe_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_societe_employe;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_type;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_contact_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_contact;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_contact_version_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_contact_version;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_contact_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_contact_type;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_observation_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_observation;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_observation_importance_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_observation_importance;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_attribut_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_attribut;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_attribut_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_attribut_type;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_attribut_categorie_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_attribut_categorie;\\n';\n  proc:=proc||'  PERFORM setval(''base_delai_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_delai;\\n';\n  proc:=proc||'  PERFORM setval(''base_impression_modele_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_impression_modele;\\n';\n  proc:=proc||'  PERFORM setval(''base_impression_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_impression;\\n';\n  proc:=proc||'  PERFORM setval(''base_impression_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_impression_type;\\n';\n  proc:=proc||'  PERFORM setval(''compta_ecriture_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_ecriture;\\n';\n  proc:=proc||'  PERFORM setval(''compta_piece_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_piece;\\n';\n  proc:=proc||'  PERFORM setval(''compta_exercice_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_exercice;\\n';\n  proc:=proc||'  PERFORM setval(''compta_journal_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_journal;\\n';\n  proc:=proc||'  PERFORM setval(''compta_journal_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_journal_type;\\n';\n  proc:=proc||'  PERFORM setval(''compta_pointage_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_pointage;\\n';\n  proc:=proc||'  PERFORM setval(''compta_compteperm_partenaire_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_compteperm_partenaire_rel;\\n';\n  proc:=proc||'  PERFORM setval(''compta_banque_compte_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_banque_compte;\\n';\n  proc:=proc||'  PERFORM setval(''compta_banque_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_banque;\\n';\n  proc:=proc||'  PERFORM setval(''compta_compteperm_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_compteperm;\\n';\n  proc:=proc||'  PERFORM setval(''compta_compte_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_compte;\\n';\n  proc:=proc||'  PERFORM setval(''compta_compte_cumul_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_compte_cumul;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_sequence_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_sequence;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_compteperm_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_compteperm_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_categorie_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_categorie;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_service_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_service_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_taxe_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_taxe;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_prix_taxe_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_prix_taxe_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_prix_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_prix;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_lien_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_lien;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_lien_role_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_lien_role;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_lien_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_lien_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_reduction_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_reduction;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_type_produit_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_type_produit_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_periode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_periode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_type_periode_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_type_periode_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_transmission_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_transmission;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_commande_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_commande_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_commande_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_commande;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_commande_ligne_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_commande_ligne;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_facture_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_facture;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_facture_ligne_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_facture_ligne;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_avoir_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_avoir;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_avoir_ligne_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_avoir_ligne;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_relance_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_relance;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_relance_lettre_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_relance_lettre;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_relance_mode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_relance_mode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_relance_mode_etape_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_relance_mode_etape;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_facture_reglement_echeance_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_facture_reglement_echeance;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_reglement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_reglement;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_reglement_mode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_reglement_mode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_reversement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_reversement;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_reversement_mode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_reversement_mode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_facture_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_facture;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_facture_ligne_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_facture_ligne;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_facture_reglement_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_facture_reglement_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_reglement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_reglement;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_reglement_mode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_reglement_mode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_stock_lieu_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_stock_lieu;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_stock_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_stock;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_stock_mouvement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_stock_mouvement;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_cotisation_parametrage_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation_parametrage;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_cotisation_lot_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation_lot;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_canton_groupe_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_canton_groupe;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_canton_groupe_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_canton_groupe_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_structure_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_structure;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_structure_commune_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_structure_commune_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_procedure_commande_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_procedure_commande_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_procedure_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_procedure;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_tache_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_tache;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_tache_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_tache_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_dossier_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_dossier;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_dossier_commande_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_dossier_commande;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_dossier_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_dossier_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_dossier_etat_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_dossier_etat;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_parution_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication_parution;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_abonnement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication_abonnement;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_abonnement_commande_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication_abonnement_commande;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_abonnement_routage_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication_abonnement_routage;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  CREATE TRIGGER tgs_base_base_societe_trigger BEFORE INSERT ON base_societe FOR EACH ROW EXECUTE PROCEDURE tgs_base_base_societe_();\n  RETURN 0;\nEND; $$ LANGUAGE 'plpgsql' VOLATILE;\n");
  fprintf(stderr, "\nCREATE OR REPLACE FUNCTION pm__InitDatabase(text,boolean) RETURNS INTEGER AS\n$$\nDECLARE\n  TheDatabase ALIAS FOR $1;\n  ForceInit ALIAS FOR $2;\n  query text;\n  schema_name varchar;\n  proc text;\n  start_value integer;\nBEGIN\n\n\n  --\n  -- Schema: systeme\n  --\n\n  CREATE SCHEMA systeme;\n  schema_name := 'systeme'::varchar;\n  SET search_path to systeme;\n  CREATE TABLE systeme_schema (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(32) UNIQUE NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_utilisateur (\n    id SERIAL NOT NULL PRIMARY KEY,\n    login CHARACTER VARYING(32) UNIQUE NOT NULL,\n    password CHARACTER VARYING(32) NOT NULL DEFAULT '**********',\n    email CHARACTER VARYING(128),\n    can_login BOOLEAN NOT NULL DEFAULT false,\n    deja_present BOOLEAN NOT NULL DEFAULT false,\n    superuser BOOLEAN NOT NULL DEFAULT false,\n    createrole BOOLEAN NOT NULL DEFAULT false,\n    maxconn INTEGER NOT NULL DEFAULT -1,\n    jusqua DATE,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL,\n    requete CHARACTER VARYING NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction_parametre (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(64) NOT NULL,\n    extraction_id INTEGER NOT NULL,\n    type_id INTEGER NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction_parametre_type (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL,\n    type_base INTEGER NOT NULL,\n    lien BOOLEAN NOT NULL DEFAULT false,\n    table_etrangere CHARACTER VARYING(64),\n    cle_etrangere CHARACTER VARYING(64),\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction_execution (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(64) NOT NULL,\n    extraction_id INTEGER NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE systeme_extraction_execution_parametre (\n    id SERIAL NOT NULL PRIMARY KEY,\n    valeur CHARACTER VARYING NOT NULL,\n    parametre_id INTEGER NOT NULL,\n    execution_id INTEGER NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  -- Indexes\n  -- Constraints\n  RAISE NOTICE 'Contraintes';\n  ALTER TABLE systeme_schema ADD CONSTRAINT systeme_schema_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_schema ADD CONSTRAINT systeme_schema_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_utilisateur ADD CONSTRAINT systeme_utilisateur_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_utilisateur ADD CONSTRAINT systeme_utilisateur_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction ADD CONSTRAINT systeme_extraction_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction ADD CONSTRAINT systeme_extraction_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_parametre ADD CONSTRAINT systeme_extraction_parametre_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_parametre ADD CONSTRAINT systeme_extraction_parametre_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_parametre ADD CONSTRAINT systeme_extraction_parametre_constraint0 FOREIGN KEY (extraction_id) REFERENCES systeme_extraction(id);\n  ALTER TABLE systeme_extraction_parametre ADD CONSTRAINT systeme_extraction_parametre_constraint1 FOREIGN KEY (type_id) REFERENCES systeme_extraction_parametre_type(id);\n  ALTER TABLE systeme_extraction_parametre_type ADD CONSTRAINT systeme_extraction_parametre_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_parametre_type ADD CONSTRAINT systeme_extraction_parametre_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution ADD CONSTRAINT systeme_extraction_execution_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution ADD CONSTRAINT systeme_extraction_execution_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution ADD CONSTRAINT systeme_extraction_execution_constraint0 FOREIGN KEY (extraction_id) REFERENCES systeme_extraction(id);\n  ALTER TABLE systeme_extraction_execution_parametre ADD CONSTRAINT systeme_extraction_execution_parametre_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution_parametre ADD CONSTRAINT systeme_extraction_execution_parametre_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE systeme_extraction_execution_parametre ADD CONSTRAINT systeme_extraction_execution_parametre_constraint0 FOREIGN KEY (execution_id) REFERENCES systeme_extraction_execution(id);\n  ALTER TABLE systeme_extraction_execution_parametre ADD CONSTRAINT systeme_extraction_execution_parametre_constraint1 FOREIGN KEY (parametre_id) REFERENCES systeme_extraction_parametre(id);\n  -- Data without triggers\n  INSERT INTO systeme_utilisateur(login, deja_present) VALUES ('brice', true);\n  INSERT INTO systeme_extraction_parametre_type(code, nom, type_base) VALUES ('INTE', 'Entier', 1);\n  INSERT INTO systeme_extraction_parametre_type(code, nom, type_base) VALUES ('REAL', 'RÃ©el', 2);\n  INSERT INTO systeme_extraction_parametre_type(code, nom, type_base) VALUES ('BOOL', 'BoolÃ©en', 3);\n  INSERT INTO systeme_extraction_parametre_type(code, nom, type_base) VALUES ('TEXT', 'Texte', 4);\n  -- Procedures\n  proc:='CREATE OR REPLACE FUNCTION tg_manage_role() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  mdp text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  mdp:=''**********'';\\n';\n  proc:=proc||'  IF TG_OP=''INSERT''  THEN\\n';\n  proc:=proc||'    NEW.login:=LOWER(REPLACE(NEW.login,'' '',''''));\\n';\n  proc:=proc||'    IF NOT NEW.deja_present THEN\\n';\n  proc:=proc||'      query:=''CREATE ROLE ''||NEW.login||'' NOCREATEDB '';\\n';\n  proc:=proc||'      IF NOT NEW.createrole THEN\\n';\n  proc:=proc||'        query:=query||''NO'';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      query:=query||''CREATEROLE '';\\n';\n  proc:=proc||'      IF NOT NEW.superuper THEN\\n';\n  proc:=proc||'        query:=query||''NO'';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      query:=query||''SUPERUSER'';\\n';\n  proc:=proc||'      query:=query||'' LOGIN'';\\n';\n  proc:=proc||'      query:=query||'' ENCRYPTED PASSWORD ''''''||NEW.password||'''''';'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    NEW.password:=mdp;\\n';\n  proc:=proc||'    RETURN NEW;\\n';\n  proc:=proc||'  ELSIF TG_OP=''UPDATE'' THEN\\n';\n  proc:=proc||'    NEW.login:=LOWER(REPLACE(NEW.login,'' '',''''));\\n';\n  proc:=proc||'    IF NEW.login!=OLD.login THEN\\n';\n  proc:=proc||'      query:=''ALTER ROLE ''||OLD.login||'' RENAME TO ''||NEW.login||'';'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    IF NEW.password!=OLD.password THEN\\n';\n  proc:=proc||'      query:=''ALTER ROLE ''||NEW.login||'' ENCRYPTED PASSWORD ''''''||NEW.password||'''''';'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'      New.EM_Password:=mdp;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    IF NEW.superuser!=OLD.superuser THEN\\n';\n  proc:=proc||'      query:=''ALTER ROLE ''||NEW.login;\\n';\n  proc:=proc||'      IF NOT NEW.superuser THEN\\n';\n  proc:=proc||'        query:=query||''NO'';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      query:=query||''SUPERUSER'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    IF NEW.createrole!=OLD.createrole THEN\\n';\n  proc:=proc||'      query:=''ALTER ROLE ''||NEW.login;\\n';\n  proc:=proc||'      IF NOT NEW.createrole THEN\\n';\n  proc:=proc||'        query:=query||''NO'';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      query:=query||''CREATEROLE'';\\n';\n  proc:=proc||'      EXECUTE query;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    RETURN NEW;\\n';\n  proc:=proc||'  ELSIF TG_OP=''DELETE'' THEN\\n';\n  proc:=proc||'    query:=''DROP ROLE ''||OLD.login;\\n';\n  proc:=proc||'    EXECUTE query;\\n';\n  proc:=proc||'    RETURN OLD;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION soundex2(IN a_mot CHARACTER VARYING) RETURNS CHARACTER VARYING(4) AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot text;\\n';\n  proc:=proc||'  car varchar(1);\\n';\n  proc:=proc||'  n integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT LOWER(TRIM(a_mot)) INTO mot;\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¢'',''a'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¤'',''a'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã '',''a'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ãª'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã«'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Å'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã©'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¨'',''e'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã®'',''i'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¯'',''i'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¬'',''i'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã´'',''o'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¶'',''o'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã²'',''o'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã»'',''u'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¼'',''u'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¹'',''u'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Å·'',''y'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã¿'',''y'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''á»³'',''y'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Ã§'',''c'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''.'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'','','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'':'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'';'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''?'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''!'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''('','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'')'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''-'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''+'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'' '','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''_'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''#'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''*'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,'','','''');\\n';\n  proc:=proc||'  mot := UPPER(mot);\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GUI'',''KI'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GUE'',''KE'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GA'',''KA'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GO'',''KO'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''GU'',''K'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CA'',''KA'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CO'',''KO'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CU'',''KU'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Q'', ''K'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CC'',''K'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CK'',''K'');\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  IF SUBSTR(mot,1,1)!=''A'' THEN\\n';\n  proc:=proc||'    mot := REPLACE(mot,''E'',''A'');\\n';\n  proc:=proc||'    mot := REPLACE(mot,''I'',''A'');\\n';\n  proc:=proc||'    mot := REPLACE(mot,''O'',''A'');\\n';\n  proc:=proc||'    mot := REPLACE(mot,''U'',''A'');\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  \\n';\n  proc:=proc||'  mot := REPLACE(mot,''MAC'',''MCC'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''ASA'',''AZA'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''KN'', ''NN'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''PF'', ''FF'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''SCH'',''SSS'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''PH'', ''FF'');\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot := REPLACE(mot,''CH'',''#'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''SH'',''*'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''H'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''#'',''CH'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''*'',''SH'');\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot := REPLACE(mot,''AY'',''#'');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''Y'','''');\\n';\n  proc:=proc||'  mot := REPLACE(mot,''#'',''AY'');\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  car := SUBSTR(mot,LENGTH(mot),1);\\n';\n  proc:=proc||'  IF car=''A'' OR car=''T'' OR car=''D'' OR car=''S'' THEN\\n';\n  proc:=proc||'    mot := SUBSTR(mot,1,LENGTH(mot)-1);\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  car := SUBSTR(mot,1,1);\\n';\n  proc:=proc||'  mot := car||REPLACE(SUBSTR(mot,2,LENGTH(mot)),''A'','''');\\n';\n  proc:=proc||' \\n';\n  proc:=proc||'  FOR n IN 2..LENGTH(mot) LOOP\\n';\n  proc:=proc||'    car := SUBSTR(mot, n, 1);\\n';\n  proc:=proc||'    IF car=SUBSTR(mot, n-1, 1) THEN\\n';\n  proc:=proc||'      mot := SUBSTR(mot, 1, n-1)||SUBSTR(mot, n+1, LENGTH(mot));\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END LOOP;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  mot := SUBSTR(mot||''    '',1,4);\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  RETURN mot;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION phonex(IN a_mot CHARACTER VARYING) RETURNS DOUBLE PRECISION AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN 0;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION print(IN print_code CHARACTER VARYING(128),IN print_id INTEGER) RETURNS CHARACTER VARYING AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  ret text;\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  total integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  ret:='''';\\n';\n  proc:=proc||'  SELECT count(*) FROM base_impression WHERE code=print_code INTO total;\\n';\n  proc:=proc||'  IF total=1 THEN\\n';\n  proc:=proc||'    query:=''SELECT prPDF_''||print_code||''(''||print_id||'')'';\\n';\n  proc:=proc||'    EXECUTE query INTO ret;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN ret;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION fc_build_printer(IN pfb_schema CHARACTER VARYING,IN pfb_modele CHARACTER VARYING,IN pfb_nom CHARACTER VARYING,IN pfb_tmpdir CHARACTER VARYING) RETURNS INTEGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  fonction     text;\\n';\n  proc:=proc||'  query        text;\\n';\n  proc:=proc||'  q_select     text;\\n';\n  proc:=proc||'  q_suite      text;\\n';\n  proc:=proc||'  q_as         text;\\n';\n  proc:=proc||'  entete       text;\\n';\n  proc:=proc||'  cond         text;\\n';\n  proc:=proc||'  compteur     integer;\\n';\n  proc:=proc||'  ligne        text;\\n';\n  proc:=proc||'  number       integer;\\n';\n  proc:=proc||'  plast        integer; -- prodondeur de bloc\\n';\n  proc:=proc||'  last         integer[64]; -- 0 BEGIN  1 IF  2 ELSE\\n';\n  proc:=proc||'  pparam       integer; -- profondeur parametrique\\n';\n  proc:=proc||'  nbparam      integer[64]; -- nombre de param\\n';\n  proc:=proc||'  numvar       integer[64]; -- numero des records\\n';\n  proc:=proc||'  param        text;\\n';\n  proc:=proc||'  nparam       integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  compteur:=0;\\n';\n  proc:=proc||'  plast   :=0;\\n';\n  proc:=proc||'  pparam  :=0;\\n';\n  proc:=proc||'  entete:=''CREATE OR REPLACE FUNCTION ''||pfb_schema||''.''||pfb_nom||''(IN pkey INTEGER) RETURNS text AS \\\\\\\\n \\\\\\\\$\\\\\\\\$\\\\\\\\n DECLARE\\\\\\\\n'';\\n';\n  proc:=proc||'  entete:=entete||''  doc    text;\\\\\\\\n'';\\n';\n  proc:=proc||'  entete:=entete||''  source text;\\\\\\\\n'';\\n';\n  proc:=proc||'  entete:=entete||''  cible  text;\\\\\\\\n'';\\n';\n  proc:=proc||'  entete:=entete||''  res    integer;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:='''';\\n';\n  proc:=proc||'  fonction:=fonction||''BEGIN\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  doc:=\\\\''\\\\'';\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  SELECT to_char(CURRENT_TIMESTAMP,\\\\''YYYYMMDD_HH24MISSMS\\\\'') INTO source;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  cible :=current_user||\\\\''_''||pfb_nom||''_\\\\''||source||\\\\''.pdf\\\\'';\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  source:=current_user||\\\\''_''||pfb_nom||''_\\\\''||source||\\\\''.tex\\\\'';\\\\\\\\n'';\\n';\n  proc:=proc||'--  fonction:=fonction||''  RAISE NOTICE \\\\''>> %%\\\\'',source;\\\\\\\\n'';\\n';\n  proc:=proc||'  ligne   :=''\\\\%% Genere par Brice Texier'';\\n';\n  proc:=proc||'  number  :=1;\\n';\n  proc:=proc||'  WHILE NOT ligne ILIKE ''%%\\\\\\\\end{document}%%'' LOOP\\n';\n  proc:=proc||'-- traitement de la ligne\\n';\n  proc:=proc||'--    ligne:=replace(ligne,'':NUMBER:'',number);\\n';\n  proc:=proc||'    fonction:=fonction||repeat(''  '',plast);\\n';\n  proc:=proc||'    IF ligne LIKE ''\\\\%%%%BEGIN:%%SELECT%%'' THEN\\n';\n  proc:=proc||'      query   :=SUBSTRING(ligne FROM POSITION(''BEGIN:'' IN ligne)+6);\\n';\n  proc:=proc||'            query   :=SUBSTRING(query FOR LENGTH(query)-1);\\n';\n  proc:=proc||'      query   :=REPLACE(query,'':KEY:'',''pkey'');\\n';\n  proc:=proc||'      q_select:=SUBSTRING(query FROM POSITION(''SELECT'' IN query)+6);\\n';\n  proc:=proc||'      q_suite :='''';\\n';\n  proc:=proc||'      IF POSITION(''FROM'' IN q_select)>0 THEN\\n';\n  proc:=proc||'        q_select:=SUBSTRING(q_select FOR POSITION(''FROM'' IN q_select)-1);\\n';\n  proc:=proc||'        q_suite :=SUBSTRING(query FROM POSITION(''FROM'' IN query));\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'--      RAISE NOTICE ''q_select (%%)'',q_select;\\n';\n  proc:=proc||'      nparam:=0;\\n';\n  proc:=proc||'      q_as  :='''';\\n';\n  proc:=proc||'      LOOP\\n';\n  proc:=proc||'        nparam := nparam+1;\\n';\n  proc:=proc||'        param  := SPLIT_PART(q_select,'','',nparam);\\n';\n  proc:=proc||'        IF REPLACE(param,'' '','''')='''' THEN\\n';\n  proc:=proc||'          EXIT;\\n';\n  proc:=proc||'        END IF;\\n';\n  proc:=proc||'        IF q_as!='''' THEN\\n';\n  proc:=proc||'          q_as:=q_as||'', '';\\n';\n  proc:=proc||'        END IF;\\n';\n  proc:=proc||'        IF POSITION(''DISTINCT'' IN param)>0 THEN\\n';\n  proc:=proc||'          param:=SUBSTRING(param FROM POSITION(''DISTINCT'' IN param)+8);\\n';\n  proc:=proc||'          q_as:=q_as||''DISTINCT '';\\n';\n  proc:=proc||'        END IF;\\n';\n  proc:=proc||'        q_as:=q_as||''REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(COALESCE((''||param||'')::text,\\\\''\\\\''),\\\\''\\\\$\\\\'',\\\\''\\\\\\\\\\\\\\\\\\\\$\\\\''),\\\\''%%\\\\'',\\\\''\\\\\\\\\\\\\\\\%%\\\\''),\\\\''[\\\\'',\\\\''\\\\\\\\$[\\\\\\\\$\\\\''),\\\\'']\\\\'',\\\\''\\\\\\\\$]\\\\\\\\$\\\\''),\\\\''&\\\\'',\\\\''\\\\\\\\\\\\\\\\&\\\\'') AS p''||nparam;\\n';\n  proc:=proc||'      END LOOP;\\n';\n  proc:=proc||'      query:=''SELECT ''||q_as||'' ''||q_suite;\\n';\n  proc:=proc||'  --    RAISE NOTICE ''query %%'',query;\\n';\n  proc:=proc||'      IF pparam>0 THEN\\n';\n  proc:=proc||'        FOR i IN 1..nbparam[pparam] LOOP\\n';\n  proc:=proc||'          query:=REPLACE(query,''<''||i-1||''>'',''record''||numvar[pparam]||''.p''||i);\\n';\n  proc:=proc||'        END LOOP;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'      compteur       := compteur+1;\\n';\n  proc:=proc||'      plast          := plast+1;\\n';\n  proc:=proc||'      last[plast]    := 0;\\n';\n  proc:=proc||'      pparam         := pparam+1;\\n';\n  proc:=proc||'      nbparam[pparam]:= nparam-1;\\n';\n  proc:=proc||'      numvar[pparam] := compteur;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'      fonction:=fonction||''  FOR record''||compteur||'' IN ''||query||'' LOOP\\\\\\\\n'';\\n';\n  proc:=proc||'      entete:=entete||''  record''||compteur||'' record;\\\\\\\\n'';\\n';\n  proc:=proc||'    ELSIF ligne LIKE ''\\\\%%%%IF:%%'' THEN\\n';\n  proc:=proc||'      cond:=SUBSTRING(ligne FROM POSITION(''IF:'' IN ligne)+3);\\n';\n  proc:=proc||'      cond:=REPLACE(cond,'':KEY:'',''pkey'');\\n';\n  proc:=proc||'      IF pparam>0 THEN\\n';\n  proc:=proc||'        FOR i IN 1..nbparam[pparam] LOOP\\n';\n  proc:=proc||'          cond:=REPLACE(cond,''<''||i-1||''>'',''record''||numvar[pparam]||''.p''||i);\\n';\n  proc:=proc||'        END LOOP;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      fonction:=fonction||''  IF (''||cond||'')::boolean THEN\\\\\\\\n'';\\n';\n  proc:=proc||'      plast          := plast+1;\\n';\n  proc:=proc||'      last[plast]    := 1;\\n';\n  proc:=proc||'    ELSIF ligne LIKE ''\\\\%%%%ELSE'' THEN\\n';\n  proc:=proc||'      fonction:=fonction||''ELSE\\\\\\\\n'';\\n';\n  proc:=proc||'    ELSIF ligne LIKE ''\\\\%%%%END%%'' THEN\\n';\n  proc:=proc||'--      RAISE NOTICE ''END %% %%'',plast,compteur;\\n';\n  proc:=proc||'      IF plast<=0 THEN\\n';\n  proc:=proc||'        RAISE EXCEPTION ''Le modÃ¨le est mal formatÃ©. Un END est inattendu. Ligne %%'', number;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      IF last[plast]=0	 THEN\\n';\n  proc:=proc||'        fonction:=fonction||''END LOOP;\\\\\\\\n'';\\n';\n  proc:=proc||'        plast :=plast-1;\\n';\n  proc:=proc||'        pparam:=pparam-1;\\n';\n  proc:=proc||'      ELSIF last[plast]=1 THEN\\n';\n  proc:=proc||'        fonction:=fonction||''END IF;\\\\\\\\n'';\\n';\n  proc:=proc||'        plast :=plast-1;\\n';\n  proc:=proc||'      ELSE\\n';\n  proc:=proc||'        RAISE EXCEPTION ''Le modÃ¨le est mal formatÃ©. Type de boucle inconnu. Ligne %%'', number;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'    ELSE      \\n';\n  proc:=proc||'      ligne:=''  doc:=doc||''||quote_literal(ligne)||''||\\\\''\\\\\\\\\\\\n\\\\''''||'';\\\\\\\\n'';\\n';\n  proc:=proc||'      IF pparam>0 THEN\\n';\n  proc:=proc||'        FOR i IN 1..nbparam[pparam] LOOP\\n';\n  proc:=proc||'          ligne:=REPLACE(ligne,''<''||i-1||''>'',''\\\\''||record''||numvar[pparam]||''.p''||i||''||\\\\'''');\\n';\n  proc:=proc||'        END LOOP;\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      fonction:=fonction||ligne;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'    END IF;    \\n';\n  proc:=proc||'    ligne:=split_part(pfb_modele,''\\\\\\\\n'',number);\\n';\n  proc:=proc||'    number:=number+1;\\n';\n  proc:=proc||'  END LOOP;\\n';\n  proc:=proc||'  fonction:=fonction||''  doc:=doc||\\\\''\\\\\\\\\\\\\\\\end{document}\\\\'';\\\\\\\\n'';\\n';\n  proc:=proc||'--  fonction:=fonction||''  RAISE NOTICE \\\\''[%%]\\\\'', doc;\\\\\\\\n'';\\n';\n  proc:=proc||' \\n';\n  proc:=proc||'  fonction:=fonction||''  SELECT writefile(\\\\''''||pfb_tmpdir||''/\\\\''||source,doc) INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  SELECT execution(\\\\''chmod 777 ''||pfb_tmpdir||''/\\\\''||source) INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  SELECT execution(\\\\''cd ''||pfb_tmpdir||'' ; pdflatex \\\\''||source||\\\\'' ; pdflatex \\\\''||source||\\\\'' ; chmod 755 \\\\''||cible||\\\\'' ;\\\\'') INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'--    fonction:=fonction||''  SELECT execution(\\\\''cd ''||pfb_tmpdir||'' ; pdflatex \\\\''||source||\\\\'' ; pdflatex \\\\''||source||\\\\'' ; chmod 755 \\\\''||cible||\\\\'' ; rm -f \\\\''||source) INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'--    fonction=fonction||''  SELECT execution(\\\\''rm -f ''||pfb_tmpdir||''/\\\\''||source) INTO res;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''  RETURN \\\\''file://''||pfb_tmpdir||''/\\\\''||cible;\\\\\\\\n'';\\n';\n  proc:=proc||'  fonction:=fonction||''END;\\\\\\\\n\\\\\\\\$\\\\\\\\$ LANGUAGE \\\\''plpgsql\\\\'' VOLATILE;'';\\n';\n  proc:=proc||'  fonction:=entete||fonction;\\n';\n  proc:=proc||'-- Execution de la requete\\n';\n  proc:=proc||'--  RAISE NOTICE ''=> %%'', pfb_modele;\\n';\n  proc:=proc||'--  RAISE NOTICE ''=>  %%'', fonction;\\n';\n  proc:=proc||'  EXECUTE fonction;\\n';\n  proc:=proc||'  \\n';\n  proc:=proc||'  RETURN 0; \\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION update_controls() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  IF TG_OP=''INSERT'' THEN\\n';\n  proc:=proc||'    SELECT id, CURRENT_TIMESTAMP FROM systeme.systeme_utilisateur WHERE login=CURRENT_USER INTO NEW.insert_uid, NEW.insert_date;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF TG_OP=''UPDATE'' THEN\\n';\n  proc:=proc||'    NEW.insert_uid  := OLD.insert_uid;\\n';\n  proc:=proc||'    NEW.insert_date := OLD.insert_date;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  SELECT id, CURRENT_TIMESTAMP FROM systeme.systeme_utilisateur WHERE login=CURRENT_USER INTO NEW.update_uid, NEW.update_date;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION set_search_path(IN only_static boolean) RETURNS text AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'  s record;\\n';\n  proc:=proc||'  is_search_path boolean;\\n';\n  proc:=proc||'  rpath text;\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  rpath:='''';\\n';\n  proc:=proc||'  FOR s IN SELECT nom FROM systeme.systeme_schema ORDER BY id LOOP\\n';\n  proc:=proc||'    query:=''SELECT ''||s.nom||''.is_search_path(current_user::text, ''||CASE WHEN only_static THEN ''true'' ELSE ''false'' END||'');'';\\n';\n  proc:=proc||'    EXECUTE query INTO is_search_path;\\n';\n  proc:=proc||'    IF is_search_path THEN\\n';\n  proc:=proc||'      IF LENGTH(rpath)>0 THEN\\n';\n  proc:=proc||'        rpath:=rpath||'','';\\n';\n  proc:=proc||'      END IF;\\n';\n  proc:=proc||'      rpath:=rpath||s.nom;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END LOOP;\\n';\n  proc:=proc||'  IF rpath IS NOT NULL THEN\\n';\n  proc:=proc||'    query:=''SET SEARCH_PATH TO ''||rpath;\\n';\n  proc:=proc||'    EXECUTE query;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN rpath;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION is_search_path(in the_user text, in only_static boolean) RETURNS boolean AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN true;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\n  -- Triggers\n  CREATE TRIGGER systeme_schema_trgctl BEFORE INSERT OR UPDATE ON systeme_schema FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_utilisateur_trgctl BEFORE INSERT OR UPDATE ON systeme_utilisateur FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_parametre_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction_parametre FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_parametre_type_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction_parametre_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_execution_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction_execution FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER systeme_extraction_execution_parametre_trgctl BEFORE INSERT OR UPDATE ON systeme_extraction_execution_parametre FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  proc:='CREATE TRIGGER T0_tg_manage_role0 BEFORE INSERT ON systeme_utilisateur FOR ROW EXECUTE PROCEDURE tg_manage_role();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T0_tg_manage_role1 BEFORE UPDATE ON systeme_utilisateur FOR ROW EXECUTE PROCEDURE tg_manage_role();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T0_tg_manage_role2 BEFORE DELETE ON systeme_utilisateur FOR ROW EXECUTE PROCEDURE tg_manage_role();';\n  EXECUTE proc;\n  -- Data with triggers\n  -- Sequences initialization\n  PERFORM setval('systeme_schema_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_schema;\n  PERFORM setval('systeme_utilisateur_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_utilisateur;\n  PERFORM setval('systeme_extraction_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction;\n  PERFORM setval('systeme_extraction_parametre_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction_parametre;\n  PERFORM setval('systeme_extraction_parametre_type_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction_parametre_type;\n  PERFORM setval('systeme_extraction_execution_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction_execution;\n  PERFORM setval('systeme_extraction_execution_parametre_id_seq',COALESCE(MAX(id),0)+1,false) FROM systeme_extraction_execution_parametre;\n\n\n  --\n  -- Schema: base\n  --\n\n  CREATE SCHEMA base;\n  schema_name := 'base'::varchar;\n  SELECT systeme.set_search_path(true) INTO query;\n  SELECT 'SET search_path TO '||schema_name||','||query INTO query;\n  EXECUTE query;\n  CREATE TABLE base_langue (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_devise (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(32) UNIQUE NOT NULL,\n    symbole CHARACTER VARYING(4) UNIQUE NOT NULL,\n    abrev CHARACTER VARYING(4) UNIQUE NOT NULL,\n    taux NUMERIC(16,8) NOT NULL,\n    defaut BOOLEAN NOT NULL DEFAULT false,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_societe (\n    id SERIAL NOT NULL PRIMARY KEY,\n    code CHARACTER VARYING(16) UNIQUE NOT NULL,\n    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\n    siren CHARACTER VARYING(9) UNIQUE NOT NULL,\n    rcs_ville CHARACTER VARYING(32),\n    rcs_type CHARACTER VARYING(1) DEFAULT 'A',\n    rm_numero CHARACTER VARYING(32),\n    nui CHARACTER VARYING(32) NOT NULL,\n    naf CHARACTER VARYING(32),\n    code_pays CHARACTER VARYING(2),\n    tic_prefixe CHARACTER VARYING(2),\n    tic CHARACTER VARYING(32),\n    adresse CHARACTER VARYING(128),\n    schema CHARACTER VARYING(32),\n    note CHARACTER VARYING,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_societe_utilisateur_rel (\n    id SERIAL NOT NULL PRIMARY KEY,\n    societe_id INTEGER NOT NULL,\n    utilisateur_login CHARACTER VARYING(32) UNIQUE NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_codepostal_commune_rel (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\n    codepostal_id INTEGER NOT NULL,\n    commune_id INTEGER NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_codepostal (\n    id SERIAL NOT NULL PRIMARY KEY,\n    numero CHARACTER VARYING(16) UNIQUE,\n    cedex BOOLEAN NOT NULL DEFAULT false,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_commune (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(128) NOT NULL,\n    cedex BOOLEAN NOT NULL DEFAULT false,\n    canton_id INTEGER,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE base_canton (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(128) NOT NULL,\n    arrondissement_id INTEGER,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE gestsea_cotisation (\n    id SERIAL NOT NULL PRIMARY KEY,\n    partenaire_id INTEGER NOT NULL,\n    date DATE NOT NULL,\n    reglement_autre BOOLEAN NOT NULL DEFAULT false,\n    reglement_id INTEGER,\n    reglement_libelle CHARACTER VARYING,\n    reglement_mode_id INTEGER NOT NULL,\n    reglement_date DATE,\n    reglement_banque CHARACTER VARYING(64),\n    reglement_numcompte CHARACTER VARYING(64),\n    reglement_reference CHARACTER VARYING(64),\n    montant_ttc NUMERIC(16,2) NOT NULL,\n    montant_ht NUMERIC(16,2) NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE gestsea_cotisation_ligne (\n    id SERIAL NOT NULL PRIMARY KEY,\n    cotisation_id INTEGER NOT NULL,\n    produit_id INTEGER NOT NULL,\n    produit_code CHARACTER VARYING(16) NOT NULL,\n    quantite NUMERIC(12,2) NOT NULL DEFAULT 1,\n    montant_ttc NUMERIC(16,2) NOT NULL,\n    montant_ht NUMERIC(16,2) NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  CREATE TABLE gestsea_cotisation_produit (\n    id SERIAL NOT NULL PRIMARY KEY,\n    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\n    code CHARACTER VARYING(16) NOT NULL,\n    societe_id INTEGER NOT NULL,\n    montant_ttc NUMERIC(16,2) NOT NULL,\n    montant_ht NUMERIC(16,2) NOT NULL,\n    insert_uid INTEGER,\n    insert_date TIMESTAMP,\n    update_uid INTEGER,\n    update_date TIMESTAMP\n  );\n  -- Indexes\n  CREATE  INDEX base_societe_tic_index ON base_societe(tic);\n  CREATE  UNIQUE INDEX base_codepostal_numero_index ON base_codepostal(numero);\n  CREATE  INDEX gestsea_cotisation_partenaire_id_index ON gestsea_cotisation(partenaire_id);\n  CREATE  INDEX gestsea_cotisation_reglement_id_index ON gestsea_cotisation(reglement_id);\n  CREATE  INDEX gestsea_cotisation_reglement_mode_id_index ON gestsea_cotisation(reglement_mode_id);\n  -- Constraints\n  RAISE NOTICE 'Contraintes';\n  ALTER TABLE base_langue ADD CONSTRAINT base_langue_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_langue ADD CONSTRAINT base_langue_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_devise ADD CONSTRAINT base_devise_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_devise ADD CONSTRAINT base_devise_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_devise ADD CONSTRAINT base_devise_constraint0 CHECK (taux>0);\n  ALTER TABLE base_societe ADD CONSTRAINT base_societe_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_societe ADD CONSTRAINT base_societe_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_societe_utilisateur_rel ADD CONSTRAINT base_societe_utilisateur_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_societe_utilisateur_rel ADD CONSTRAINT base_societe_utilisateur_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_societe_utilisateur_rel ADD CONSTRAINT base_societe_utilisateur_rel_constraint0 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\n  ALTER TABLE base_societe_utilisateur_rel ADD CONSTRAINT base_societe_utilisateur_rel_constraint1 FOREIGN KEY (utilisateur_login) REFERENCES systeme_utilisateur(login);\n  ALTER TABLE base_codepostal_commune_rel ADD CONSTRAINT base_codepostal_commune_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_codepostal_commune_rel ADD CONSTRAINT base_codepostal_commune_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_codepostal_commune_rel ADD CONSTRAINT base_codepostal_commune_rel_constraint0 FOREIGN KEY (codepostal_id) REFERENCES base_codepostal(id);\n  ALTER TABLE base_codepostal_commune_rel ADD CONSTRAINT base_codepostal_commune_rel_constraint1 FOREIGN KEY (commune_id) REFERENCES base_commune(id);\n  ALTER TABLE base_codepostal ADD CONSTRAINT base_codepostal_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_codepostal ADD CONSTRAINT base_codepostal_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_commune ADD CONSTRAINT base_commune_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_commune ADD CONSTRAINT base_commune_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_commune ADD CONSTRAINT base_commune_constraint0 FOREIGN KEY (canton_id) REFERENCES base_canton(id);\n  ALTER TABLE base_canton ADD CONSTRAINT base_canton_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE base_canton ADD CONSTRAINT base_canton_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation ADD CONSTRAINT gestsea_cotisation_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation ADD CONSTRAINT gestsea_cotisation_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation ADD CONSTRAINT gestsea_cotisation_constraint0 CHECK ((NOT reglement_autre AND reglement_date IS NOT NULL AND reglement_banque IS NOT NULL AND reglement_numcompte IS NOT NULL AND reglement_reference IS NOT NULL) OR (reglement_autre AND reglement_id IS NOT NULL));\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_constraint0 CHECK (quantite>0);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_constraint1 CHECK (montant_ttc>=0 AND montant_ht>=0);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_constraint2 FOREIGN KEY (cotisation_id) REFERENCES gestsea_cotisation(id);\n  ALTER TABLE gestsea_cotisation_ligne ADD CONSTRAINT gestsea_cotisation_ligne_constraint3 FOREIGN KEY (produit_id) REFERENCES gestsea_cotisation_produit(id);\n  ALTER TABLE gestsea_cotisation_produit ADD CONSTRAINT gestsea_cotisation_produit_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation_produit ADD CONSTRAINT gestsea_cotisation_produit_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\n  ALTER TABLE gestsea_cotisation_produit ADD CONSTRAINT gestsea_cotisation_produit_constraint0 CHECK (montant_ttc>=0 AND montant_ht>=0);\n  ALTER TABLE gestsea_cotisation_produit ADD CONSTRAINT gestsea_cotisation_produit_constraint1 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\n  -- Data without triggers\n  INSERT INTO base_langue VALUES (1, 'fr-FR', 'FranÃ§ais (France)');\n  INSERT INTO base_langue VALUES (2, 'en-US', 'Anglais (U.S.A.)');\n  INSERT INTO base_langue VALUES (3, 'en-GB', 'Anglais (Royaume-Uni)');\n  INSERT INTO base_langue VALUES (4, 'es-ES', 'Espagnol (Espagne)');\n  INSERT INTO base_devise VALUES (1, 'Euro', 'â¬', 'EUR', 1, true);\n  INSERT INTO base_devise VALUES (2, 'Dollar amÃ©ricain', '$', 'USD', 0.77296461, false);\n  -- Procedures\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_societe() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  IF TG_OP=''UPDATE'' THEN\\n';\n  proc:=proc||'    IF OLD.code!=NEW.code THEN\\n';\n  proc:=proc||'      NEW.code:=OLD.code;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF NEW.siren IS NULL THEN\\n';\n  proc:=proc||'    NEW.siren:=''000000000'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  NEW.tic := to_char(NEW.siren::integer,''FM009 009 009'');\\n';\n  proc:=proc||'  IF LENGTH(COALESCE(NEW.rcs_ville,''''))>1 THEN\\n';\n  proc:=proc||'    NEW.rm_numero := NULL;\\n';\n  proc:=proc||'    NEW.rcs_ville:=UPPER(NEW.rcs_ville);\\n';\n  proc:=proc||'    NEW.rcs_type:=UPPER(NEW.rcs_type);\\n';\n  proc:=proc||'    IF LENGTH(COALESCE(NEW.rcs_type,''''))!=1 THEN\\n';\n  proc:=proc||'      NEW.rcs_type:=''A'';\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    IF NEW.rcs_type!=''A'' THEN\\n';\n  proc:=proc||'      NEW.rcs_type:=''B'';\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'    NEW.nui := ''RCS ''||NEW.rcs_ville||'' ''||NEW.rcs_type||'' ''||NEW.tic;\\n';\n  proc:=proc||'  ELSIF 1<=LENGTH(COALESCE(NEW.rm_numero,'''')) AND LENGTH(COALESCE(NEW.rm_numero,''''))<=3 THEN\\n';\n  proc:=proc||'    NEW.rcs_ville := NULL;\\n';\n  proc:=proc||'    NEW.rcs_type  := NULL;\\n';\n  proc:=proc||'    NEW.rm_numero := to_char(NEW.rm_numero::integer,''FM099'');\\n';\n  proc:=proc||'    NEW.nui := NEW.tic||'' RM ''||NEW.rm_numero;\\n';\n  proc:=proc||'  ELSE\\n';\n  proc:=proc||'    NEW.rcs_ville := NULL;\\n';\n  proc:=proc||'    NEW.rcs_type  := NULL;\\n';\n  proc:=proc||'    NEW.rm_numero := NULL;\\n';\n  proc:=proc||'    NEW.nui := NEW.tic;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF LENGTH(COALESCE(NEW.code_pays,''''))!=2 THEN\\n';\n  proc:=proc||'    NEW.code_pays := ''FR'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF LENGTH(COALESCE(NEW.tic_prefixe,''''))!=2 THEN\\n';\n  proc:=proc||'    NEW.tic_prefixe := ''--'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  NEW.tic := ''FR ''||NEW.tic_prefixe||'' ''||NEW.tic;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION fc_get_current_contact_version(IN a_contact_id INTEGER) RETURNS INTEGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  p_ret integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  IF a_contact_id IS NULL THEN\\n';\n  proc:=proc||'    RETURN NULL;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  SELECT id FROM base_partenaire_contact_version \\n';\n  proc:=proc||'    WHERE contact_id=a_contact_id AND datetime_fin=''infinity'' \\n';\n  proc:=proc||'    INTO p_ret;\\n';\n  proc:=proc||'  IF p_ret IS NULL THEN\\n';\n  proc:=proc||'    RAISE EXCEPTION ''Erreur systÃ¨me : Pas de version en cours pour le contact ''''%%''''.'',COALESCE(a_contact_id,''NULL'');\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN p_ret;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_codepostal_commune_rel() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  cp varchar(5);\\n';\n  proc:=proc||'  ville varchar(32); \\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT numero FROM base_codepostal WHERE id=NEW.codepostal_id INTO cp;\\n';\n  proc:=proc||'  SELECT nom FROM base_commune WHERE id=NEW.commune_id INTO ville;\\n';\n  proc:=proc||'  NEW.nom = cp||'' ''||ville;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION fc_get_nb_jours_dans_mois(IN a_date DATE) RETURNS INTEGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  p_mois_nb_jours CONSTANT integer[12] = ''{31,28,31,30,31,30,31,31,30,31,30,31}'';\\n';\n  proc:=proc||'  p_annee integer;\\n';\n  proc:=proc||'  p_mois  integer;\\n';\n  proc:=proc||'  p_jours integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  p_annee:=EXTRACT(YEAR FROM a_date)::integer;\\n';\n  proc:=proc||'  p_mois:=EXTRACT(MONTH FROM a_date)::integer;\\n';\n  proc:=proc||'  p_jours:=p_mois_nb_jours[p_mois];\\n';\n  proc:=proc||'  IF (p_mois=2) AND (p_annee%%4=0) AND ((p_annee%%100!=0) OR (p_annee%%400=0)) THEN\\n';\n  proc:=proc||'    p_jours := p_jours+1;\\n';\n  proc:=proc||'  END IF;    \\n';\n  proc:=proc||'  RETURN p_jours;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION fc_get_compte(IN a_compteperm_id INTEGER) RETURNS INTEGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  total integer;\\n';\n  proc:=proc||'  p_ret integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT count(*) FROM compta_compte WHERE compteperm_id=a_compteperm_id INTO total;\\n';\n  proc:=proc||'  IF 0>=total THEN\\n';\n  proc:=proc||'    INSERT INTO compta_compte(compteperm_id) VALUES (a_compteperm_id);\\n';\n  proc:=proc||'  ELSIF total>1 THEN\\n';\n  proc:=proc||'    RAISE EXCEPTION ''Impossible mais plusieurs comptes auraient pour parent le mÃªme compte permanent.'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  SELECT compteperm_id FROM compta_compte WHERE compteperm_id=a_compteperm_id INTO p_ret;\\n';\n  proc:=proc||'  RETURN p_ret;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_cotisation() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  total integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT count(*) FROM gestsea_cotisation_parametrage INTO total;\\n';\n  proc:=proc||'  IF total!=1 THEN\\n';\n  proc:=proc||'    RAISE EXCEPTION ''Le paramÃ¨trage des cotisations est incorrect (nb_enreg!=1).'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  IF NEW.reglement_autre THEN\\n';\n  proc:=proc||'    SELECT count(*) FROM gestion_ventes_reglement WHERE id=NEW.reglement_id INTO total;\\n';\n  proc:=proc||'    IF 0>=total THEN\\n';\n  proc:=proc||'      RAISE EXCEPTION ''Le reglement que vous indiquez n''''existe pas.'';\\n';\n  proc:=proc||'    ELSE\\n';\n  proc:=proc||'      SELECT partenaire.nom||'' ''||reglement.montant||'' â¬ (''||reglement.date_reglement||'')'' \\n';\n  proc:=proc||'        FROM gestion_ventes_reglement AS reg JOIN base_partenaire AS p ON (p.id=partenaire_id)\\n';\n  proc:=proc||'        WHERE reg.id=NEW.reglement_id INTO NEW.reglement_libelle;\\n';\n  proc:=proc||'    END IF;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  INSERT INTO gestsea_cotisation_lot (lot,cotisation_id,en_facture)\\n';\n  proc:=proc||'    SELECT lot_dernier_numero,NEW.cotisation_id,false FROM gestsea_cotisation_parametrage;\\n';\n  proc:=proc||'  RETURN NEW;  \\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_cotisation_ligne() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  p_cotisation_id gestsea_cotisation.id%%TYPE;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  IF TG_OP=''INSERT'' OR TG_OP=''UPDATE'' THEN\\n';\n  proc:=proc||'    SELECT NEW.quantite*montant_ttc,NEW.quantite*montant_ht,code \\n';\n  proc:=proc||'      FROM gestsea_cotisation_produit\\n';\n  proc:=proc||'      WHERE id=NEW.produit_id INTO NEW.montant_ttc, NEW.montant_ht, NEW.produit_code;\\n';\n  proc:=proc||'    p_cotisation_id = NEW.cotisation_id;\\n';\n  proc:=proc||'  ELSE\\n';\n  proc:=proc||'    p_cotisation_id = OLD.cotisation_id;\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  UPDATE gestsea_cotisation SET montant_ttc=COALESCE(sum(lig.montant_ttc),0), montant_ht=COALESCE(SUM(lig.montant_ht),0)\\n';\n  proc:=proc||'    FROM gestsea_cotisation_ligne AS lig WHERE cotisation_id=p_cotisation_id;\\n';\n  proc:=proc||'  RETURN NEW;  \\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION tg_complete_cotisation_produit() RETURNS TRIGGER AS \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  total integer;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  SELECT ''SELECT count(*) FROM ''||schema||''.gestion_produit WHERE code=''''''||NEW.code||''''''''\\n';\n  proc:=proc||'    FROM base_societe WHERE id=NEW.societe_id INTO query;\\n';\n  proc:=proc||'  EXECUTE query INTO total;\\n';\n  proc:=proc||'  IF total!=1 THEN\\n';\n  proc:=proc||'    RAISE EXCEPTION ''Le produit que vous indiquez est invalide (nb!=1).'';\\n';\n  proc:=proc||'  END IF;\\n';\n  proc:=proc||'  RETURN NEW;  \\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'      \\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  proc:='CREATE OR REPLACE FUNCTION is_search_path(in the_user text, in only_static boolean) RETURNS boolean AS \\$\\$\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  RETURN true;\\n';\n  proc:=proc||'END\\n';\n  proc:=proc||'\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\n  -- Triggers\n  CREATE TRIGGER base_langue_trgctl BEFORE INSERT OR UPDATE ON base_langue FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_devise_trgctl BEFORE INSERT OR UPDATE ON base_devise FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_societe_trgctl BEFORE INSERT OR UPDATE ON base_societe FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_societe_utilisateur_rel_trgctl BEFORE INSERT OR UPDATE ON base_societe_utilisateur_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_codepostal_commune_rel_trgctl BEFORE INSERT OR UPDATE ON base_codepostal_commune_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_codepostal_trgctl BEFORE INSERT OR UPDATE ON base_codepostal FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_commune_trgctl BEFORE INSERT OR UPDATE ON base_commune FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER base_canton_trgctl BEFORE INSERT OR UPDATE ON base_canton FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER gestsea_cotisation_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER gestsea_cotisation_ligne_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  CREATE TRIGGER gestsea_cotisation_produit_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation_produit FOR EACH ROW EXECUTE PROCEDURE update_controls();\n  proc:='CREATE TRIGGER T1_tg_complete_societe0 BEFORE INSERT ON base_societe FOR ROW EXECUTE PROCEDURE tg_complete_societe();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T1_tg_complete_societe1 BEFORE UPDATE ON base_societe FOR ROW EXECUTE PROCEDURE tg_complete_societe();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T12_tg_complete_codepostal_commune_rel0 BEFORE INSERT ON base_codepostal_commune_rel FOR ROW EXECUTE PROCEDURE tg_complete_codepostal_commune_rel();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T12_tg_complete_codepostal_commune_rel1 BEFORE UPDATE ON base_codepostal_commune_rel FOR ROW EXECUTE PROCEDURE tg_complete_codepostal_commune_rel();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T38_tg_complete_cotisation0 BEFORE INSERT ON gestsea_cotisation FOR ROW EXECUTE PROCEDURE tg_complete_cotisation();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T38_tg_complete_cotisation1 BEFORE UPDATE ON gestsea_cotisation FOR ROW EXECUTE PROCEDURE tg_complete_cotisation();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T39_tg_complete_cotisation_ligne0 BEFORE INSERT ON gestsea_cotisation_ligne FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_ligne();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T39_tg_complete_cotisation_ligne1 BEFORE UPDATE ON gestsea_cotisation_ligne FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_ligne();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T39_tg_complete_cotisation_ligne2 BEFORE DELETE ON gestsea_cotisation_ligne FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_ligne();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T40_tg_complete_cotisation_produit0 BEFORE INSERT ON gestsea_cotisation_produit FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_produit();';\n  EXECUTE proc;\n  proc:='CREATE TRIGGER T40_tg_complete_cotisation_produit1 BEFORE UPDATE ON gestsea_cotisation_produit FOR ROW EXECUTE PROCEDURE tg_complete_cotisation_produit();';\n  EXECUTE proc;\n  -- Data with triggers\n  -- Sequences initialization\n  PERFORM setval('base_langue_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_langue;\n  PERFORM setval('base_devise_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_devise;\n  PERFORM setval('base_societe_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_societe;\n  PERFORM setval('base_societe_utilisateur_rel_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_societe_utilisateur_rel;\n  PERFORM setval('base_codepostal_commune_rel_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_codepostal_commune_rel;\n  PERFORM setval('base_codepostal_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_codepostal;\n  PERFORM setval('base_commune_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_commune;\n  PERFORM setval('base_canton_id_seq',COALESCE(MAX(id),0)+1,false) FROM base_canton;\n  PERFORM setval('gestsea_cotisation_id_seq',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation;\n  PERFORM setval('gestsea_cotisation_ligne_id_seq',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation_ligne;\n  PERFORM setval('gestsea_cotisation_produit_id_seq',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation_produit;\n\n\n  --\n  -- Schema: code\n  --\n\n  SET search_path to base;\n  proc:='CREATE OR REPLACE FUNCTION tgs_base_base_societe_() RETURNS TRIGGER AS\\n';\n  proc:=proc||' \\$\\$\\n';\n  proc:=proc||'DECLARE\\n';\n  proc:=proc||'  query text;\\n';\n  proc:=proc||'  schema_name varchar;\\n';\n  proc:=proc||'  start_value integer;\\n';\n  proc:=proc||'  proc text;\\n';\n  proc:=proc||'BEGIN\\n';\n  proc:=proc||'  NEW.code:=lower(replace(NEW.code,'' '',''''));\\n';\n  proc:=proc||'  schema_name := NEW.code::varchar;\\n';\n  proc:=proc||'  SELECT ''CREATE SCHEMA ''||schema_name INTO query;\\n';\n  proc:=proc||'  EXECUTE query;\\n';\n  proc:=proc||'  SELECT systeme.set_search_path(true) INTO query;\\n';\n  proc:=proc||'  SELECT ''SET search_path TO ''||schema_name||'',''||query INTO query;\\n';\n  proc:=proc||'  EXECUTE query;\\n';\n  proc:=proc||'  SELECT setting FROM pg_settings where name=''search_path'' INTO query;\\n';\n  proc:=proc||'  RAISE NOTICE ''SP: %%'',query;\\n';\n  proc:=proc||'  CREATE TABLE base_societe_etablissement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    societe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    nic CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    siret CHARACTER VARYING(32) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    adresse CHARACTER VARYING(128),\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_parametre (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    valeur CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_service (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    parent_service_id INTEGER,\\n';\n  proc:=proc||'    etablissement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_droits_profil (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_droits_profil_module (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    profil_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    module_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    selection BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insertion BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    modification BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    suppression BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_droits_module (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    code_interface CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    parent_module_id INTEGER,\\n';\n  proc:=proc||'    objets CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_acces (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    valeur INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_societe_employe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    service_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    utilisateur_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    utilisateur_login CHARACTER VARYING(32) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    profil_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    acces_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    prenom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    initiales CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    role CHARACTER VARYING(32),\\n';\n  proc:=proc||'    telephone CHARACTER VARYING(32),\\n';\n  proc:=proc||'    mobile CHARACTER VARYING(32),\\n';\n  proc:=proc||'    fax CHARACTER VARYING(32),\\n';\n  proc:=proc||'    email CHARACTER VARYING(128),\\n';\n  proc:=proc||'    bureau CHARACTER VARYING(128),\\n';\n  proc:=proc||'    note CHARACTER VARYING(32),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    morale BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    masculin BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    titre CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    civilites CHARACTER VARYING(64),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(38) NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    prenom CHARACTER VARYING(64),\\n';\n  proc:=proc||'    morale BOOLEAN NOT NULL,\\n';\n  proc:=proc||'    titre CHARACTER VARYING(64),\\n';\n  proc:=proc||'    debit_limite NUMERIC(16,2),\\n';\n  proc:=proc||'    credit_limite NUMERIC(16,2),\\n';\n  proc:=proc||'    langue_id INTEGER,\\n';\n  proc:=proc||'    site_web CHARACTER VARYING(128),\\n';\n  proc:=proc||'    parent_id INTEGER,\\n';\n  proc:=proc||'    responsable_id INTEGER,\\n';\n  proc:=proc||'    naissance_date DATE,\\n';\n  proc:=proc||'    ean13 CHARACTER VARYING(13),\\n';\n  proc:=proc||'    nom_soundex2 CHARACTER VARYING(4) NOT NULL,\\n';\n  proc:=proc||'    nom_phonex DOUBLE PRECISION,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_contact (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    date_fin DATE,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    complement CHARACTER VARYING(38),\\n';\n  proc:=proc||'    ligne3 CHARACTER VARYING(38),\\n';\n  proc:=proc||'    numero CHARACTER VARYING(5),\\n';\n  proc:=proc||'    voie CHARACTER VARYING(32),\\n';\n  proc:=proc||'    ligne5 CHARACTER VARYING(38),\\n';\n  proc:=proc||'    codepostal_commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    codepostal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    codepostal CHARACTER VARYING(5),\\n';\n  proc:=proc||'    commune CHARACTER VARYING(32),\\n';\n  proc:=proc||'    telephone CHARACTER VARYING(16),\\n';\n  proc:=proc||'    mobile CHARACTER VARYING(16),\\n';\n  proc:=proc||'    fax CHARACTER VARYING(16),\\n';\n  proc:=proc||'    email CHARACTER VARYING(128),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_contact_version (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    datetime_debut TIMESTAMP NOT NULL,\\n';\n  proc:=proc||'    datetime_fin TIMESTAMP NOT NULL,\\n';\n  proc:=proc||'    contact_id INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    complement CHARACTER VARYING(38),\\n';\n  proc:=proc||'    ligne3 CHARACTER VARYING(38),\\n';\n  proc:=proc||'    numero CHARACTER VARYING(5),\\n';\n  proc:=proc||'    voie CHARACTER VARYING(32),\\n';\n  proc:=proc||'    ligne5 CHARACTER VARYING(38),\\n';\n  proc:=proc||'    codepostal_commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    codepostal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    codepostal CHARACTER VARYING(5),\\n';\n  proc:=proc||'    commune CHARACTER VARYING(32),\\n';\n  proc:=proc||'    telephone CHARACTER VARYING(128),\\n';\n  proc:=proc||'    mobile CHARACTER VARYING(128),\\n';\n  proc:=proc||'    fax CHARACTER VARYING(128),\\n';\n  proc:=proc||'    email CHARACTER VARYING(128),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_contact_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_observation (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    importance_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    contenu CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_observation_importance (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    niveau INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    categorie_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    categorie_nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING(128),\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_partenaire_attribut_categorie (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    attribut_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_delai (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    nb_mois INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_jours INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    fin_de_mois BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    prolongation BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    jour_du_mois INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression_modele (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    impression_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    datetime_debut TIMESTAMP NOT NULL,\\n';\n  proc:=proc||'    datetime_fin TIMESTAMP NOT NULL,\\n';\n  proc:=proc||'    modele CHARACTER VARYING NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    modele CHARACTER VARYING NOT NULL DEFAULT ''%%%% Saisissez votre modÃ¨le'',\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE base_impression_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_ecriture (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    devise_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    devise_taux NUMERIC(16,8) NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    debit_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde_d NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    cumul_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    simulation BOOLEAN,\\n';\n  proc:=proc||'    lettrage CHARACTER VARYING(16),\\n';\n  proc:=proc||'    compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compte_numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_date DATE NOT NULL,\\n';\n  proc:=proc||'    journal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    pointage_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_piece (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    echeance DATE NOT NULL,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    exercice_code CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    exercice_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    journal_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_exercice (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    cloture BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_journal (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit_compteperm_id INTEGER,\\n';\n  proc:=proc||'    mois INTEGER NOT NULL,\\n';\n  proc:=proc||'    annee INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    provisoire BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    contrepartie BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_journal_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    abrev CHARACTER VARYING(4) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    provisoire BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    contrepartie BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    debit_compteperm_id INTEGER,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_pointage (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    banque_compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compteperm_partenaire_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_banque_compte (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(32) NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    banque_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_banque (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compteperm (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    acces_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    parent_compteperm_id INTEGER,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    signe BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    general BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    accept_aux BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    utilisable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    lettrable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    pointable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    groupable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    echeance INTEGER DEFAULT -1,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compte (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    compteperm_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    acces_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    parent_compte_id INTEGER,\\n';\n  proc:=proc||'    exercice_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    derniere_lettre CHARACTER VARYING(16),\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    signe BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    general BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    accept_aux BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    utilisable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    lettrable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    pointable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    groupable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    echeance INTEGER DEFAULT -1,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE compta_compte_cumul (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    mois INTEGER NOT NULL,\\n';\n  proc:=proc||'    annee INTEGER NOT NULL,\\n';\n  proc:=proc||'    debit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    credit NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    solde NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    nb_ecritures INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_sequence (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    immuable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    sequence CHARACTER VARYING(32) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    quotidienne BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    mensuelle BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    annuelle BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    prefixe CHARACTER VARYING(32) DEFAULT ''YYYY'',\\n';\n  proc:=proc||'    corps CHARACTER VARYING(32) NOT NULL DEFAULT ''FM099999'',\\n';\n  proc:=proc||'    suffixe CHARACTER VARYING(32),\\n';\n  proc:=proc||'    start INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    dernier_numero CHARACTER VARYING(32),\\n';\n  proc:=proc||'    jour INTEGER,\\n';\n  proc:=proc||'    mois INTEGER,\\n';\n  proc:=proc||'    annee INTEGER,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_compteperm_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    reduction BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    inquantifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    sans_stock BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    service BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    ean13 CHARACTER VARYING(13),\\n';\n  proc:=proc||'    categorie_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_categorie (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    parent_categorie_id INTEGER,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_service_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    service_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_taxe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    taux NUMERIC(16,8) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_prix_taxe_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    prix_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    taxe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    base_montant NUMERIC(16,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_produit_prix (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    achat BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    partenaire_id INTEGER,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_lien (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    libelle CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    partenaire1_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire2_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    role_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE,\\n';\n  proc:=proc||'    date_fin DATE,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_lien_role (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    prefixe CHARACTER VARYING(128) NOT NULL DEFAULT '' en tant que '',\\n';\n  proc:=proc||'    suffixe CHARACTER VARYING(128) NOT NULL DEFAULT ''.'',\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    nom_etendu CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_lien_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    phrase_directe CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    phrase_inverse CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_reduction (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    taux NUMERIC(16,8) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    facture_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    periode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    reduction_id INTEGER,\\n';\n  proc:=proc||'    periode_date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    periode_date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    type_nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    produit_nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    reduction_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_type_produit_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    adhesion_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_periode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date_debut DATE NOT NULL,\\n';\n  proc:=proc||'    date_fin DATE NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_type_periode_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    periode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_adhesion_transmission (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    adhesion_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    lien_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    sens_inverse BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_commande_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    avec_signature BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    validite_delai_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    paiement_delai_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_commande (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    validite_delai_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    validite_date DATE NOT NULL,\\n';\n  proc:=proc||'    avec_signature BOOLEAN NOT NULL,\\n';\n  proc:=proc||'    signature_client BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    avec_bons_livraison BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commande_contact_id INTEGER,\\n';\n  proc:=proc||'    commande_version_id INTEGER,\\n';\n  proc:=proc||'    facture_contact_id INTEGER,\\n';\n  proc:=proc||'    livraison_contact_id INTEGER,\\n';\n  proc:=proc||'    impression_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    modele_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    reduction_taux NUMERIC(16,8) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    acompte BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    objet CHARACTER VARYING(128),\\n';\n  proc:=proc||'    civilites CHARACTER VARYING(128),\\n';\n  proc:=proc||'    introduction CHARACTER VARYING,\\n';\n  proc:=proc||'    conclusion CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_commande_ligne (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    a_inclure BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    inclus BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prix_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    stock_id INTEGER,\\n';\n  proc:=proc||'    stock_mouvement_id INTEGER,\\n';\n  proc:=proc||'    reduction BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    montant_unitaire_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_unitaire_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    montant_brut_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_facture (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    piece_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    paiement_delai_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    paiement_date DATE NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    facture_version_id INTEGER,\\n';\n  proc:=proc||'    livraison_version_id INTEGER,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    impression_id INTEGER,\\n';\n  proc:=proc||'    modele_id INTEGER,\\n';\n  proc:=proc||'    reduction_taux NUMERIC(16,8) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    objet CHARACTER VARYING(128),\\n';\n  proc:=proc||'    civilites CHARACTER VARYING(128),\\n';\n  proc:=proc||'    message CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_facture_ligne (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commande_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    ecriture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    a_inclure BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    inclus BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prix_id INTEGER,\\n';\n  proc:=proc||'    stock_mouvement_id INTEGER,\\n';\n  proc:=proc||'    reduction BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    montant_unitaire_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_unitaire_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_avoir (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(16) NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    commande_id INTEGER,\\n';\n  proc:=proc||'    facture_id INTEGER,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER,\\n';\n  proc:=proc||'    date DATE,\\n';\n  proc:=proc||'    impression_id INTEGER,\\n';\n  proc:=proc||'    modele_id INTEGER,\\n';\n  proc:=proc||'    reduction_taux NUMERIC(16,8) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2),\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2),\\n';\n  proc:=proc||'    objet CHARACTER VARYING(128),\\n';\n  proc:=proc||'    civilites CHARACTER VARYING(128),\\n';\n  proc:=proc||'    message CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_avoir_ligne (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    immodifiable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    facture_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    avoir_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prix_id INTEGER,\\n';\n  proc:=proc||'    stock_mouvement_id INTEGER,\\n';\n  proc:=proc||'    montant_unitaire_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_unitaire_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_relance (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    datetime TIMESTAMP UNIQUE NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_relance_lettre (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    relance_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    etape_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    echeance_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_relance_mode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_relance_mode_etape (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    relance_mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nb_jours INTEGER NOT NULL,\\n';\n  proc:=proc||'    message CHARACTER VARYING NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_facture_reglement_echeance (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    relance_mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prevision_montant NUMERIC(16,2),\\n';\n  proc:=proc||'    date DATE,\\n';\n  proc:=proc||'    part_montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    partiel BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    reglement_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_reglement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    banque CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    numero_compte CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    reference CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    date_reglement DATE NOT NULL,\\n';\n  proc:=proc||'    date_saisie DATE NOT NULL,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_reglement_mode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    banque_compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_reversement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    reglement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_ventes_reversement_mode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    societe_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_facture (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero CHARACTER VARYING(128) NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    impression_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    modele_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_facture_ligne (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    prix_id INTEGER,\\n';\n  proc:=proc||'    stock_mouvement_id INTEGER,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_brut_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ttc NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    montant_ht NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_facture_reglement_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    reglement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partiel BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_reglement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    mode_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    reference CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    date_reglement DATE NOT NULL,\\n';\n  proc:=proc||'    date_saisie DATE NOT NULL,\\n';\n  proc:=proc||'    montant NUMERIC(16,2) NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_achats_reglement_mode (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    banque_compte_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    compteperm_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_stock_lieu (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    lieu_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_stock (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    stock_lieu_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    actif BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    defaut BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    quantite_init NUMERIC(12,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    quantite_max NUMERIC(12,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestion_stock_mouvement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    stock_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    quantite NUMERIC(12,2) NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    virtuel BOOLEAN NOT NULL DEFAULT true,\\n';\n  proc:=proc||'    date DATE,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_cotisation_parametrage (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    avec_defaut_produit BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    defaut_produit_code CHARACTER VARYING(16),\\n';\n  proc:=proc||'    lot_dernier_numero INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    facture_objet CHARACTER VARYING NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_cotisation_lot (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    numero INTEGER NOT NULL,\\n';\n  proc:=proc||'    cotisation_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    facturable BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    en_facture BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    erreur_message CHARACTER VARYING NOT NULL DEFAULT ''false'',\\n';\n  proc:=proc||'    commande_id INTEGER,\\n';\n  proc:=proc||'    facture_id INTEGER,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_canton_groupe (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_canton_groupe_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    canton_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    groupe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_structure (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    code_etendu CHARACTER VARYING UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    externe BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    parent_structure_id INTEGER,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_structure_commune_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    structure_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commune_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_procedure_commande_rel (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    procedure_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    ordre INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    complement CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_procedure (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_tache (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    duree NUMERIC(12,2) NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    dossier_id INTEGER,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_tache_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_dossier (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    complement CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    employe_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    etat_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    date_ouverture DATE,\\n';\n  proc:=proc||'    date_cloture DATE,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_dossier_commande (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    ordre INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    dossier_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_dossier_type (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    service_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_juridique_dossier_etat (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    note CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    code CHARACTER VARYING(16) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nom CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    nb_prerelances INTEGER NOT NULL,\\n';\n  proc:=proc||'    nb_postrelances INTEGER NOT NULL,\\n';\n  proc:=proc||'    numero_prochain INTEGER NOT NULL,\\n';\n  proc:=proc||'    contact_type_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication_parution (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    publication_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    code CHARACTER VARYING(64) UNIQUE NOT NULL,\\n';\n  proc:=proc||'    numero INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    date DATE NOT NULL,\\n';\n  proc:=proc||'    titre CHARACTER VARYING(64) NOT NULL,\\n';\n  proc:=proc||'    description CHARACTER VARYING,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication_abonnement (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    publication_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    produit_id INTEGER UNIQUE NOT NULL,\\n';\n  proc:=proc||'    nb_numeros INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    differe INTEGER NOT NULL DEFAULT 0,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication_abonnement_commande (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    commande_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    abonnement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    publication_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    contact_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nb_exemplaires INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  CREATE TABLE gestsea_publication_abonnement_routage (\\n';\n  proc:=proc||'    id SERIAL NOT NULL PRIMARY KEY,\\n';\n  proc:=proc||'    commande_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    facture_ligne_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    facture_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    partenaire_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    contact_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    abonnement_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    publication_id INTEGER NOT NULL,\\n';\n  proc:=proc||'    nb_exemplaires INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    numero_debut INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    numero_fin INTEGER NOT NULL DEFAULT 1,\\n';\n  proc:=proc||'    suspendu BOOLEAN NOT NULL DEFAULT false,\\n';\n  proc:=proc||'    insert_uid INTEGER,\\n';\n  proc:=proc||'    insert_date TIMESTAMP,\\n';\n  proc:=proc||'    update_uid INTEGER,\\n';\n  proc:=proc||'    update_date TIMESTAMP\\n';\n  proc:=proc||'  );\\n';\n  proc:=proc||'  -- Indexes\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_etablissement_code_index ON base_societe_etablissement(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_parametre_code_index ON base_societe_parametre(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_parametre_nom_index ON base_societe_parametre(nom);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_societe_service_code_index ON base_societe_service(code);\\n';\n  proc:=proc||'  CREATE  UNIQUE INDEX base_partenaire_type_nom_index ON base_partenaire_type(nom);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_type_titre_index ON base_partenaire_type(titre);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_nom_index ON base_partenaire(nom);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_type_id_index ON base_partenaire(type_id);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_libelle_index ON base_partenaire(libelle);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_prenom_index ON base_partenaire(prenom);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_titre_index ON base_partenaire(titre);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_langue_id_index ON base_partenaire(langue_id);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_nom_soundex2_index ON base_partenaire(nom_soundex2);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_nom_phonex_index ON base_partenaire(nom_phonex);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_codepostal_index ON base_partenaire_contact(codepostal);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_commune_index ON base_partenaire_contact(commune);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_telephone_index ON base_partenaire_contact(telephone);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_mobile_index ON base_partenaire_contact(mobile);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_fax_index ON base_partenaire_contact(fax);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_email_index ON base_partenaire_contact(email);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_codepostal_index ON base_partenaire_contact_version(codepostal);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_commune_index ON base_partenaire_contact_version(commune);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_telephone_index ON base_partenaire_contact_version(telephone);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_mobile_index ON base_partenaire_contact_version(mobile);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_fax_index ON base_partenaire_contact_version(fax);\\n';\n  proc:=proc||'  CREATE  INDEX base_partenaire_contact_version_email_index ON base_partenaire_contact_version(email);\\n';\n  proc:=proc||'  CREATE  INDEX compta_compteperm_parent_compteperm_id_index ON compta_compteperm(parent_compteperm_id);\\n';\n  proc:=proc||'  CREATE  INDEX compta_compte_derniere_lettre_index ON compta_compte(derniere_lettre);\\n';\n  proc:=proc||'  CREATE  INDEX gestion_produit_prix_libelle_index ON gestion_produit_prix(libelle);\\n';\n  proc:=proc||'  CREATE  INDEX gestion_produit_prix_produit_id_index ON gestion_produit_prix(produit_id);\\n';\n  proc:=proc||'  CREATE  INDEX gestion_produit_prix_date_debut_index ON gestion_produit_prix(date_debut);\\n';\n  proc:=proc||'  CREATE  INDEX gestion_produit_prix_date_fin_index ON gestion_produit_prix(date_fin);\\n';\n  proc:=proc||'  CREATE  INDEX gestsea_cotisation_lot_commande_id_index ON gestsea_cotisation_lot(commande_id);\\n';\n  proc:=proc||'  CREATE  INDEX gestsea_cotisation_lot_facture_id_index ON gestsea_cotisation_lot(facture_id);\\n';\n  proc:=proc||'  -- Constraints\\n';\n  proc:=proc||'  RAISE NOTICE ''Contraintes'';\\n';\n  proc:=proc||'  ALTER TABLE base_societe_etablissement ADD CONSTRAINT base_societe_etablissement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_etablissement ADD CONSTRAINT base_societe_etablissement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_etablissement ADD CONSTRAINT base_societe_etablissement_constraint0 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_parametre ADD CONSTRAINT base_societe_parametre_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_parametre ADD CONSTRAINT base_societe_parametre_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint0 FOREIGN KEY (parent_service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_service ADD CONSTRAINT base_societe_service_constraint1 FOREIGN KEY (etablissement_id) REFERENCES base_societe_etablissement(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil ADD CONSTRAINT base_droits_profil_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil ADD CONSTRAINT base_droits_profil_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_constraint0 UNIQUE (profil_id,module_id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_constraint1 FOREIGN KEY (module_id) REFERENCES base_droits_module(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_profil_module ADD CONSTRAINT base_droits_profil_module_constraint2 FOREIGN KEY (profil_id) REFERENCES base_droits_profil(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_module ADD CONSTRAINT base_droits_module_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_module ADD CONSTRAINT base_droits_module_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_droits_module ADD CONSTRAINT base_droits_module_constraint0 FOREIGN KEY (parent_module_id) REFERENCES base_droits_module(id);\\n';\n  proc:=proc||'  ALTER TABLE base_acces ADD CONSTRAINT base_acces_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_acces ADD CONSTRAINT base_acces_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_acces ADD CONSTRAINT base_acces_constraint0 CHECK (valeur>=0);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint0 FOREIGN KEY (service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint1 FOREIGN KEY (utilisateur_id) REFERENCES systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint2 FOREIGN KEY (utilisateur_login) REFERENCES systeme_utilisateur(login);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint3 FOREIGN KEY (profil_id) REFERENCES base_droits_profil(id);\\n';\n  proc:=proc||'  ALTER TABLE base_societe_employe ADD CONSTRAINT base_societe_employe_constraint4 FOREIGN KEY (acces_id) REFERENCES base_acces(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_type ADD CONSTRAINT base_partenaire_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_type ADD CONSTRAINT base_partenaire_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint0 FOREIGN KEY (parent_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint1 FOREIGN KEY (responsable_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint2 FOREIGN KEY (langue_id) REFERENCES base_langue(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire ADD CONSTRAINT base_partenaire_constraint3 FOREIGN KEY (type_id) REFERENCES base_partenaire_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint1 FOREIGN KEY (type_id) REFERENCES base_partenaire_contact_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint2 FOREIGN KEY (codepostal_commune_id) REFERENCES base_codepostal_commune_rel(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint3 FOREIGN KEY (codepostal_id) REFERENCES base_codepostal(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact ADD CONSTRAINT base_partenaire_contact_constraint4 FOREIGN KEY (commune_id) REFERENCES base_commune(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint0 CHECK (datetime_fin>=datetime_debut);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint1 FOREIGN KEY (contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint2 FOREIGN KEY (codepostal_commune_id) REFERENCES base_codepostal_commune_rel(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint3 FOREIGN KEY (codepostal_id) REFERENCES base_codepostal(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_version ADD CONSTRAINT base_partenaire_contact_version_constraint4 FOREIGN KEY (commune_id) REFERENCES base_commune(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_type ADD CONSTRAINT base_partenaire_contact_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_contact_type ADD CONSTRAINT base_partenaire_contact_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation ADD CONSTRAINT base_partenaire_observation_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation ADD CONSTRAINT base_partenaire_observation_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation ADD CONSTRAINT base_partenaire_observation_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation ADD CONSTRAINT base_partenaire_observation_constraint1 FOREIGN KEY (importance_id) REFERENCES base_partenaire_observation_importance(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation_importance ADD CONSTRAINT base_partenaire_observation_importance_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_observation_importance ADD CONSTRAINT base_partenaire_observation_importance_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint1 FOREIGN KEY (type_id) REFERENCES base_partenaire_attribut_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut ADD CONSTRAINT base_partenaire_attribut_constraint2 FOREIGN KEY (categorie_id) REFERENCES base_partenaire_attribut_categorie(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_type ADD CONSTRAINT base_partenaire_attribut_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_type ADD CONSTRAINT base_partenaire_attribut_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_categorie ADD CONSTRAINT base_partenaire_attribut_categorie_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_categorie ADD CONSTRAINT base_partenaire_attribut_categorie_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_partenaire_attribut_categorie ADD CONSTRAINT base_partenaire_attribut_categorie_constraint0 FOREIGN KEY (attribut_type_id) REFERENCES base_partenaire_attribut_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_constraint0 CHECK (nb_mois>=0);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_constraint1 CHECK (nb_jours>=0);\\n';\n  proc:=proc||'  ALTER TABLE base_delai ADD CONSTRAINT base_delai_constraint2 CHECK (jour_du_mois BETWEEN 1 AND 31);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_modele ADD CONSTRAINT base_impression_modele_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_modele ADD CONSTRAINT base_impression_modele_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_modele ADD CONSTRAINT base_impression_modele_constraint0 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression ADD CONSTRAINT base_impression_constraint0 FOREIGN KEY (type_id) REFERENCES base_impression_type(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_type ADD CONSTRAINT base_impression_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE base_impression_type ADD CONSTRAINT base_impression_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint0 FOREIGN KEY (compte_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint1 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint2 FOREIGN KEY (piece_id) REFERENCES compta_piece(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint3 FOREIGN KEY (pointage_id) REFERENCES compta_pointage(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint4 FOREIGN KEY (journal_id) REFERENCES compta_journal(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_ecriture ADD CONSTRAINT compta_ecriture_constraint5 FOREIGN KEY (cumul_id) REFERENCES compta_compte_cumul(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint0 FOREIGN KEY (exercice_id) REFERENCES compta_exercice(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint1 FOREIGN KEY (exercice_code) REFERENCES compta_exercice(code);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint2 FOREIGN KEY (journal_id) REFERENCES compta_journal(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_piece ADD CONSTRAINT compta_piece_constraint3 FOREIGN KEY (journal_type_id) REFERENCES compta_journal_type(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_exercice ADD CONSTRAINT compta_exercice_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_exercice ADD CONSTRAINT compta_exercice_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint0 UNIQUE (type_id,annee,mois);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint1 FOREIGN KEY (type_id) REFERENCES compta_journal_type(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal ADD CONSTRAINT compta_journal_constraint2 FOREIGN KEY (debit_compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal_type ADD CONSTRAINT compta_journal_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal_type ADD CONSTRAINT compta_journal_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_journal_type ADD CONSTRAINT compta_journal_type_constraint0 FOREIGN KEY (debit_compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_pointage ADD CONSTRAINT compta_pointage_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_pointage ADD CONSTRAINT compta_pointage_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_pointage ADD CONSTRAINT compta_pointage_constraint0 FOREIGN KEY (banque_compte_id) REFERENCES compta_banque_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_constraint0 UNIQUE (partenaire_id,compteperm_id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm_partenaire_rel ADD CONSTRAINT compta_compteperm_partenaire_rel_constraint2 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_constraint0 UNIQUE (numero,banque_id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_constraint1 FOREIGN KEY (banque_id) REFERENCES compta_banque(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque_compte ADD CONSTRAINT compta_banque_compte_constraint2 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque ADD CONSTRAINT compta_banque_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque ADD CONSTRAINT compta_banque_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_banque ADD CONSTRAINT compta_banque_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_constraint0 FOREIGN KEY (acces_id) REFERENCES base_acces(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compteperm ADD CONSTRAINT compta_compteperm_constraint1 FOREIGN KEY (parent_compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint1 FOREIGN KEY (parent_compte_id) REFERENCES compta_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint2 FOREIGN KEY (acces_id) REFERENCES base_acces(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte ADD CONSTRAINT compta_compte_constraint3 FOREIGN KEY (exercice_id) REFERENCES compta_exercice(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte_cumul ADD CONSTRAINT compta_compte_cumul_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte_cumul ADD CONSTRAINT compta_compte_cumul_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE compta_compte_cumul ADD CONSTRAINT compta_compte_cumul_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_sequence ADD CONSTRAINT gestion_sequence_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_sequence ADD CONSTRAINT gestion_sequence_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_compteperm_rel ADD CONSTRAINT gestion_produit_compteperm_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_compteperm_rel ADD CONSTRAINT gestion_produit_compteperm_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_compteperm_rel ADD CONSTRAINT gestion_produit_compteperm_rel_constraint0 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_compteperm_rel ADD CONSTRAINT gestion_produit_compteperm_rel_constraint1 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit ADD CONSTRAINT gestion_produit_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit ADD CONSTRAINT gestion_produit_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit ADD CONSTRAINT gestion_produit_constraint0 CHECK (date_fin IS NULL OR (date_fin IS NOT NULL AND date_fin>=date_debut));\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit ADD CONSTRAINT gestion_produit_constraint1 FOREIGN KEY (categorie_id) REFERENCES gestion_produit_categorie(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_categorie ADD CONSTRAINT gestion_produit_categorie_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_categorie ADD CONSTRAINT gestion_produit_categorie_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_categorie ADD CONSTRAINT gestion_produit_categorie_constraint0 FOREIGN KEY (parent_categorie_id) REFERENCES gestion_produit_categorie(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_constraint0 UNIQUE (produit_id,service_id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_service_rel ADD CONSTRAINT gestion_produit_service_rel_constraint2 FOREIGN KEY (service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_taxe ADD CONSTRAINT gestion_produit_taxe_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_taxe ADD CONSTRAINT gestion_produit_taxe_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_taxe ADD CONSTRAINT gestion_produit_taxe_constraint0 CHECK (taux>=0);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_taxe ADD CONSTRAINT gestion_produit_taxe_constraint1 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix_taxe_rel ADD CONSTRAINT gestion_produit_prix_taxe_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix_taxe_rel ADD CONSTRAINT gestion_produit_prix_taxe_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix_taxe_rel ADD CONSTRAINT gestion_produit_prix_taxe_rel_constraint0 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix_taxe_rel ADD CONSTRAINT gestion_produit_prix_taxe_rel_constraint1 FOREIGN KEY (taxe_id) REFERENCES gestion_produit_taxe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_constraint0 CHECK (date_fin>=date_debut);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_constraint1 CHECK (NOT achat OR (achat AND partenaire_id IS NOT NULL));\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_constraint2 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_produit_prix ADD CONSTRAINT gestion_produit_prix_constraint3 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_constraint0 FOREIGN KEY (partenaire1_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_constraint1 FOREIGN KEY (partenaire2_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_constraint2 FOREIGN KEY (type_id) REFERENCES gestion_lien_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien ADD CONSTRAINT gestion_lien_constraint3 FOREIGN KEY (role_id) REFERENCES gestion_lien_role(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_role ADD CONSTRAINT gestion_lien_role_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_role ADD CONSTRAINT gestion_lien_role_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_role ADD CONSTRAINT gestion_lien_role_constraint0 FOREIGN KEY (type_id) REFERENCES gestion_lien_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_type ADD CONSTRAINT gestion_lien_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_lien_type ADD CONSTRAINT gestion_lien_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_reduction ADD CONSTRAINT gestion_reduction_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_reduction ADD CONSTRAINT gestion_reduction_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint0 UNIQUE (type_id,partenaire_id,periode_id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint1 FOREIGN KEY (type_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint2 FOREIGN KEY (periode_id) REFERENCES gestion_adhesion_periode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint3 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint4 FOREIGN KEY (reduction_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint5 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion ADD CONSTRAINT gestion_adhesion_constraint6 FOREIGN KEY (facture_ligne_id) REFERENCES gestion_ventes_facture_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type ADD CONSTRAINT gestion_adhesion_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type ADD CONSTRAINT gestion_adhesion_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type ADD CONSTRAINT gestion_adhesion_type_constraint0 FOREIGN KEY (reduction_id) REFERENCES gestion_reduction(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_produit_rel ADD CONSTRAINT gestion_adhesion_type_produit_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_produit_rel ADD CONSTRAINT gestion_adhesion_type_produit_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_produit_rel ADD CONSTRAINT gestion_adhesion_type_produit_rel_constraint0 FOREIGN KEY (adhesion_type_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_produit_rel ADD CONSTRAINT gestion_adhesion_type_produit_rel_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_periode ADD CONSTRAINT gestion_adhesion_periode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_periode ADD CONSTRAINT gestion_adhesion_periode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_constraint0 UNIQUE (type_id,periode_id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_constraint1 FOREIGN KEY (type_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_type_periode_rel ADD CONSTRAINT gestion_adhesion_type_periode_rel_constraint2 FOREIGN KEY (periode_id) REFERENCES gestion_adhesion_periode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_transmission ADD CONSTRAINT gestion_adhesion_transmission_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_transmission ADD CONSTRAINT gestion_adhesion_transmission_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_transmission ADD CONSTRAINT gestion_adhesion_transmission_constraint0 FOREIGN KEY (adhesion_type_id) REFERENCES gestion_adhesion_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_adhesion_transmission ADD CONSTRAINT gestion_adhesion_transmission_constraint1 FOREIGN KEY (lien_type_id) REFERENCES gestion_lien_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_type ADD CONSTRAINT gestion_ventes_commande_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_type ADD CONSTRAINT gestion_ventes_commande_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_type ADD CONSTRAINT gestion_ventes_commande_type_constraint0 FOREIGN KEY (validite_delai_id) REFERENCES base_delai(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_type ADD CONSTRAINT gestion_ventes_commande_type_constraint1 FOREIGN KEY (paiement_delai_id) REFERENCES base_delai(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint0 FOREIGN KEY (type_id) REFERENCES gestion_ventes_commande_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint2 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint3 FOREIGN KEY (commande_contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint4 FOREIGN KEY (commande_version_id) REFERENCES base_partenaire_contact_version(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint5 FOREIGN KEY (facture_contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint6 FOREIGN KEY (livraison_contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint7 FOREIGN KEY (modele_id) REFERENCES base_impression_modele(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint8 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande ADD CONSTRAINT gestion_ventes_commande_constraint9 FOREIGN KEY (validite_delai_id) REFERENCES base_delai(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint0 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint2 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint3 FOREIGN KEY (stock_id) REFERENCES gestion_stock(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_commande_ligne ADD CONSTRAINT gestion_ventes_commande_ligne_constraint4 FOREIGN KEY (stock_mouvement_id) REFERENCES gestion_stock_mouvement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint0 FOREIGN KEY (paiement_delai_id) REFERENCES base_delai(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint1 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint2 FOREIGN KEY (piece_id) REFERENCES compta_piece(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint3 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint4 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint5 FOREIGN KEY (facture_version_id) REFERENCES base_partenaire_contact_version(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint6 FOREIGN KEY (livraison_version_id) REFERENCES base_partenaire_contact_version(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint7 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture ADD CONSTRAINT gestion_ventes_facture_constraint8 FOREIGN KEY (modele_id) REFERENCES base_impression_modele(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint0 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint1 FOREIGN KEY (commande_ligne_id) REFERENCES gestion_ventes_commande_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint2 FOREIGN KEY (ecriture_id) REFERENCES compta_ecriture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint3 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint4 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_ligne ADD CONSTRAINT gestion_ventes_facture_ligne_constraint5 FOREIGN KEY (stock_mouvement_id) REFERENCES gestion_stock_mouvement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint0 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint1 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint2 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint3 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint4 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir ADD CONSTRAINT gestion_ventes_avoir_constraint5 FOREIGN KEY (modele_id) REFERENCES base_impression_modele(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint0 FOREIGN KEY (avoir_id) REFERENCES gestion_ventes_avoir(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint1 FOREIGN KEY (facture_ligne_id) REFERENCES gestion_ventes_facture_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint2 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint3 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_avoir_ligne ADD CONSTRAINT gestion_ventes_avoir_ligne_constraint4 FOREIGN KEY (stock_mouvement_id) REFERENCES gestion_stock_mouvement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance ADD CONSTRAINT gestion_ventes_relance_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance ADD CONSTRAINT gestion_ventes_relance_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_constraint0 FOREIGN KEY (relance_id) REFERENCES gestion_ventes_relance(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_constraint1 FOREIGN KEY (etape_id) REFERENCES gestion_ventes_relance_mode_etape(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_constraint2 FOREIGN KEY (echeance_id) REFERENCES gestion_ventes_facture_reglement_echeance(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_lettre ADD CONSTRAINT gestion_ventes_relance_lettre_constraint3 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode ADD CONSTRAINT gestion_ventes_relance_mode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode ADD CONSTRAINT gestion_ventes_relance_mode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode_etape ADD CONSTRAINT gestion_ventes_relance_mode_etape_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode_etape ADD CONSTRAINT gestion_ventes_relance_mode_etape_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_relance_mode_etape ADD CONSTRAINT gestion_ventes_relance_mode_etape_constraint0 FOREIGN KEY (relance_mode_id) REFERENCES gestion_ventes_relance_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_constraint0 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_constraint2 FOREIGN KEY (relance_mode_id) REFERENCES gestion_ventes_relance_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_facture_reglement_echeance ADD CONSTRAINT gestion_ventes_facture_reglement_echeance_constraint3 FOREIGN KEY (reglement_id) REFERENCES gestion_ventes_reglement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement ADD CONSTRAINT gestion_ventes_reglement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement ADD CONSTRAINT gestion_ventes_reglement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement ADD CONSTRAINT gestion_ventes_reglement_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement ADD CONSTRAINT gestion_ventes_reglement_constraint1 FOREIGN KEY (mode_id) REFERENCES gestion_ventes_reglement_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement_mode ADD CONSTRAINT gestion_ventes_reglement_mode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement_mode ADD CONSTRAINT gestion_ventes_reglement_mode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement_mode ADD CONSTRAINT gestion_ventes_reglement_mode_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reglement_mode ADD CONSTRAINT gestion_ventes_reglement_mode_constraint1 FOREIGN KEY (banque_compte_id) REFERENCES compta_banque_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement ADD CONSTRAINT gestion_ventes_reversement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement ADD CONSTRAINT gestion_ventes_reversement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement ADD CONSTRAINT gestion_ventes_reversement_constraint0 FOREIGN KEY (reglement_id) REFERENCES gestion_ventes_reglement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement ADD CONSTRAINT gestion_ventes_reversement_constraint1 FOREIGN KEY (mode_id) REFERENCES gestion_ventes_reversement_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement_mode ADD CONSTRAINT gestion_ventes_reversement_mode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement_mode ADD CONSTRAINT gestion_ventes_reversement_mode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement_mode ADD CONSTRAINT gestion_ventes_reversement_mode_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_ventes_reversement_mode ADD CONSTRAINT gestion_ventes_reversement_mode_constraint1 FOREIGN KEY (societe_id) REFERENCES base_societe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_constraint1 FOREIGN KEY (impression_id) REFERENCES base_impression(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture ADD CONSTRAINT gestion_achats_facture_constraint2 FOREIGN KEY (modele_id) REFERENCES base_impression_modele(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_constraint0 FOREIGN KEY (facture_id) REFERENCES gestion_achats_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_constraint2 FOREIGN KEY (prix_id) REFERENCES gestion_produit_prix(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_ligne ADD CONSTRAINT gestion_achats_facture_ligne_constraint3 FOREIGN KEY (stock_mouvement_id) REFERENCES gestion_stock_mouvement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_reglement_rel ADD CONSTRAINT gestion_achats_facture_reglement_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_reglement_rel ADD CONSTRAINT gestion_achats_facture_reglement_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_reglement_rel ADD CONSTRAINT gestion_achats_facture_reglement_rel_constraint0 FOREIGN KEY (facture_id) REFERENCES gestion_achats_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_facture_reglement_rel ADD CONSTRAINT gestion_achats_facture_reglement_rel_constraint1 FOREIGN KEY (reglement_id) REFERENCES gestion_achats_reglement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement ADD CONSTRAINT gestion_achats_reglement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement ADD CONSTRAINT gestion_achats_reglement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement ADD CONSTRAINT gestion_achats_reglement_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement ADD CONSTRAINT gestion_achats_reglement_constraint1 FOREIGN KEY (mode_id) REFERENCES gestion_achats_reglement_mode(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement_mode ADD CONSTRAINT gestion_achats_reglement_mode_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement_mode ADD CONSTRAINT gestion_achats_reglement_mode_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement_mode ADD CONSTRAINT gestion_achats_reglement_mode_constraint0 FOREIGN KEY (compteperm_id) REFERENCES compta_compteperm(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_achats_reglement_mode ADD CONSTRAINT gestion_achats_reglement_mode_constraint1 FOREIGN KEY (banque_compte_id) REFERENCES compta_banque_compte(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_lieu ADD CONSTRAINT gestion_stock_lieu_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_lieu ADD CONSTRAINT gestion_stock_lieu_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_lieu ADD CONSTRAINT gestion_stock_lieu_constraint0 FOREIGN KEY (lieu_id) REFERENCES gestion_stock_lieu(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock ADD CONSTRAINT gestion_stock_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock ADD CONSTRAINT gestion_stock_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock ADD CONSTRAINT gestion_stock_constraint0 FOREIGN KEY (stock_lieu_id) REFERENCES gestion_stock_lieu(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock ADD CONSTRAINT gestion_stock_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_mouvement ADD CONSTRAINT gestion_stock_mouvement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_mouvement ADD CONSTRAINT gestion_stock_mouvement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestion_stock_mouvement ADD CONSTRAINT gestion_stock_mouvement_constraint0 FOREIGN KEY (stock_id) REFERENCES gestion_stock(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_parametrage ADD CONSTRAINT gestsea_cotisation_parametrage_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_parametrage ADD CONSTRAINT gestsea_cotisation_parametrage_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_parametrage ADD CONSTRAINT gestsea_cotisation_parametrage_constraint0 CHECK (NOT avec_defaut_produit OR (avec_defaut_produit AND defaut_produit_code IS NOT NULL));\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_lot ADD CONSTRAINT gestsea_cotisation_lot_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_lot ADD CONSTRAINT gestsea_cotisation_lot_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_cotisation_lot ADD CONSTRAINT gestsea_cotisation_lot_constraint0 FOREIGN KEY (cotisation_id) REFERENCES gestsea_cotisation(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe ADD CONSTRAINT gestsea_canton_groupe_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe ADD CONSTRAINT gestsea_canton_groupe_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe_rel ADD CONSTRAINT gestsea_canton_groupe_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe_rel ADD CONSTRAINT gestsea_canton_groupe_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe_rel ADD CONSTRAINT gestsea_canton_groupe_rel_constraint0 FOREIGN KEY (canton_id) REFERENCES base_canton(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_canton_groupe_rel ADD CONSTRAINT gestsea_canton_groupe_rel_constraint1 FOREIGN KEY (groupe_id) REFERENCES gestsea_canton_groupe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure ADD CONSTRAINT gestsea_structure_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure ADD CONSTRAINT gestsea_structure_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure ADD CONSTRAINT gestsea_structure_constraint0 FOREIGN KEY (parent_structure_id) REFERENCES gestsea_structure(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure ADD CONSTRAINT gestsea_structure_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure_commune_rel ADD CONSTRAINT gestsea_structure_commune_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure_commune_rel ADD CONSTRAINT gestsea_structure_commune_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure_commune_rel ADD CONSTRAINT gestsea_structure_commune_rel_constraint0 FOREIGN KEY (structure_id) REFERENCES gestsea_structure(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_structure_commune_rel ADD CONSTRAINT gestsea_structure_commune_rel_constraint1 FOREIGN KEY (commune_id) REFERENCES base_commune(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure_commande_rel ADD CONSTRAINT gestsea_juridique_procedure_commande_rel_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure_commande_rel ADD CONSTRAINT gestsea_juridique_procedure_commande_rel_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure_commande_rel ADD CONSTRAINT gestsea_juridique_procedure_commande_rel_constraint0 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure_commande_rel ADD CONSTRAINT gestsea_juridique_procedure_commande_rel_constraint1 FOREIGN KEY (procedure_id) REFERENCES gestsea_juridique_procedure(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure ADD CONSTRAINT gestsea_juridique_procedure_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_procedure ADD CONSTRAINT gestsea_juridique_procedure_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_constraint0 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_constraint1 FOREIGN KEY (type_id) REFERENCES gestsea_juridique_tache_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_constraint2 FOREIGN KEY (dossier_id) REFERENCES gestsea_juridique_dossier(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache ADD CONSTRAINT gestsea_juridique_tache_constraint3 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache_type ADD CONSTRAINT gestsea_juridique_tache_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_tache_type ADD CONSTRAINT gestsea_juridique_tache_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_constraint0 FOREIGN KEY (employe_id) REFERENCES base_societe_employe(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_constraint1 FOREIGN KEY (etat_id) REFERENCES gestsea_juridique_dossier_etat(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier ADD CONSTRAINT gestsea_juridique_dossier_constraint2 FOREIGN KEY (type_id) REFERENCES gestsea_juridique_dossier_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_commande ADD CONSTRAINT gestsea_juridique_dossier_commande_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_commande ADD CONSTRAINT gestsea_juridique_dossier_commande_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_commande ADD CONSTRAINT gestsea_juridique_dossier_commande_constraint0 FOREIGN KEY (dossier_id) REFERENCES gestsea_juridique_dossier(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_commande ADD CONSTRAINT gestsea_juridique_dossier_commande_constraint1 FOREIGN KEY (commande_id) REFERENCES gestion_ventes_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_type ADD CONSTRAINT gestsea_juridique_dossier_type_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_type ADD CONSTRAINT gestsea_juridique_dossier_type_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_type ADD CONSTRAINT gestsea_juridique_dossier_type_constraint0 FOREIGN KEY (service_id) REFERENCES base_societe_service(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_etat ADD CONSTRAINT gestsea_juridique_dossier_etat_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_juridique_dossier_etat ADD CONSTRAINT gestsea_juridique_dossier_etat_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication ADD CONSTRAINT gestsea_publication_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication ADD CONSTRAINT gestsea_publication_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication ADD CONSTRAINT gestsea_publication_constraint0 FOREIGN KEY (contact_type_id) REFERENCES base_partenaire_contact_type(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_parution ADD CONSTRAINT gestsea_publication_parution_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_parution ADD CONSTRAINT gestsea_publication_parution_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_parution ADD CONSTRAINT gestsea_publication_parution_constraint0 FOREIGN KEY (publication_id) REFERENCES gestsea_publication(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement ADD CONSTRAINT gestsea_publication_abonnement_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement ADD CONSTRAINT gestsea_publication_abonnement_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement ADD CONSTRAINT gestsea_publication_abonnement_constraint0 FOREIGN KEY (publication_id) REFERENCES gestsea_publication(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement ADD CONSTRAINT gestsea_publication_abonnement_constraint1 FOREIGN KEY (produit_id) REFERENCES gestion_produit(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint0 FOREIGN KEY (commande_ligne_id) REFERENCES gestion_ventes_commande_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint1 FOREIGN KEY (publication_id) REFERENCES gestsea_publication(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint2 FOREIGN KEY (abonnement_id) REFERENCES gestsea_publication_abonnement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint3 FOREIGN KEY (contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_commande ADD CONSTRAINT gestsea_publication_abonnement_commande_constraint4 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_ctlinsert FOREIGN KEY (insert_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_ctlupdate FOREIGN KEY (update_uid) REFERENCES systeme.systeme_utilisateur(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint0 FOREIGN KEY (commande_id) REFERENCES gestsea_publication_abonnement_commande(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint1 FOREIGN KEY (partenaire_id) REFERENCES base_partenaire(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint2 FOREIGN KEY (contact_id) REFERENCES base_partenaire_contact(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint3 FOREIGN KEY (facture_id) REFERENCES gestion_ventes_facture(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint4 FOREIGN KEY (facture_ligne_id) REFERENCES gestion_ventes_facture_ligne(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint5 FOREIGN KEY (abonnement_id) REFERENCES gestsea_publication_abonnement(id);\\n';\n  proc:=proc||'  ALTER TABLE gestsea_publication_abonnement_routage ADD CONSTRAINT gestsea_publication_abonnement_routage_constraint6 FOREIGN KEY (publication_id) REFERENCES gestsea_publication(id);\\n';\n  proc:=proc||'  -- Data without triggers\\n';\n  proc:=proc||'  INSERT INTO base_acces VALUES (1, ''INVITE'', ''InvitÃ©'', 1000000);\\n';\n  proc:=proc||'  INSERT INTO base_acces VALUES (2, ''EXPERTCO'', ''Expert comptable'', 0);\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (1, ''DEFAUT'', ''Par dÃ©faut'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (2, ''DEVIS'', ''Devis'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (3, ''FACTURATION'', ''Facturation'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (4, ''LIVRAISON'', ''Livraison'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_contact_type VALUES (5, ''CONTACT'', ''Contact'', true, true, '''');\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom) VALUES (''Comptant Ã  rÃ©ception'');\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_mois) VALUES (''1 mois'', 1);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, fin_de_mois, defaut) VALUES (''Fin de mois'', true, true);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours) VALUES (''30 jours'', 30);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours) VALUES (''60 jours'', 60);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours) VALUES (''90 jours'', 90);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours, fin_de_mois) VALUES (''30 jours fin de mois'', 30, true);\\n';\n  proc:=proc||'  INSERT INTO base_delai(nom, nb_jours, fin_de_mois, prolongation, jour_du_mois) VALUES (''30 jours fin de mois le 10'', 30, true, true, 10);\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (1, ''DEVIS'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (2, ''FACTURE'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (3, ''AVOIR'');\\n';\n  proc:=proc||'  INSERT INTO base_impression_type VALUES (4, ''BALANCE'');\\n';\n  proc:=proc||'  INSERT INTO compta_exercice(code, date_debut, date_fin) VALUES (''EX200607'', ''01/09/2006'', ''31/08/2007'');\\n';\n  proc:=proc||'  INSERT INTO compta_journal_type VALUES (1, ''PURCHASES'', ''AC'', ''Journal des achats'', false, false, NULL, NULL);\\n';\n  proc:=proc||'  INSERT INTO compta_journal_type VALUES (2, ''SALES'', ''VT'', ''Journal des ventes'', false, false, NULL, NULL);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, acces_id) VALUES (6, ''Comptes de charges'', ''6'', NULL, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, acces_id) VALUES (7, ''Comptes de produits'', ''7'', NULL, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, general, parent_compteperm_id, acces_id) VALUES (60, ''Achats (sauf 603)'', ''60'', true, 6, 2);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, acces_id) VALUES (607, ''Achats de marchandises'', ''607'', 60, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general, acces_id) VALUES (70, ''Ventes de produits fabriquÃ©s, prestations de services, marchandises'', ''70'', 7, true, 2);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general, acces_id) VALUES (706, ''Prestations de services'', ''706'', 70, true, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general, acces_id) VALUES (709, ''Rabais, remises et ristournes accordÃ©s par l''''entreprise'', ''709'', 70, true, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, general, acces_id) VALUES (71, ''Production stockÃ©e (ou dÃ©stockage)'', ''71'', 7, true, 1);\\n';\n  proc:=proc||'  INSERT INTO compta_compteperm(id, nom, numero, parent_compteperm_id, acces_id) VALUES (713, ''Variation des stocks (en-cours de production, produits)'', ''713'', 71, 1);\\n';\n  proc:=proc||'  INSERT INTO gestion_produit_categorie(code, nom) VALUES (''GENERAL'', ''Tous les produits'');\\n';\n  proc:=proc||'  INSERT INTO gestion_lien_type VALUES (1, ''ADHESION'', ''Transmission d''''adhÃ©sion'', ''adhÃ¨re pour'', ''a pour adhÃ©rent'');\\n';\n  proc:=proc||'  INSERT INTO gestion_lien_type VALUES (2, ''MEMBRE'', ''Membre'', ''est membre de'', ''a pour membre'');\\n';\n  proc:=proc||'  INSERT INTO gestion_lien_type VALUES (3, ''EMPLOI'', ''Relations professionnelles'', ''travaille pour'', ''a pour employÃ©'');\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_commande_type(nom, validite_delai_id, paiement_delai_id) VALUES (''Standard'', 2, 1);\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode VALUES (1, ''0'', ''Pas de relances'', false);\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode VALUES (2, ''30-50-65'', ''Relances Ã  30, 50 et 65 jours'', true);\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode_etape VALUES (1, 1, 30, ''Message (30 jours)'');\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode_etape VALUES (2, 1, 50, ''Message (50 jours)'');\\n';\n  proc:=proc||'  INSERT INTO gestion_ventes_relance_mode_etape VALUES (3, 1, 65, ''Message (65 jours)'');\\n';\n  proc:=proc||'  INSERT INTO gestsea_juridique_dossier_etat VALUES (1, ''Ouvert'', '''');\\n';\n  proc:=proc||'  INSERT INTO gestsea_juridique_dossier_etat VALUES (2, ''CloturÃ©'', '''');\\n';\n  proc:=proc||'  INSERT INTO gestsea_juridique_dossier_etat VALUES (3, ''AbandonnÃ©'', '''');\\n';\n  proc:=proc||'  -- Procedures\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_rights() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  query     text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  employe   base_societe_employe%%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  module    base_droits_module%%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  profil    base_droits_profil%%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  droits    record;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  nb_priv   integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  tt_revoke integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  tt_grant  integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  reste_emp  integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  tt_revoke:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  tt_grant :=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''-- revoke all on all from all;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  FOR module IN SELECT * FROM base_droits_module LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    query:=''''REVOKE ALL ON ''''||module.objets||'''' FROM '''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    reste_emp:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FOR employe IN SELECT * FROM base_societe_employe AS emp WHERE emp.utilisateur_login IN (SELECT usename FROM pg_user) LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF reste_emp>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:=query||employe.utilisateur_login;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      reste_emp:=1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    tt_revoke:=tt_revoke+1;	\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''-- grant pro on pro to pro;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  FOR profil IN SELECT * FROM base_droits_profil LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FOR droits IN SELECT objets, COALESCE(selection,false) AS sel, COALESCE(insertion,false) AS ins, COALESCE(modification,false) AS mod, COALESCE(suppression,false) AS sup \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''                    FROM base_droits_profil_module LEFT JOIN base_droits_module ON (module_id=base_droits_module.id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''                    WHERE base_droits_profil_module.profil_id=profil.id LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:='''''''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      nb_priv:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF droits.sel THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||''''SELECT'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        nb_priv:=nb_priv+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF droits.ins THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF nb_priv>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||''''INSERT'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        nb_priv:=nb_priv+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF droits.mod THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF nb_priv>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||''''UPDATE'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        nb_priv:=nb_priv+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF droits.sup THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF nb_priv>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        query:=query||''''DELETE'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        nb_priv:=nb_priv+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:=''''GRANT ''''||query||'''' ON ''''||droits.objets||'''' TO '''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF nb_priv>0 AND query IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        reste_emp:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FOR employe IN SELECT * FROM base_societe_employe AS emp WHERE emp.profil_id=profil.id AND emp.utilisateur_login IN (SELECT usename FROM pg_user) LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          IF reste_emp>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''            query:=query||'''','''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          query:=query||employe.utilisateur_login;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          reste_emp:=1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        tt_grant :=tt_grant+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RAISE NOTICE ''''REVOKE %%, GRANT %%.'''',tt_revoke,tt_grant;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN New;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_societe_etablissement() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nui||'''' ''''||NEW.nic FROM base_societe WHERE id=NEW.societe_id INTO NEW.siret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_societe_employe() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT login FROM systeme_utilisateur WHERE id=NEW.utilisateur_id INTO NEW.utilisateur_login;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_partenaire() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.nom_soundex2 := soundex2(NEW.nom);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.nom_phonex   := phonex(NEW.nom);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT morale, titre FROM base_partenaire_type\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.type_id INTO NEW.morale, NEW.titre;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.libelle := SUBSTR(COALESCE(NEW.titre||'''' '''','''''''')||NEW.nom||COALESCE('''' ''''||NEW.prenom,''''''''),1,38);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_partenaire_type() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.morale!=OLD.morale OR NEW.titre!=OLD.titre THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      UPDATE base_partenaire SET titre=NEW.titre, morale=NEW.morale WHERE type_id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.civilites IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.civilites := NEW.titre;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_contact() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT codepostal_id, commune_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM base_codepostal_commune_rel \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.codepostal_commune_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.codepostal_id, NEW.commune_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT numero FROM base_codepostal WHERE id=NEW.codepostal_id INTO NEW.codepostal;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nom FROM base_commune WHERE id=NEW.commune_id INTO NEW.commune;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT UPPER(NEW.numero), UPPER(NEW.voie), UPPER(NEW.ligne5)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.numero,NEW.voie,NEW.ligne5;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NOT NEW.actif AND OLD.actif THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date_fin := ''''now''''::DATE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.actif := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_contact() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INSERT INTO base_partenaire_contact_version(contact_id) VALUES (NEW.id);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_contact_version() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Cette opÃ©ration est interdite. Une version ne peut Ãªtre supprimÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime_debut := OLD.datetime_debut;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.complement := OLD.complement;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.ligne3     := OLD.ligne3;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.numero     := OLD.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.voie       := OLD.voie;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.ligne5     := OLD.ligne5;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.codepostal_commune_id := OLD.codepostal_commune_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.codepostal_id := OLD.codepostal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.commune_id := OLD.commune_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.codepostal := OLD.codepostal;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.commune    := OLD.commune;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.telephone  := OLD.telephone;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.mobile     := OLD.mobile;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.fax        := OLD.fax;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.email      := OLD.email;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM base_partenaire_contact_version\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE contact_id=NEW.contact_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total=0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.datetime_debut := ''''-infinity''''::timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.datetime_debut := ''''now''''::timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE base_partenaire_contact_version SET datetime_fin=''''now''''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE datetime_fin>CURRENT_TIMESTAMP AND contact_id=NEW.contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime_fin := ''''infinity''''::timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT complement,ligne3,numero,voie,ligne5,codepostal_commune_id,codepostal_id,commune_id,codepostal,commune\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM base_partenaire_contact\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE id=NEW.contact_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO NEW.complement,NEW.ligne3,NEW.numero,NEW.voie,NEW.ligne5,NEW.codepostal_commune_id,NEW.codepostal_id, NEW.commune_id, NEW.codepostal, NEW.commune;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_contact_type() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (TG_OP=''''DELETE'''') THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''This type mustn''''''''t be removed.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN OLD;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.id := OLD.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.code := OLD.code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immuable := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;    \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_partenaire_attribut() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nom FROM base_partenaire_attribut_type WHERE id=NEW.type_id INTO NEW.type_nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nom FROM base_partenaire_attribut_categorie WHERE id=NEW.categorie_id INTO NEW.categorie_nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_get_delai_date(IN a_delai_id INTEGER,IN a_date DATE) RETURNS DATE AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_interval integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_delai base_delai%%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_ret date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT * FROM base_delai WHERE id=a_delai_id INTO p_delai;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_ret := a_date+(p_delai.nb_mois||'''' months'''')::interval;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_ret := a_date+p_delai.nb_jours;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_delai.fin_de_mois THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT fc_get_nb_jours_dans_mois(p_ret) INTO p_interval;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_ret := p_interval::text||''''/''''||EXTRACT(MONTH FROM p_ret)||''''/''''||EXTRACT(YEAR FROM p_ret)::text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF p_delai.prolongation THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT fc_get_nb_jours_dans_mois(p_ret+1) INTO p_interval;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      p_ret := p_ret + CASE WHEN p_delai.jour_du_mois>p_interval THEN p_interval ELSE p_delai.jour_du_mois END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN p_ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_impression_modele() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE base_impression_modele SET datetime_fin=''''now'''' WHERE datetime_fin=''''infinity'''' AND impression_id=NEW.impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime_debut := ''''now'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime_fin   := ''''infinity'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.impression_id!=OLD.impression_id THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.impression_id:=OLD.impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.modele!=OLD.modele THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO base_impression_modele (impression_id,modele) SELECT NEW.impression_id, NEW.modele;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.modele := OLD.modele;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_impression() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO base_impression_modele (impression_id,modele) SELECT NEW.id, NEW.modele;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.modele!=OLD.modele THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO base_impression_modele (impression_id,modele) SELECT NEW.id, NEW.modele;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_impression_type() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''This type mustn''''''''t be removed.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_get_impression_modele_id(IN a_impression_id INTEGER,IN a_modele_id INTEGER) RETURNS INTEGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ret base_impression_modele.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_modele_id base_impression_modele.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF a_impression_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''La vÃ©rification du modÃ¨le de l''''''''impression n''''''''est pas possible car l''''''''impression Ã  vÃ©rifier est inconnue.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_modele_id := a_modele_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_modele_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_impression_modele WHERE id=p_modele_id AND impression_id=a_impression_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      p_modele_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ret := p_modele_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_modele_id IS NULL THEN     \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_impression_modele WHERE impression_id=a_impression_id AND datetime_fin=''''infinity'''' INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Il n''''''''y a pas de modÃ¨le d''''''''impressions en service pour ce type de document.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF total>1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Erreur du systÃ¨me : Plusieurs modÃ¨les sont en service pour l''''''''impression %%'''',a_impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_impression_modele WHERE impression_id=a_impression_id AND datetime_fin=''''infinity'''' INTO ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_get_impression_id(IN a_impression_id INTEGER,IN a_type_id INTEGER) RETURNS INTEGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_impression_id base_impression.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ret base_impression.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF a_type_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''La vÃ©rification de l''''''''impression n''''''''est pas possible car le type d''''''''impression est inconnu.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_impression_id := a_impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_impression_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_impression WHERE id=p_impression_id AND type_id=a_type_id AND actif INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      p_impression_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ret := p_impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_impression_id IS NULL THEN     \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_impression WHERE type_id=a_type_id AND actif INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Il n''''''''y a pas d''''''''impressions en service pour ce type de document.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_impression WHERE type_id=a_type_id AND actif ORDER BY defaut DESC INTO ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_build_printer() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  pfb_modele text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  print_code text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  query text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM information_schema.routines WHERE routine_schema=pfb_schema AND routine_name=''''prPDF_''''||NEW.code INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (total>=1) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    query:=''''DROP FUNCTION ''''||pfb_schema||''''.prPDF_''''||print_code||''''(integer);'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (TG_OP!=''''DELETE'''') THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT fc_build_printer(pfb_schema,NEW.modele,''''prPDF_''''||NEW.code,''''/tmp'''');\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_ecriture() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (NEW.debit_d>0 AND NEW.credit_d>0) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Le dÃ©bit ou le crÃ©dit doit Ãªtre Ã  0.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (NEW.compteperm IS NULL) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Le compte (permanent) de l''''''''Ã©criture doit Ãªtre renseignÃ©.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.devis_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_devise WHERE defaut INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Une seule et unique devise doit Ãªtre dÃ©finie par dÃ©faut.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_devise WHERE defaut INTO NEW.devise_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT taux FROM base_devise WHERE id=NEW.devise_id INTO NEW.devise_taux;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.debit_d-NEW.credit_d INTO NEW.solde_d;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.debit_d*NEW.devise_taux INTO NEW.debit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.credit_d*NEW.devise_taux INTO NEW.credit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.debit-NEW.credit INTO NEW.solde;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT numero, compteperm_id, fc_get_compte(compteperm_id) FROM compta_compteperm WHERE id=NEW.compteperm_id INTO NEW.compte_numero, NEW.compteperm_id, NEW.compte_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT date, journal_id FROM compta_piece WHERE id=NEW.piece_id INTO NEW.piece_date, NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT code FROM compta_journal WHERE id=NEW.journal_id INTO NEW.journal_code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM compta_compte_cumul WHERE mois=EXTRACT(MONTH FROM NEW.piece_date)::integer AND annee=EXTRACT(YEAR FROM NEW.piece_date)::integer AND compteperm_id=NEW.compteperm_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO compta_compte_cumul(compteperm_id,mois,annee) SELECT NEW.compteperm_id, EXTRACT(MONTH FROM NEW.piece_date)::integer, EXTRACT(YEAR FROM NEW.piece_date)::integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF total>1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Un seul cumul par mois et par compte peut Ãªtre crÃ©Ã©.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM compta_compte_cumul WHERE mois=EXTRACT(MONTH FROM NEW.piece_date)::integer AND annee=EXTRACT(YEAR FROM NEW.piece_date)::integer AND compteperm_id=NEW.compteperm_id INTO NEW.cumul_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_compta_ecriture() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE compta_piece SET debit=sum(ecr.debit), credit=sum(ecr.credit) FROM compta_ecriture as ecr WHERE compta_piece.id=piece_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE compta_pointage SET debit=sum(ecr.debit), credit=sum(ecr.credit), nb_ecritures=count(ecr.id) FROM compta_ecriture as ecr WHERE compta_pointage.id=pointage_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE compta_compte SET debit=sum(ecr.debit), credit=sum(ecr.credit), nb_ecritures=count(ecr.id) FROM compta_ecriture as ecr WHERE compta_compte.id=compte_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE compta_compte_cumul SET debit=sum(ecr.debit), credit=sum(ecr.credit), nb_ecritures=count(ecr.id) FROM compta_ecriture as ecr WHERE compta_compte_cumul.id=cumul_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_piece() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.debit:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.credit:=0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM compta_exercice WHERE actif AND NOT cloture INTO total; \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Il n''''''''y a pas un seul et unique exercice actif.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.exercice_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT id FROM compta_exercice WHERE actif AND NOT cloture INTO NEW.exercice_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT cloture FROM compta_exercice WHERE id=NEW.exercice_id INTO ok; \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''L''''''''exercice comptable choisi est dÃ©jÃ  clotÃ»rÃ©. Vous ne pouvez pas rajouter des piÃ¨ces.''''; \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (NEW.date IS NULL) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''La piÃ¨ce doit Ãªtre datÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT code FROM compta_exercice WHERE id=NEW.exercice_id INTO NEW.exercice_code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT NEW.debit-NEW.credit INTO NEW.solde;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM compta_journal WHERE mois=EXTRACT(MONTH FROM NEW.date)::integer AND annee=EXTRACT(YEAR FROM NEW.date)::integer AND type_id=NEW.journal_type_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO compta_journal(type_id,mois,annee) SELECT NEW.journal_type_id, EXTRACT(MONTH FROM NEW.date)::integer, EXTRACT(YEAR FROM NEW.date)::integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF total>1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Un seul journal par mois et par type doit Ãªtre ouvert.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT id FROM compta_journal WHERE mois=EXTRACT(MONTH FROM NEW.date)::integer AND annee=EXTRACT(YEAR FROM NEW.date)::integer AND type_id=NEW.journal_type_id INTO NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT COALESCE(MAX(numero),0)+1 FROM compta_piece WHERE journal_id=NEW.journal_id INTO NEW.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_compta_piece() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_journal  SET debit=debit+NEW.debit, credit=credit+NEW.credit WHERE id=NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_exercice SET debit=debit+NEW.debit, credit=credit+NEW.credit, nb_ecritures=nb_ecritures+1 WHERE id=NEW.exercice_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_journal  SET debit=debit+NEW.debit-OLD.debit, credit=credit+NEW.credit-OLD.credit WHERE id=NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_exercice SET debit=debit+NEW.debit-OLD.debit, credit=credit+NEW.credit-OLD.credit WHERE id=NEW.exercice_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_journal  SET debit=debit-OLD.debit, credit=credit-OLD.credit WHERE id=NEW.journal_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE compta_exercice SET debit=debit-OLD.debit, credit=credit-OLD.credit, nb_ecritures=nb_ecritures-1 WHERE id=NEW.exercice_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_standard() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.debit  := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.credit := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.nb_ecritures := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.solde := NEW.debit-NEW.credit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_journal() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.debit  := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.credit := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT debit_compteperm_id, provisoire, contrepartie, code||NEW.annee||to_char(NEW.mois,''''FM09''''), nom||'''' (''''||to_char(NEW.mois,''''FM09'''')||''''/''''||NEW.annee||'''')'''' FROM compta_journal_type WHERE id=NEW.type_id INTO NEW.debit_compteperm_id, NEW.provisoire, NEW.contrepartie, NEW.code, NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.solde := NEW.debit-NEW.credit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compta_compte() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  parent_numero text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.debit  := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.credit := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.nb_ecritures    := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.derniere_lettre := '''''''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT parent.numero FROM compta_compteperm AS fils LEFT JOIN compta_compteperm AS parent ON (parent.id=fils.parent_compteperm_id) WHERE fils.id=NEW.compteperm_id INTO parent_numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF LENGTH(COALESCE(parent_numero,''''''''))!=0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT count(*) FROM compta_compte WHERE numero=parent_numero INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        INSERT INTO compta_compte(compteperm_id, exercice_id) SELECT parent_compteperm_id, NEW.exercice_id FROM compta_compteperm WHERE id=NEW.compteperm_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT nom,numero,acces_id,immuable,signe,general,accept_aux,utilisable,lettrable,pointable,groupable,echeance,note FROM compta_compteperm WHERE id=NEW.compteperm_id INTO NEW.nom,NEW.numero,NEW.acces_id,NEW.immuable,NEW.signe,NEW.general,NEW.accept_aux,NEW.utilisable,NEW.lettrable,NEW.pointable,NEW.groupable,NEW.echeance,NEW.note;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM compta_compte WHERE numero=parent_numero INTO NEW.parent_compte_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.numero:=OLD.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immuable := TRUE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT OLD.nom,OLD.numero,OLD.acces_id,OLD.immuable,OLD.signe,OLD.general,OLD.accept_aux,OLD.utilisable,OLD.lettrable,OLD.pointable,OLD.groupable,OLD.echeance INTO NEW.nom,NEW.numero,NEW.acces_id,NEW.immuable,NEW.signe,NEW.general,NEW.accept_aux,NEW.utilisable,NEW.lettrable,NEW.pointable,NEW.groupable,NEW.echeance;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.solde := NEW.debit-NEW.credit;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_compte_cumul() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.compteperm_id := OLD.compteperm_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT numero, nom||'''' (''''||NEW.mois||''''/''''||NEW.annee||'''')'''' FROM compta_compteperm WHERE id=NEW.compteperm_id INTO NEW.numero, NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_nextval(IN a_sequence_code CHARACTER VARYING(16)) RETURNS INTEGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  number gestion_sequence.dernier_numero%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  cle integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  indice_jour integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  indice_mois integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  indice_annee integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  datetime timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  seq gestion_sequence%%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT CURRENT_TIMESTAMP INTO datetime;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT * FROM gestion_sequence WHERE code=a_sequence_code FOR UPDATE INTO seq;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT EXTRACT(YEAR FROM datetime) INTO indice_jour, indice_mois, indice_annee;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE gestion_sequence SET jour=seq.jour,mois=seq.mois,annee=seq.annee WHERE code=seq.code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nextval(seq.sequence) INTO cle;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT COALESCE(TO_CHAR(CURRENT_TIMESTAMP, seq.prefixe),'''''''')||COALESCE(TO_CHAR(cle, seq.corps),'''''''')||COALESCE(TO_CHAR(CURRENT_TIMESTAMP, seq.suffixe),'''''''') INTO number;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN number;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_sequence() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  query text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' OR TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT TO_CHAR(CURRENT_TIMESTAMP,NEW.prefixe) INTO query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT TO_CHAR(4,NEW.corps) INTO query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT TO_CHAR(CURRENT_TIMESTAMP,NEW.suffixe) INTO query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.sequence:=LOWER(''''gestion_sequences_''''||NEW.code||round(99*random())||''''_seq'''');\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    query:=''''CREATE SEQUENCE ''''||NEW.sequence||'''' INCREMENT BY 1 START WITH ''''||NEW.start;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    return NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immuable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immuable := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.code     := OLD.code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.sequence := OLD.sequence;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.start!=OLD.start THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:=''''ALTER SEQUENCE ''''||NEW.sequence||'''' RESTART WITH ''''||NEW.start;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF (NEW.quotidienne AND OLD.jour!=NEW.jour) OR (NEW.mensuelle AND OLD.mois!=NEW.mois) OR (NEW.annuelle AND OLD.annee!=NEW.annee) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      query:=''''ALTER SEQUENCE ''''||NEW.sequence||'''' RESTART WITH 0'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    query:=''''DROP SEQUENCE ''''||NEW.sequence;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    EXECUTE query;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    return OLD;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_produit_taxe() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.code:=OLD.code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.taux!=NEW.taux OR OLD.montant!=NEW.montant OR OLD.compteperm_id!=NEW.compteperm_id THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Une taxe ne peut pas Ãªtre mise Ã  jour. Il est seulement possible d''''''''en ajouter ou d''''''''en supprimer.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_produit_prix_taxe_rel() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_prix_id gestion_produit_prix.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_montant_ht gestion_produit_prix.montant_ht%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_montant_taxes gestion_produit_prix.montant_ht%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' OR TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_prix_id := NEW.prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_prix_id := OLD.prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT montant_ht FROM gestion_produit_prix WHERE id=p_prix_id INTO p_montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT ROUND(COALESCE(SUM(rel.base_montant+taxe.taux*p_montant_ht+taxe.montant),0),2)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_produit_prix_taxe_rel AS rel \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         JOIN gestion_produit_taxe AS taxe ON (taxe_id=taxe.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE rel.prix_id=p_prix_id INTO p_montant_taxes;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE gestion_produit_prix SET montant_ttc=p_montant_ht+p_montant_taxes WHERE id=p_prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_produit_prix() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_prix_id gestion_produit_prix.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_ttc := NEW.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM gestion_produit_prix \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE date_fin IN (SELECT max(date_fin) FROM gestion_produit_prix WHERE produit_id=NEW.produit_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO p_prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestion_produit_prix_taxe_rel (prix_id, taxe_id, base_montant)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT prix_id, taxe_id, base_montant\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_produit_prix_taxe_rel WHERE prix_id=p_prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.produit_id    := OLD.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.achat         := OLD.achat;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.partenaire_id := OLD.partenaire_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_ht    := OLD.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.date_debut    := OLD.date_debut;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.date_fin>NEW.date_fin THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date_fin := OLD.date_fin;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.date_debut>OLD.date_debut THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date_debut := OLD.date_debut;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT code||'''' ''''||TRIM(nom)||'''' / ''''||NEW.montant_ttc||'''' TTC / ''''||NEW.montant_ht||'''' HT''''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_produit\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.produit_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.libelle;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_get_reduction_rate(IN a_partenaire_id INTEGER,IN a_date DATE) RETURNS NUMERIC(16,8) AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_periode_id gestion_adhesion_periode.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_ret gestion_reduction.taux%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_adhesion \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE periode_date_fin>=a_date AND a_date>=periode_date_debut AND partenaire_id=a_partenaire_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ORDER BY periode_date_fin DESC\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INTO p_periode_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT COALESCE(MAX(reduc.taux),0.00)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_adhesion AS adhesion \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         JOIN gestion_reduction AS reduc ON (reduc.id=reduction_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE periode_id=p_periode_id AND partenaire_id=a_partenaire_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INTO p_ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF p_ret IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_ret := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN p_ret;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_lien() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_role_type_id gestion_lien_type.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT type_id FROM gestion_lien_role WHERE id=NEW.role_id INTO p_role_type_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.type_id!=p_role_type_id THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Le rÃ´le et le type de lien doivent Ãªtre en adÃ©quation.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT p1.libelle||'''' ''''||t.phrase_directe||'''' ''''||p2.libelle||r.prefixe||r.nom||r.suffixe\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM base_partenaire AS p1,\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         base_partenaire AS p2,\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''	 gestion_lien_type AS t,\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''	 gestion_lien_role AS r\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE p1.id=NEW.partenaire1_id AND p2.id=NEW.partenaire2_id AND t.id=NEW.type_id AND r.id=NEW.role_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.libelle;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_lien_role() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT ''''[''''||type.code||''''] ''''||NEW.nom FROM gestion_lien_type AS type WHERE id=NEW.type_id INTO NEW.nom_etendu;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_adhesion() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT nom, facture_id, COALESCE(NEW.partenaire_id,partenaire_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_ventes_facture_ligne JOIN gestion_ventes_facture AS facture ON (facture_id=facture.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.facture_ligne_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.produit_nom, NEW.facture_id, NEW.partenaire_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT date_debut, date_fin \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_adhesion_periode \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.periode_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.periode_date_debut, NEW.periode_date_fin;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT type_nom\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_adhesion_type\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.type_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.type_nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM gestion_adhesion_transmission WHERE adhesion_type_id=NEW.type_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF total>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestion_adhesion (partenaire_id,facture_ligne_id,periode_id,type_id,reduction_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT lien.pid,NEW.facture_ligne_id,NEW.periode_id,NEW.type_id,NEW.reduction_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM (SELECT CASE WHEN sens_inverse THEN partenaire1_id ELSE partenaire2_id END AS pid\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''                FROM gestion_lien JOIN gestion_adhesion_transmission ON (type_id=lien_type_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''                WHERE adhesion_type_id=NEW.type_id AND (CASE WHEN sens_inverse THEN partenaire2_id ELSE partenaire1_id END)=NEW.partenaire_id) AS lien;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_commande() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  default_contact_id base_partenaire_contact.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  contact_id base_partenaire_contact.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_montant_ttc gestion_ventes_commande.montant_ttc%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_montant_ht  gestion_ventes_commande.montant_ht%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' OR TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immodifiable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Une commande passÃ©e en facture est verrouillÃ©e et ne peut Ãªtre modifiÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.partenaire_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Une commande doit Ãªtre faite pour une personne/sociÃ©tÃ© donnÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.employe_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_societe_employe WHERE utilisateur_login=CURRENT_USER INTO NEW.employe_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.type_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM gestion_ventes_commande_type WHERE defaut AND actif INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT id FROM gestion_ventes_commande_type WHERE defaut AND actif INTO NEW.type_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Aucun type n''''''''a Ã©tÃ© spÃ©cifiÃ©.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT COALESCE(SUM(lig.montant_ttc),0), COALESCE(SUM(lig.montant_ht),0) FROM gestion_ventes_commande_ligne AS lig WHERE lig.commande_id=NEW.id INTO NEW.montant_ttc, NEW.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT rolsuper FROM pg_authid WHERE rolname=current_user INTO ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF (NEW.commande_contact_id IS NULL OR NEW.facture_contact_id IS NULL OR NEW.livraison_contact_id IS NULL) THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    default_contact_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''Pour rÃ©aliser une commande le client doit avoir au moins une adresse.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF total=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id INTO default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.commande_contact_id  := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.facture_contact_id   := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.livraison_contact_id := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id ORDER BY type_id INTO default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NEW.commande_contact_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT count(*) FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=2 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          NEW.commande_contact_id := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=2 INTO NEW.commande_contact_id;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NEW.facture_contact_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT count(*) FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=3 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          NEW.facture_contact_id := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=3 INTO NEW.facture_contact_id;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NEW.livraison_contact_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT count(*) FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=4 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          NEW.livraison_contact_id := default_contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT id FROM base_partenaire_contact WHERE partenaire_id=NEW.partenaire_id AND type_id=4 INTO NEW.livraison_contact_id;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_current_contact_version(NEW.commande_contact_id) INTO NEW.commande_version_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_impression_id(NEW.impression_id,1) INTO NEW.impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_impression_modele_id(NEW.impression_id, NEW.modele_id) INTO NEW.modele_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT validite_delai_id, avec_signature, fc_get_delai_date(validite_delai_id,NEW.date)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_ventes_commande_type\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.type_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.validite_delai_id, NEW.avec_signature, NEW.validite_date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_reduction_rate(NEW.partenaire_id, NEW.date) INTO NEW.reduction_taux;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.numero IS NULL OR NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT fc_nextval(''''COMMANDE'''') INTO NEW.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_commande_ligne() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  commande_date gestion_ventes_commande.date%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  commande_reduction gestion_ventes_commande.reduction_taux%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  sans_stock boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' OR TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immodifiable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''Une ligne d''''''''une commande passÃ©e en facture est immodifiable et ineffaÃ§able.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immodifiable     := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.nom               := OLD.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.commande_id        := OLD.commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.produit_id         := OLD.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.prix_id             := OLD.prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_id            := OLD.stock_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_mouvement_id   := OLD.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.reduction            := OLD.reduction;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_unitaire_ttc := OLD.montant_unitaire_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_unitaire_ht  := OLD.montant_unitaire_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.quantite            := OLD.quantite;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_brut_ttc    := OLD.montant_brut_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_brut_ht    := OLD.montant_brut_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ttc        := OLD.montant_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ht        := OLD.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.description      := OLD.description;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.inclus    := FALSE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.inclus AND NOT NEW.a_inclure THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.inclus  := FALSE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' OR TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.prix_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Il faut spÃ©cifier quel produit/prix vous voulez utiliser.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT montant_ht, montant_ttc, produit_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestion_produit_prix \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE id=NEW.prix_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO NEW.montant_unitaire_ht, NEW.montant_unitaire_ttc, NEW.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT date, reduction FROM gestion_ventes_commande WHERE id=NEW.commande_id INTO commande_date, commande_reduction;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT nom, reduction, sans_stock FROM gestion_produit WHERE id=NEW.produit_id INTO NEW.nom, NEW.reduction, sans_stock;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM gestion_produit WHERE id=NEW.produit_id  AND COALESCE(date_fin,''''31/12/9999'''')>=commande_date AND commande_date>=date_debut INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Le produit ''''''''%%'''''''' n''''''''est pas en service au moment de l''''''''Ã©tablissement du commande.'''',NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF sans_stock THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_mouvement_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT count(*) FROM gestion_stock WHERE id=NEW.stock_id AND produit_id=NEW.produit_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        NEW.stock_id := NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF NEW.stock_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT count(*) FROM gestion_stock WHERE produit_id=NEW.produit_id AND actif INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          RAISE EXCEPTION ''''Le produit ''''''''%%'''''''' qui est dÃ©clarÃ© comme possÃ©dant un stock, n''''''''en possÃ¨de pas en rÃ©alitÃ©.'''',NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT id FROM gestion_stock WHERE produit_id=NEW.produit_id AND actif ORDER BY defaut DESC INTO NEW.stock_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=NEW.quantite THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''La quantitÃ© du produit doit Ãªtre supÃ©rieure ou Ã©gale Ã  1.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_brut_ht  := NEW.quantite*NEW.montant_unitaire_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_brut_ttc := NEW.quantite*NEW.montant_unitaire_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NOT NEW.reduction THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      commande_reduction := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_ht  := NEW.montant_brut_ht*(1-commande_reduction);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.montant_ttc := NEW.montant_brut_ttc*(1-commande_reduction);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN OLD;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_ventes_commande_ligne() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_id gestion_ventes_commande.date%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.stock_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT nextval(''''gestion_stock_mouvement_id_seq'''') INTO NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO gestion_stock_mouvement (id,stock_id,quantite,virtuel,date) SELECT NEW.stock_mouvement_id, NEW.stock_id, -NEW.quantite, true, ''''now''''::date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.stock_id IS NULL AND OLD.stock_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      DELETE FROM gestion_stock_mouvement WHERE id=NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF NEW.stock_id IS NOT NULL AND OLD.stock_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      UPDATE gestion_stock_mouvement SET stock_id=NEW.stock_id, quantite=-NEW.quantite, virtuel=true, date=''''now''''::date WHERE id=NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSIF NEW.stock_id IS NOT NULL AND OLD.stock_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT nextval(''''gestion_stock_mouvement_id_seq'''') INTO NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO gestion_stock_mouvement (id,stock_id,quantite,virtuel,date) SELECT NEW.stock_mouvement_id, NEW.stock_id, -NEW.quantite, true, ''''now''''::date;      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.stock_id IS NOT NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      DELETE FROM gestion_stock_mouvement WHERE id=NEW.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;    \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_commande_id := OLD.commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_commande_id := NEW.commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  UPDATE gestion_ventes_commande SET montant_ttc=COALESCE(SUM(lig.montant_ttc),0), montant_ht=COALESCE(SUM(lig.montant_ht),0) FROM gestion_ventes_commande_ligne AS lig WHERE id=p_commande_id AND lig.commande_id=p_commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_facture() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_piece_id compta_piece.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_piece_libelle compta_piece.libelle%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_piece_journal_type_id compta_piece.journal_type_id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_abrev text;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' OR TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immodifiable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''Une facture ne peut pas Ãªtre supprimÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immodifiable   := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.commande_id    := OLD.commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.employe_id     := OLD.employe_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.partenaire_id  := OLD.partenaire_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.numero         := OLD.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date           := OLD.date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.reduction_taux := OLD.reduction_taux;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ttc    := OLD.montant_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ht     := OLD.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' OR TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.commande_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Vous devez obligatoirement utiliser une commande pour crÃ©er une facture.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT avec_bons_livraison FROM gestion_ventes_commande WHERE id=NEW.commande_id INTO ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''La gestion des bons de livraison n''''''''est pas encore implÃ©mentÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT fc_get_impression_id(NEW.impression_id,2) INTO NEW.impression_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT fc_get_impression_modele_id(NEW.impression_id, NEW.modele_id) INTO NEW.modele_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.date IS NULL OR NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.date := ''''now''''::date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT partenaire_id,employe_id,reduction_taux, objet, civilites, montant_ht, montant_ttc, fc_get_current_contact_version(facture_contact_id), fc_get_current_contact_version(livraison_contact_id),paiement_delai_id, fc_get_delai_date(paiement_delai_id,NEW.date)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestion_ventes_commande AS com\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''           JOIN gestion_ventes_commande_type AS type ON (type_id=type.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE com.id=NEW.commande_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INTO NEW.partenaire_id, NEW.employe_id, NEW.reduction_taux, NEW.objet, NEW.civilites, NEW.montant_ht, NEW.montant_ttc, NEW.facture_version_id, NEW.livraison_version_id,NEW.paiement_delai_id,NEW.paiement_date;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    /* Piece */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''/*\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT nextval(''''compta_piece_id_seq'''') INTO p_piece_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT id, abrev FROM compta_journal_type WHERE code=''''SALES'''' INTO p_piece_journal_type_id, p_abrev;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF p_piece_journal_type_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Un seul et unique journal de ventes (SALES) doit exister pour faire des factures.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_piece_libelle :=''''[''''||COALESCE(p_abrev,'''''''')||''''][''''||NEW.partenaire_id||''''] ''''''''''''||COALESCE(NEW.objet,'''''''')||'''''''''''''''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO compta_piece(id,libelle,date,echeance,journal_type_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      VALUES (p_piece_id,p_piece_libelle,NEW.date,NEW.delai_date,p_piece_journal_type_id);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.piece_id  := p_piece_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''*/\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT rolsuper FROM pg_authid WHERE rolname=current_user INTO ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NEW.numero IS NULL OR NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT fc_nextval(''''FACTURE'''') INTO NEW.numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_ventes_facture() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Lignes (Ecritures, Adhesion...) */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INSERT INTO gestion_ventes_facture_ligne (facture_id, commande_ligne_id)  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT NEW.id, ligne.id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestion_ventes_commande_ligne AS ligne \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE ligne.a_inclure AND NOT ligne.inclus;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Ligne TVA\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INSERT INTO compta_ecriture (libelle,debit_d,credit_d,compte_id,piece_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT taxe.nom, 0, SUM(fc_get_taxe_montant(ligne.montant_ht,taxe.id)), fc_get_compte(taxe.compteperm_id), NEW.piece_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestion_ventes_facture_ligne AS ligne LEFT JOIN gestion_produit_taxe_rel AS rel USING (produit_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''           LEFT JOIN gestion_produit_taxe AS taxe ON (taxe.id=taxe_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE taxe.actif GROUP BY taxe.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Ligne Contrepartie\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  INSERT INTO compta_ecriture (libelle,debit_d,credit_d,compte_id,piece_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT partenaire.id||'''' ''''||partenaire.nom, NEW.montant_ttc, 0, fc_get_compte(partenaire.compteperm_id), NEW.piece_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM base_partenaire LEFT JOIN compta_compteperm_partenaire_rel ON (partenaire.id=partenaire_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE partenaire.id = NEW.partenaire_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_facture_ligne() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_facture_reduction gestion_ventes_facture.reduction_taux%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_piece_id compta_piece.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_compteperm_id compta_compteperm.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_facture_date gestion_ventes_facture.date%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  sans_stock boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_avec_bons_livraison boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_id integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' OR TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.immodifiable THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        RAISE EXCEPTION ''''Une ligne de facture ne peut pas Ãªtre supprimÃ©e.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.immodifiable         := true;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.nom                  := OLD.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.ecriture_id          := OLD.ecriture_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.commande_ligne_id    := OLD.commande_ligne_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.facture_id           := OLD.facture_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.produit_id           := OLD.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.prix_id              := OLD.prix_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_id             := OLD.stock_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.stock_mouvement_id   := OLD.stock_mouvement_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.reduction            := OLD.reduction;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_unitaire_ttc := OLD.montant_unitaire_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_unitaire_ht  := OLD.montant_unitaire_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.quantite             := OLD.quantite;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_brut_ttc     := OLD.montant_brut_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_brut_ht      := OLD.montant_brut_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ttc          := OLD.montant_ttc;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.montant_ht           := OLD.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      NEW.description          := OLD.description;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    /* Affectation des principales valeurs */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT produit_id,prix_id,stock_mouvement_id,reduction, description, commande_id FROM gestion_ventes_commande_ligne WHERE id=NEW.commande_ligne_id INTO NEW.produit_id, NEW.prix_id, NEW.stock_mouvement_id, NEW.reduction, NEW.description, p_commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT avec_bons_livraison FROM gestion_ventes_commande WHERE id=p_commande_id INTO p_avec_bons_livraison;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT date, reduction, piece_id FROM gestion_ventes_facture WHERE id=NEW.facture_id INTO p_facture_date, p_facture_reduction, p_piece_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF p_avec_bons_livraison THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Les bons de livraisons ne sont pas encore gÃ©rÃ©s.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      /* Recup des montants tel que (sans bons de livraisons) */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT quantite, montant_unitaire_ttc, montant_unitaire_ht, montant_brut_ttc, montant_brut_ht, montant_ttc, montant_ht \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_ventes_commande_ligne \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        INTO NEW.quantite, NEW.montant_unitaire_ttc, NEW.montant_unitaire_ht, NEW.montant_brut_ttc, NEW.montant_brut_ht, NEW.montant_ttc, NEW.montant_ht;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    /* Ecriture */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM gestion_produit_compteperm_rel WHERE produit_id=NEW.produit_id AND date_fin>=p_facture_date AND p_facture_date>=date_debut INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      RAISE EXCEPTION ''''Le produit %% n''''''''est pas rattachÃ© Ã  un compte comptable au moment de l''''''''Ã©tablissmeent de la facture.'''',NEW.nom;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT compteperm_id FROM gestion_produit_compteperm_rel WHERE produit_id=NEW.produit_id AND date_fin>=p_facture_date AND p_facture_date>=date_debut INTO p_compteperm_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO compta_ecriture(libelle,debit_d,credit_d,compte_id,piece_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      VALUES (NEW.nom, 0, NEW.montant_ht, fc_get_compte(p_compteperm_id), p_piece_id);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    /* Adhesion */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestion_adhesion (facture_ligne_id,periode_id,type_id,reduction_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT NEW.id, periode.id, atype.id, atype.reduction_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_type_produit_rel AS tprel\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_adhesion_type AS atype ON (adhesion_type_id=atype.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_adhesion_periode_rel AS rel ON (atype.id=rel.type_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_adhesion_periode AS periode ON (periode.id=rel.periode_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE produit_id=NEW.produit_id AND periode.date_fin>=p_facture_date AND p_facture_date>=periode.date_debut;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_ventes_relance() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.dateheure:=OLD.dateheure;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.datetime := ''''now''''::timestamp;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestion_ventes_relance_lettre (relance_id,etape_id,echeance_id,partenaire_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT NEW.id, etape.id, echeance.id, echeance.partenaire_id \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_ventes_facture_reglement_echeance AS echeance\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_ventes_relance_mode_etape AS etape USING (relance_mode_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE ''''now''''::date-echeance.date>=0 AND NOT echeance.id||''''X''''||etape.id IN (SELECT echeance_id||''''X''''||etape_id FROM gestion_ventes_relance_lettre);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION fc_traite_lot(IN a_lot_numero INTEGER) RETURNS INTEGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_societe_id base_societe.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_commande_id gestion_ventes_commande.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_facture_id gestion_ventes_facture.id%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  l record;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  cotis gestsea_cotisation%%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  cotis_ligne gestsea_cotisation_ligne%%ROWTYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Verifications  (du parametrage et des produits Ã  faire!)*/\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM gestsea_cotisation_parametrage INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF total!=1 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Le paramÃ¨trage des cotisations est incorrect (nb_enreg!=1).'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*) FROM gestsea_cotisation_lot WHERE numero=a_lot_numero AND NOT en_facture INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RETURN 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  FOR l IN SELECT lot.id AS lid, cot.* FROM gestsea_cotisation_lot AS lot JOIN gestsea_cotisation AS cot ON (cot.id=cotisation_id) WHERE lot.numero=a_lot_numero AND NOT en_facture LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    ok:=TRUE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) FROM base_partenaire WHERE id=l.partenaire_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ok:=FALSE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      UPDATE gestsea_cotisation_lot SET facturable=FALSE, erreur_message=''''Le partenaire n''''''''existe pas.'''' WHERE id=l.lid;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  /* Facturation */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total := 0;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT societe_id FROM base_societe_utilisateur_rel WHERE utilisateur_login=CURRENT_USER INTO p_societe_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  FOR l IN SELECT cotisation_id AS cid FROM gestsea_cotisation_lot WHERE lot.numero=a_lot_numero AND NOT en_facture AND facturable LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT count(*) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      FROM gestsea_cotisation_ligne AS lig JOIN gestsea_cotisation_produit AS prod ON (produit_id=prod.id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      WHERE cotisation_id=l.cid AND societe_id=p_societe_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    SELECT avec_defaut_produit FROM gestsea_cotisation_parametrage INTO ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF ok OR total>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT * FROM gestsea_cotisation WHERE id=l.cid INTO cotis;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT nextval(''''gestion_ventes_commande_id_seq'''') INTO p_commande_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO gestion_ventes_commande(id,date,partenaire_id,objet)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        SELECT p_commande_id,CURRENT_DATE, cotis.partenaire_id, ''''[''''||to_char(cotis.id,''''FM099999'''')||''''] ''''||facture_objet||'''' (''''||EXTRACT(YEAR FROM CURRENT_DATE)||'''')''''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          FROM gestsea_cotisation_parametrage;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF total>0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FOR cotis_ligne IN SELECT * FROM gestsea_cotisation_ligne WHERE cotisation_id=l.cid LOOP\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          INSERT INTO gestion_ventes_commande_ligne(commande_id,produit_id,quantite)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''            SELECT p_commande_id,produit.id,cotis_ligne.quantite\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''              FROM gestion_produit AS produit \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''              WHERE produit.code=cotis_ligne.produit_code;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        INSERT INTO gestion_ventes_commande_ligne(commande_id,produit_id,quantite)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          SELECT p_commande_id,produit.id,cotis_ligne.quantite\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''            FROM gestsea_cotisation_parametrage JOIN gestion_produit AS produit ON (produit.code=defaut_produit_code);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      /* Passage en facturation */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT nextval(''''gestion_ventes_facture_id_seq'''') INTO p_facture_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      INSERT INTO gestion_ventes_facture (id,commande_id) VALUES (p_facture_id,p_commande_id);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      /* Reglement ??? */\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      /* Cotisation enregistrÃ©e */      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      UPDATE gestsea_cotisation_lot SET commande_id=p_commande_id,facture_id=p_facture_id WHERE cotisation_id=l.cid;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE gestsea_cotisation_lot SET en_facture=TRUE WHERE cotisation_id=l.cid;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    total := total+1;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END LOOP;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_structure() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_length integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT MAX(LENGTH(RTRIM(code,''''#''''))) FROM gestsea_structure WHERE parent_id=NEW.parent_id AND id!=NEW.id INTO p_length;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  NEW.code:=UPPER(RTRIM(NEW.code,''''#''''));  \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF LENGTH(NEW.code)>p_length THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    p_length := LENGTH(NEW.code);\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE gestsea_structure SET code=RPAD(code,p_length,''''#'''') WHERE id!=NEW.id AND parent_id=NEW.parent_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    NEW.code:=RPAD(NEW.code,p_length,''''#'''');\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT code_etendu||NEW.code FROM gestsea_structure WHERE id=NEW.parent_structure_id INTO NEW.code_etendu;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF OLD.code_etendu!=NEW.code_etendu THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    UPDATE gestsea_structure SET code_etendu=NEW.code_etendu||code WHERE parent_id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_ventes_commande_ligne_2() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestsea_publication_abonnement_commande (commande_ligne_id,abonnement_id,partenaire_id,nb_exemplaires)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT ligne.id, abonnement.id,commande.partenaire_id,ligne.quantite\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        FROM gestion_ventes_commande_ligne AS ligne\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestion_ventes_commande AS commande ON (commande.id=commande_id) \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''             JOIN gestsea_publication_abonnement AS abonnement USING (produit_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE ligne.id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''UPDATE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.abonnement_id!=NEW.abonnement_id THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT count(*) FROM gestsea_publication_abonnement WHERE produit_id=NEW.produit_id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF 0>=total THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        DELETE FROM gestsea_publication_abonnement_commande WHERE commande_ligne_id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        UPDATE gestsea_publication_abonnement_commande SET abonnement_id=abonnement.id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''          FROM gestsea_publication_abonnement AS abonnement WHERE produit_id=NEW.produit_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    IF OLD.quantite!=NEW.quantite THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT sum(nb_exemplaires) FROM gestsea_publication_abonnement_commande \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE commande_ligne_id=NEW.id INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      IF total>NEW.quantite THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        UPDATE gestion_ventes_commande_ligne SET quantite=total WHERE id=NEW.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSIF TG_OP=''''DELETE'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    DELETE FROM gestsea_publication_abonnement_commande WHERE commande_ligne_id=OLD.id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_manage_ventes_facture_ligne_2() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF TG_OP=''''INSERT'''' THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INSERT INTO gestsea_publication_abonnement_routage (commande_id, facture_ligne_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      SELECT id, NEW.id FROM gestsea_publication_abonnement_commande \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''        WHERE commande_ligne_id=NEW.commande_ligne_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ELSE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Depuis quand on supprime des lignes de facture ?!'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NULL;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_publication_abonnement_commande() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT fc_get_contact(NEW.partenaire_id,contact_type_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication WHERE id=NEW.publication_id INTO NEW.contact_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NEW.contact_id IS NULL THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Il n''''''''est pas possible d''''''''ajouter cette personne Ã  la liste des abonnÃ©s car elle ne possÃ¨de pas une seule adresse active.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT publication_id FROM gestsea_publication_abonnement \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.abonnement_id INTO NEW.publication_id;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION tg_complete_publication_abonnement_routage() RETURNS TRIGGER AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  p_numero gestsea_publication_abonnement_routage.numero_debut%%TYPE;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  ok boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT com.quantite-fac.quantite, lig.facture_id, fac.facture_id=fac2.facture_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestion_ventes_facture_ligne AS fac, \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         gestsea_publication_abonnement_commande AS lig \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         JOIN gestion_ventes_commande_ligne AS com ON (com.id=lig.commande_ligne_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''         JOIN gestion_ventes_facture_ligne AS fac2 ON (com.id=fac2.commande_ligne_id)\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE fac.id=NEW.facture_ligne_id AND lig.id=NEW.id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO total, NEW.facture_id, ok;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF total!=0 THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''La totalitÃ© d''''''''une ligne de commande comprenant un routage de publication doit Ãªtre facturÃ©e en intÃ©gralitÃ©.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  IF NOT ok THEN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    RAISE EXCEPTION ''''Les numÃ©ros de facture ne correspondent pas lors de l''''''''Ã©tablissement du routage.'''';\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  END IF;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT partenaire_id,contact_id,abonnement_id,publication_id,nb_exemplaires\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication_abonnement_commande\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.commande_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.partenaire_id, NEW.contact_id,NEW.abonnement_id,NEW.publication_id,NEW.nb_exemplaires;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT MAX(numero_fin)+1\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication_abonnement_routage\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE partenaire_id=NEW.partenaire_id INTO p_numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT CASE WHEN p_numero>numero_prochain THEN p_numero ELSE numero_prochain END \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication WHERE id=NEW.publication_id INTO p_numero;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT p_numero+differe, p_numero+differe+nb_numeros\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    FROM gestsea_publication_abonnement \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    WHERE id=NEW.abonnement_id\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''    INTO NEW.numero_debut,NEW.numero_fin;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN NEW;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''      \\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE OR REPLACE FUNCTION is_search_path(in the_user text, in only_static boolean) RETURNS boolean AS \\\\$\\\\$\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''DECLARE\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  total integer;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''BEGIN\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  SELECT count(*)  FROM base.base_societe_utilisateur_rel WHERE utilisateur_login=$1 INTO total;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''  RETURN (NOT only_static AND total>0)::boolean;\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''END\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\n'';\\n';\n  proc:=proc||'  proc:=proc||''\\\\$\\\\$ LANGUAGE ''''plpgsql'''' VOLATILE;'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  INSERT INTO systeme.systeme_schema(nom) VALUES (schema_name);\\n';\n  proc:=proc||'  NEW.schema := schema_name;\\n';\n  proc:=proc||'  -- Triggers\\n';\n  proc:=proc||'  CREATE TRIGGER base_societe_etablissement_trgctl BEFORE INSERT OR UPDATE ON base_societe_etablissement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_societe_parametre_trgctl BEFORE INSERT OR UPDATE ON base_societe_parametre FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_societe_service_trgctl BEFORE INSERT OR UPDATE ON base_societe_service FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_droits_profil_trgctl BEFORE INSERT OR UPDATE ON base_droits_profil FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_droits_profil_module_trgctl BEFORE INSERT OR UPDATE ON base_droits_profil_module FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_droits_module_trgctl BEFORE INSERT OR UPDATE ON base_droits_module FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_acces_trgctl BEFORE INSERT OR UPDATE ON base_acces FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_societe_employe_trgctl BEFORE INSERT OR UPDATE ON base_societe_employe FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_type_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_trgctl BEFORE INSERT OR UPDATE ON base_partenaire FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_contact_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_contact FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_contact_version_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_contact_version FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_contact_type_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_contact_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_observation_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_observation FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_observation_importance_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_observation_importance FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_attribut_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_attribut FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_attribut_type_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_attribut_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_partenaire_attribut_categorie_trgctl BEFORE INSERT OR UPDATE ON base_partenaire_attribut_categorie FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_delai_trgctl BEFORE INSERT OR UPDATE ON base_delai FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_impression_modele_trgctl BEFORE INSERT OR UPDATE ON base_impression_modele FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_impression_trgctl BEFORE INSERT OR UPDATE ON base_impression FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER base_impression_type_trgctl BEFORE INSERT OR UPDATE ON base_impression_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_ecriture_trgctl BEFORE INSERT OR UPDATE ON compta_ecriture FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_piece_trgctl BEFORE INSERT OR UPDATE ON compta_piece FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_exercice_trgctl BEFORE INSERT OR UPDATE ON compta_exercice FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_journal_trgctl BEFORE INSERT OR UPDATE ON compta_journal FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_journal_type_trgctl BEFORE INSERT OR UPDATE ON compta_journal_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_pointage_trgctl BEFORE INSERT OR UPDATE ON compta_pointage FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_compteperm_partenaire_rel_trgctl BEFORE INSERT OR UPDATE ON compta_compteperm_partenaire_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_banque_compte_trgctl BEFORE INSERT OR UPDATE ON compta_banque_compte FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_banque_trgctl BEFORE INSERT OR UPDATE ON compta_banque FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_compteperm_trgctl BEFORE INSERT OR UPDATE ON compta_compteperm FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_compte_trgctl BEFORE INSERT OR UPDATE ON compta_compte FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER compta_compte_cumul_trgctl BEFORE INSERT OR UPDATE ON compta_compte_cumul FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_sequence_trgctl BEFORE INSERT OR UPDATE ON gestion_sequence FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_compteperm_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_compteperm_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_trgctl BEFORE INSERT OR UPDATE ON gestion_produit FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_categorie_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_categorie FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_service_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_service_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_taxe_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_taxe FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_prix_taxe_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_prix_taxe_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_produit_prix_trgctl BEFORE INSERT OR UPDATE ON gestion_produit_prix FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_lien_trgctl BEFORE INSERT OR UPDATE ON gestion_lien FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_lien_role_trgctl BEFORE INSERT OR UPDATE ON gestion_lien_role FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_lien_type_trgctl BEFORE INSERT OR UPDATE ON gestion_lien_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_reduction_trgctl BEFORE INSERT OR UPDATE ON gestion_reduction FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_type_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_type_produit_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_type_produit_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_periode_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_periode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_type_periode_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_type_periode_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_adhesion_transmission_trgctl BEFORE INSERT OR UPDATE ON gestion_adhesion_transmission FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_commande_type_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_commande_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_commande_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_commande FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_commande_ligne_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_commande_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_facture_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_facture FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_facture_ligne_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_facture_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_avoir_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_avoir FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_avoir_ligne_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_avoir_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_relance_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_relance FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_relance_lettre_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_relance_lettre FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_relance_mode_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_relance_mode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_relance_mode_etape_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_relance_mode_etape FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_facture_reglement_echeance_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_facture_reglement_echeance FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_reglement_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_reglement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_reglement_mode_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_reglement_mode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_reversement_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_reversement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_ventes_reversement_mode_trgctl BEFORE INSERT OR UPDATE ON gestion_ventes_reversement_mode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_facture_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_facture FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_facture_ligne_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_facture_ligne FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_facture_reglement_rel_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_facture_reglement_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_reglement_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_reglement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_achats_reglement_mode_trgctl BEFORE INSERT OR UPDATE ON gestion_achats_reglement_mode FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_stock_lieu_trgctl BEFORE INSERT OR UPDATE ON gestion_stock_lieu FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_stock_trgctl BEFORE INSERT OR UPDATE ON gestion_stock FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestion_stock_mouvement_trgctl BEFORE INSERT OR UPDATE ON gestion_stock_mouvement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_cotisation_parametrage_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation_parametrage FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_cotisation_lot_trgctl BEFORE INSERT OR UPDATE ON gestsea_cotisation_lot FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_canton_groupe_trgctl BEFORE INSERT OR UPDATE ON gestsea_canton_groupe FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_canton_groupe_rel_trgctl BEFORE INSERT OR UPDATE ON gestsea_canton_groupe_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_structure_trgctl BEFORE INSERT OR UPDATE ON gestsea_structure FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_structure_commune_rel_trgctl BEFORE INSERT OR UPDATE ON gestsea_structure_commune_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_procedure_commande_rel_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_procedure_commande_rel FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_procedure_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_procedure FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_tache_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_tache FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_tache_type_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_tache_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_dossier_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_dossier FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_dossier_commande_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_dossier_commande FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_dossier_type_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_dossier_type FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_juridique_dossier_etat_trgctl BEFORE INSERT OR UPDATE ON gestsea_juridique_dossier_etat FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_parution_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication_parution FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_abonnement_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication_abonnement FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_abonnement_commande_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication_abonnement_commande FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  CREATE TRIGGER gestsea_publication_abonnement_routage_trgctl BEFORE INSERT OR UPDATE ON gestsea_publication_abonnement_routage FOR EACH ROW EXECUTE PROCEDURE update_controls();\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T2_tg_complete_societe_etablissement0 BEFORE INSERT ON base_societe_etablissement FOR ROW EXECUTE PROCEDURE tg_complete_societe_etablissement();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T2_tg_complete_societe_etablissement1 BEFORE UPDATE ON base_societe_etablissement FOR ROW EXECUTE PROCEDURE tg_complete_societe_etablissement();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T3_tg_build_printer0 AFTER INSERT ON base_impression FOR ROW EXECUTE PROCEDURE tg_build_printer(''||schema_name||'');'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T3_tg_build_printer1 AFTER UPDATE ON base_impression FOR ROW EXECUTE PROCEDURE tg_build_printer(''||schema_name||'');'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T3_tg_build_printer2 AFTER DELETE ON base_impression FOR ROW EXECUTE PROCEDURE tg_build_printer(''||schema_name||'');'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights0 AFTER INSERT ON base_droits_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights1 AFTER UPDATE ON base_droits_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights2 AFTER DELETE ON base_droits_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights3 AFTER INSERT ON base_droits_profil_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights4 AFTER UPDATE ON base_droits_profil_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights5 AFTER DELETE ON base_droits_profil_module FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights6 AFTER INSERT ON base_societe_employe FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights7 AFTER UPDATE ON base_societe_employe FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T4_tg_manage_rights8 AFTER DELETE ON base_societe_employe FOR STATEMENT EXECUTE PROCEDURE tg_manage_rights();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T5_tg_complete_societe_employe0 BEFORE INSERT ON base_societe_employe FOR ROW EXECUTE PROCEDURE tg_complete_societe_employe();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T5_tg_complete_societe_employe1 BEFORE UPDATE ON base_societe_employe FOR ROW EXECUTE PROCEDURE tg_complete_societe_employe();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T6_tg_complete_partenaire0 BEFORE INSERT ON base_partenaire FOR ROW EXECUTE PROCEDURE tg_complete_partenaire();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T6_tg_complete_partenaire1 BEFORE UPDATE ON base_partenaire FOR ROW EXECUTE PROCEDURE tg_complete_partenaire();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T7_tg_complete_partenaire_type0 BEFORE INSERT ON base_partenaire_type FOR ROW EXECUTE PROCEDURE tg_complete_partenaire_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T7_tg_complete_partenaire_type1 BEFORE UPDATE ON base_partenaire_type FOR ROW EXECUTE PROCEDURE tg_complete_partenaire_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T8_tg_complete_contact0 BEFORE INSERT ON base_partenaire_contact FOR ROW EXECUTE PROCEDURE tg_complete_contact();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T8_tg_complete_contact1 BEFORE UPDATE ON base_partenaire_contact FOR ROW EXECUTE PROCEDURE tg_complete_contact();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T9_tg_manage_contact0 AFTER INSERT ON base_partenaire_contact FOR ROW EXECUTE PROCEDURE tg_manage_contact();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T9_tg_manage_contact1 AFTER UPDATE ON base_partenaire_contact FOR ROW EXECUTE PROCEDURE tg_manage_contact();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T10_tg_complete_contact_version0 BEFORE INSERT ON base_partenaire_contact_version FOR ROW EXECUTE PROCEDURE tg_complete_contact_version();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T10_tg_complete_contact_version1 BEFORE UPDATE ON base_partenaire_contact_version FOR ROW EXECUTE PROCEDURE tg_complete_contact_version();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T10_tg_complete_contact_version2 BEFORE DELETE ON base_partenaire_contact_version FOR ROW EXECUTE PROCEDURE tg_complete_contact_version();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T11_tg_complete_contact_type0 BEFORE INSERT ON base_partenaire_contact_type FOR ROW EXECUTE PROCEDURE tg_complete_contact_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T11_tg_complete_contact_type1 BEFORE UPDATE ON base_partenaire_contact_type FOR ROW EXECUTE PROCEDURE tg_complete_contact_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T11_tg_complete_contact_type2 BEFORE DELETE ON base_partenaire_contact_type FOR ROW EXECUTE PROCEDURE tg_complete_contact_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T13_tg_complete_partenaire_attribut0 BEFORE INSERT ON base_partenaire_attribut FOR ROW EXECUTE PROCEDURE tg_complete_partenaire_attribut();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T13_tg_complete_partenaire_attribut1 BEFORE UPDATE ON base_partenaire_attribut FOR ROW EXECUTE PROCEDURE tg_complete_partenaire_attribut();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T14_tg_complete_impression_modele0 BEFORE INSERT ON base_impression_modele FOR ROW EXECUTE PROCEDURE tg_complete_impression_modele();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T14_tg_complete_impression_modele1 BEFORE UPDATE ON base_impression_modele FOR ROW EXECUTE PROCEDURE tg_complete_impression_modele();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T15_tg_manage_impression0 AFTER INSERT ON base_impression FOR ROW EXECUTE PROCEDURE tg_manage_impression();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T15_tg_manage_impression1 AFTER UPDATE ON base_impression FOR ROW EXECUTE PROCEDURE tg_manage_impression();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T16_tg_complete_impression_type0 BEFORE UPDATE ON base_impression_type FOR ROW EXECUTE PROCEDURE tg_complete_impression_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T16_tg_complete_impression_type1 BEFORE DELETE ON base_impression_type FOR ROW EXECUTE PROCEDURE tg_complete_impression_type();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T17_tg_complete_compta_ecriture0 BEFORE INSERT ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_complete_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T17_tg_complete_compta_ecriture1 BEFORE UPDATE ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_complete_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T18_tg_manage_compta_ecriture0 AFTER INSERT ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_manage_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T18_tg_manage_compta_ecriture1 AFTER UPDATE ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_manage_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T18_tg_manage_compta_ecriture2 AFTER DELETE ON compta_ecriture FOR ROW EXECUTE PROCEDURE tg_manage_compta_ecriture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T19_tg_complete_compta_piece0 BEFORE INSERT ON compta_piece FOR ROW EXECUTE PROCEDURE tg_complete_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T19_tg_complete_compta_piece1 BEFORE UPDATE ON compta_piece FOR ROW EXECUTE PROCEDURE tg_complete_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T20_tg_manage_compta_piece0 AFTER INSERT ON compta_piece FOR ROW EXECUTE PROCEDURE tg_manage_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T20_tg_manage_compta_piece1 AFTER UPDATE ON compta_piece FOR ROW EXECUTE PROCEDURE tg_manage_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T20_tg_manage_compta_piece2 AFTER DELETE ON compta_piece FOR ROW EXECUTE PROCEDURE tg_manage_compta_piece();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard0 BEFORE INSERT ON compta_exercice FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard1 BEFORE UPDATE ON compta_exercice FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard2 BEFORE INSERT ON compta_pointage FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard3 BEFORE UPDATE ON compta_pointage FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard4 BEFORE INSERT ON compta_compte_cumul FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T21_tg_complete_compta_standard5 BEFORE UPDATE ON compta_compte_cumul FOR ROW EXECUTE PROCEDURE tg_complete_compta_standard();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T22_tg_complete_compta_journal0 BEFORE INSERT ON compta_journal FOR ROW EXECUTE PROCEDURE tg_complete_compta_journal();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T22_tg_complete_compta_journal1 BEFORE UPDATE ON compta_journal FOR ROW EXECUTE PROCEDURE tg_complete_compta_journal();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T23_tg_complete_compta_compte0 BEFORE INSERT ON compta_compte FOR ROW EXECUTE PROCEDURE tg_complete_compta_compte();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T23_tg_complete_compta_compte1 BEFORE UPDATE ON compta_compte FOR ROW EXECUTE PROCEDURE tg_complete_compta_compte();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T24_tg_complete_compte_cumul0 BEFORE INSERT ON compta_compte_cumul FOR ROW EXECUTE PROCEDURE tg_complete_compte_cumul();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T24_tg_complete_compte_cumul1 BEFORE UPDATE ON compta_compte_cumul FOR ROW EXECUTE PROCEDURE tg_complete_compte_cumul();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T25_tg_complete_sequence0 BEFORE INSERT ON gestion_sequence FOR ROW EXECUTE PROCEDURE tg_complete_sequence();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T25_tg_complete_sequence1 BEFORE UPDATE ON gestion_sequence FOR ROW EXECUTE PROCEDURE tg_complete_sequence();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T25_tg_complete_sequence2 BEFORE DELETE ON gestion_sequence FOR ROW EXECUTE PROCEDURE tg_complete_sequence();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T26_tg_complete_produit_taxe0 BEFORE INSERT ON gestion_produit_taxe FOR ROW EXECUTE PROCEDURE tg_complete_produit_taxe();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T26_tg_complete_produit_taxe1 BEFORE UPDATE ON gestion_produit_taxe FOR ROW EXECUTE PROCEDURE tg_complete_produit_taxe();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T27_tg_manage_produit_prix_taxe_rel0 AFTER INSERT ON gestion_produit_prix_taxe_rel FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix_taxe_rel();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T27_tg_manage_produit_prix_taxe_rel1 AFTER UPDATE ON gestion_produit_prix_taxe_rel FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix_taxe_rel();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T27_tg_manage_produit_prix_taxe_rel2 AFTER DELETE ON gestion_produit_prix_taxe_rel FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix_taxe_rel();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T28_tg_complete_produit_prix0 BEFORE INSERT ON gestion_produit_prix FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T28_tg_complete_produit_prix1 BEFORE UPDATE ON gestion_produit_prix FOR ROW EXECUTE PROCEDURE tg_complete_produit_prix();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T29_tg_complete_lien0 BEFORE INSERT ON gestion_lien FOR ROW EXECUTE PROCEDURE tg_complete_lien();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T29_tg_complete_lien1 BEFORE UPDATE ON gestion_lien FOR ROW EXECUTE PROCEDURE tg_complete_lien();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T30_tg_complete_lien_role0 BEFORE INSERT ON gestion_lien_role FOR ROW EXECUTE PROCEDURE tg_complete_lien_role();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T30_tg_complete_lien_role1 BEFORE UPDATE ON gestion_lien_role FOR ROW EXECUTE PROCEDURE tg_complete_lien_role();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T31_tg_complete_adhesion0 BEFORE INSERT ON gestion_adhesion FOR ROW EXECUTE PROCEDURE tg_complete_adhesion();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T31_tg_complete_adhesion1 BEFORE UPDATE ON gestion_adhesion FOR ROW EXECUTE PROCEDURE tg_complete_adhesion();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T32_tg_complete_ventes_commande0 BEFORE INSERT ON gestion_ventes_commande FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T32_tg_complete_ventes_commande1 BEFORE UPDATE ON gestion_ventes_commande FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T33_tg_complete_ventes_commande_ligne0 BEFORE INSERT ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T33_tg_complete_ventes_commande_ligne1 BEFORE UPDATE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T33_tg_complete_ventes_commande_ligne2 BEFORE DELETE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T34_tg_manage_ventes_commande_ligne0 AFTER INSERT ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T34_tg_manage_ventes_commande_ligne1 AFTER UPDATE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T34_tg_manage_ventes_commande_ligne2 AFTER DELETE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_complete_ventes_commande_ligne();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T35_tg_complete_ventes_facture0 BEFORE INSERT ON gestion_ventes_facture FOR ROW EXECUTE PROCEDURE tg_complete_ventes_facture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T35_tg_complete_ventes_facture1 BEFORE UPDATE ON gestion_ventes_facture FOR ROW EXECUTE PROCEDURE tg_complete_ventes_facture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T35_tg_complete_ventes_facture2 BEFORE DELETE ON gestion_ventes_facture FOR ROW EXECUTE PROCEDURE tg_complete_ventes_facture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T36_tg_manage_ventes_facture0 AFTER INSERT ON gestion_ventes_facture FOR ROW EXECUTE PROCEDURE tg_manage_ventes_facture();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T37_tg_complete_ventes_relance0 BEFORE INSERT ON gestion_ventes_relance FOR ROW EXECUTE PROCEDURE tg_complete_ventes_relance();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T37_tg_complete_ventes_relance1 BEFORE UPDATE ON gestion_ventes_relance FOR ROW EXECUTE PROCEDURE tg_complete_ventes_relance();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T37_tg_complete_ventes_relance2 BEFORE DELETE ON gestion_ventes_relance FOR ROW EXECUTE PROCEDURE tg_complete_ventes_relance();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T41_tg_complete_structure0 BEFORE INSERT ON gestsea_structure FOR ROW EXECUTE PROCEDURE tg_complete_structure();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T41_tg_complete_structure1 BEFORE UPDATE ON gestsea_structure FOR ROW EXECUTE PROCEDURE tg_complete_structure();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T42_tg_manage_ventes_commande_ligne_20 AFTER INSERT ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_commande_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T42_tg_manage_ventes_commande_ligne_21 AFTER UPDATE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_commande_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T42_tg_manage_ventes_commande_ligne_22 AFTER DELETE ON gestion_ventes_commande_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_commande_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T43_tg_manage_ventes_facture_ligne_20 AFTER INSERT ON gestion_ventes_facture_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_facture_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T43_tg_manage_ventes_facture_ligne_21 AFTER UPDATE ON gestion_ventes_facture_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_facture_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T43_tg_manage_ventes_facture_ligne_22 AFTER DELETE ON gestion_ventes_facture_ligne FOR ROW EXECUTE PROCEDURE tg_manage_ventes_facture_ligne_2();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T44_tg_complete_publication_abonnement_commande0 BEFORE INSERT ON gestsea_publication_abonnement_commande FOR ROW EXECUTE PROCEDURE tg_complete_publication_abonnement_commande();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T44_tg_complete_publication_abonnement_commande1 BEFORE UPDATE ON gestsea_publication_abonnement_commande FOR ROW EXECUTE PROCEDURE tg_complete_publication_abonnement_commande();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T45_tg_complete_publication_abonnement_routage0 BEFORE INSERT ON gestsea_publication_abonnement_routage FOR ROW EXECUTE PROCEDURE tg_complete_publication_abonnement_routage();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  proc:=''CREATE TRIGGER T45_tg_complete_publication_abonnement_routage1 BEFORE UPDATE ON gestsea_publication_abonnement_routage FOR ROW EXECUTE PROCEDURE tg_complete_publication_abonnement_routage();'';\\n';\n  proc:=proc||'  EXECUTE proc;\\n';\n  proc:=proc||'  -- Data with triggers\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_type(nom, morale, masculin, titre) VALUES (''Homme'', false, true, ''Monsieur'');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_type(nom, morale, masculin, titre) VALUES (''Femme'', false, false, ''Madame'');\\n';\n  proc:=proc||'  INSERT INTO base_partenaire_type(nom, titre) VALUES (''SA'', ''S.A.'');\\n';\n  proc:=proc||'  INSERT INTO gestion_sequence(immuable, code, nom, mensuelle, prefixe, corps) VALUES (true, ''COMMANDE'', ''SÃ©quence des commande'', true, ''YYYYMM'', ''FM0999'');\\n';\n  proc:=proc||'  INSERT INTO gestion_sequence(immuable, code, nom) VALUES (true, ''FACTURE'', ''SÃ©quence des factures'');\\n';\n  proc:=proc||'  INSERT INTO gestion_sequence(immuable, code, nom) VALUES (true, ''AVOIR'', ''SÃ©quence des avoirs'');\\n';\n  proc:=proc||'  -- Sequences initialization\\n';\n  proc:=proc||'  PERFORM setval(''base_societe_etablissement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_societe_etablissement;\\n';\n  proc:=proc||'  PERFORM setval(''base_societe_parametre_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_societe_parametre;\\n';\n  proc:=proc||'  PERFORM setval(''base_societe_service_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_societe_service;\\n';\n  proc:=proc||'  PERFORM setval(''base_droits_profil_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_droits_profil;\\n';\n  proc:=proc||'  PERFORM setval(''base_droits_profil_module_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_droits_profil_module;\\n';\n  proc:=proc||'  PERFORM setval(''base_droits_module_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_droits_module;\\n';\n  proc:=proc||'  PERFORM setval(''base_acces_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_acces;\\n';\n  proc:=proc||'  PERFORM setval(''base_societe_employe_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_societe_employe;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_type;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_contact_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_contact;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_contact_version_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_contact_version;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_contact_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_contact_type;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_observation_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_observation;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_observation_importance_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_observation_importance;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_attribut_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_attribut;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_attribut_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_attribut_type;\\n';\n  proc:=proc||'  PERFORM setval(''base_partenaire_attribut_categorie_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_partenaire_attribut_categorie;\\n';\n  proc:=proc||'  PERFORM setval(''base_delai_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_delai;\\n';\n  proc:=proc||'  PERFORM setval(''base_impression_modele_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_impression_modele;\\n';\n  proc:=proc||'  PERFORM setval(''base_impression_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_impression;\\n';\n  proc:=proc||'  PERFORM setval(''base_impression_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM base_impression_type;\\n';\n  proc:=proc||'  PERFORM setval(''compta_ecriture_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_ecriture;\\n';\n  proc:=proc||'  PERFORM setval(''compta_piece_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_piece;\\n';\n  proc:=proc||'  PERFORM setval(''compta_exercice_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_exercice;\\n';\n  proc:=proc||'  PERFORM setval(''compta_journal_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_journal;\\n';\n  proc:=proc||'  PERFORM setval(''compta_journal_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_journal_type;\\n';\n  proc:=proc||'  PERFORM setval(''compta_pointage_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_pointage;\\n';\n  proc:=proc||'  PERFORM setval(''compta_compteperm_partenaire_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_compteperm_partenaire_rel;\\n';\n  proc:=proc||'  PERFORM setval(''compta_banque_compte_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_banque_compte;\\n';\n  proc:=proc||'  PERFORM setval(''compta_banque_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_banque;\\n';\n  proc:=proc||'  PERFORM setval(''compta_compteperm_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_compteperm;\\n';\n  proc:=proc||'  PERFORM setval(''compta_compte_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_compte;\\n';\n  proc:=proc||'  PERFORM setval(''compta_compte_cumul_id_seq'',COALESCE(MAX(id),0)+1,false) FROM compta_compte_cumul;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_sequence_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_sequence;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_compteperm_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_compteperm_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_categorie_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_categorie;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_service_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_service_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_taxe_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_taxe;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_prix_taxe_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_prix_taxe_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_produit_prix_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_produit_prix;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_lien_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_lien;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_lien_role_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_lien_role;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_lien_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_lien_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_reduction_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_reduction;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_type_produit_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_type_produit_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_periode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_periode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_type_periode_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_type_periode_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_adhesion_transmission_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_adhesion_transmission;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_commande_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_commande_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_commande_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_commande;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_commande_ligne_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_commande_ligne;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_facture_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_facture;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_facture_ligne_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_facture_ligne;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_avoir_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_avoir;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_avoir_ligne_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_avoir_ligne;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_relance_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_relance;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_relance_lettre_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_relance_lettre;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_relance_mode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_relance_mode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_relance_mode_etape_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_relance_mode_etape;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_facture_reglement_echeance_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_facture_reglement_echeance;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_reglement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_reglement;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_reglement_mode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_reglement_mode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_reversement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_reversement;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_ventes_reversement_mode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_ventes_reversement_mode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_facture_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_facture;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_facture_ligne_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_facture_ligne;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_facture_reglement_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_facture_reglement_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_reglement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_reglement;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_achats_reglement_mode_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_achats_reglement_mode;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_stock_lieu_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_stock_lieu;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_stock_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_stock;\\n';\n  proc:=proc||'  PERFORM setval(''gestion_stock_mouvement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestion_stock_mouvement;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_cotisation_parametrage_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation_parametrage;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_cotisation_lot_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_cotisation_lot;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_canton_groupe_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_canton_groupe;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_canton_groupe_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_canton_groupe_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_structure_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_structure;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_structure_commune_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_structure_commune_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_procedure_commande_rel_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_procedure_commande_rel;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_procedure_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_procedure;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_tache_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_tache;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_tache_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_tache_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_dossier_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_dossier;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_dossier_commande_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_dossier_commande;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_dossier_type_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_dossier_type;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_juridique_dossier_etat_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_juridique_dossier_etat;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_parution_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication_parution;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_abonnement_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication_abonnement;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_abonnement_commande_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication_abonnement_commande;\\n';\n  proc:=proc||'  PERFORM setval(''gestsea_publication_abonnement_routage_id_seq'',COALESCE(MAX(id),0)+1,false) FROM gestsea_publication_abonnement_routage;\\n';\n  proc:=proc||'  RETURN NEW;\\n';\n  proc:=proc||'END;\\n';\n  proc:=proc||'\\$\\$ LANGUAGE ''plpgsql'' VOLATILE;';\n  EXECUTE proc;\n  CREATE TRIGGER tgs_base_base_societe_trigger BEFORE INSERT ON base_societe FOR EACH ROW EXECUTE PROCEDURE tgs_base_base_societe_();\n  RETURN 0;\n\nEND; $$ LANGUAGE 'plpgsql' VOLATILE;\n");
  if (PQresultStatus(pResult) != PGRES_COMMAND_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage310[16384];
    snprintf(pMessage310,16380,"<error code=\"310\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R310> %s", pMessage310);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage310);
  }
fprintf(stderr, "7");
  sprintf(query,"SELECT pm__InitDatabase('%s', %s);",aDatabase,(aForce)?"true":"false");
  pResult = PQexec(gConn[pId], query);
  if (PQresultStatus(pResult) != PGRES_TUPLES_OK) {
    printf("Line %d\n",__LINE__);
    char pMessage311[16384];
    snprintf(pMessage311,16380,"<error code=\"311\">%s</error>", PQresultErrorMessage(pResult));
    PQclear(pResult);
    fprintf(stderr, "R311> %s", pMessage311);
    return soap_receiver_fault(aSoap, "Erreur lors de l'éxecution de la requête", pMessage311);
  }
fprintf(stderr, "8\n");
  return SOAP_OK;
}


